var requirejs,require,define;!function(global){function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,i){if(t){var e;for(e=0;e<t.length&&(!t[e]||!i(t[e],e,t));e+=1);}}function eachReverse(t,i){if(t){var e;for(e=t.length-1;e>-1&&(!t[e]||!i(t[e],e,t));e-=1);}}function hasProp(t,i){return hasOwn.call(t,i)}function getOwn(t,i){return hasProp(t,i)&&t[i]}function eachProp(t,i){var e;for(e in t)if(hasProp(t,e)&&i(t[e],e))break}function mixin(t,i,e,n){return i&&eachProp(i,function(i,s){(e||!hasProp(t,s))&&(!n||"object"!=typeof i||!i||isArray(i)||isFunction(i)||i instanceof RegExp?t[s]=i:(t[s]||(t[s]={}),mixin(t[s],i,e,n)))}),t}function bind(t,i){return function(){return i.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var i=global;return each(t.split("."),function(t){i=i[t]}),i}function makeError(t,i,e,n){var s=new Error(i+"\nhttp://requirejs.org/docs/errors.html#"+t);return s.requireType=t,s.requireModules=n,e&&(s.originalError=e),s}function newContext(t){function i(t){var i,e;for(i=0;i<t.length;i++)if(e=t[i],"."===e)t.splice(i,1),i-=1;else if(".."===e){if(0===i||1===i&&".."===t[2]||".."===t[i-1])continue;i>0&&(t.splice(i-1,2),i-=2)}}function e(t,e,n){var s,o,r,a,h,p,c,u,l,d,f,g,_=e&&e.split("/"),y=x.map,m=y&&y["*"];if(t&&(t=t.split("/"),c=t.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(t[c])&&(t[c]=t[c].replace(jsSuffixRegExp,"")),"."===t[0].charAt(0)&&_&&(g=_.slice(0,_.length-1),t=g.concat(t)),i(t),t=t.join("/")),n&&y&&(_||m)){r=t.split("/");t:for(a=r.length;a>0;a-=1){if(p=r.slice(0,a).join("/"),_)for(h=_.length;h>0;h-=1)if(o=getOwn(y,_.slice(0,h).join("/")),o&&(o=getOwn(o,p))){u=o,l=a;break t}!d&&m&&getOwn(m,p)&&(d=getOwn(m,p),f=a)}!u&&d&&(u=d,l=f),u&&(r.splice(0,l,u),t=r.join("/"))}return s=getOwn(x.pkgs,t),s?s:t}function n(t){isBrowser&&each(scripts(),function(i){return i.getAttribute("data-requiremodule")===t&&i.getAttribute("data-requirecontext")===O.contextName?(i.parentNode.removeChild(i),!0):void 0})}function s(t){var i=getOwn(x.paths,t);return i&&isArray(i)&&i.length>1?(i.shift(),O.require.undef(t),O.makeRequire(null,{skipMap:!0})([t]),!0):void 0}function o(t){var i,e=t?t.indexOf("!"):-1;return e>-1&&(i=t.substring(0,e),t=t.substring(e+1,t.length)),[i,t]}function r(t,i,n,s){var r,a,h,p,c=null,u=i?i.name:null,l=t,d=!0,f="";return t||(d=!1,t="_@r"+(F+=1)),p=o(t),c=p[0],t=p[1],c&&(c=e(c,u,s),a=getOwn(M,c)),t&&(c?f=a&&a.normalize?a.normalize(t,function(t){return e(t,u,s)}):-1===t.indexOf("!")?e(t,u,s):t:(f=e(t,u,s),p=o(f),c=p[0],f=p[1],n=!0,r=O.nameToUrl(f))),h=!c||a||n?"":"_unnormalized"+(D+=1),{prefix:c,name:f,parentMap:i,unnormalized:!!h,url:r,originalName:l,isDefine:d,id:(c?c+"!"+f:f)+h}}function a(t){var i=t.id,e=getOwn(z,i);return e||(e=z[i]=new O.Module(t)),e}function h(t,i,e){var n=t.id,s=getOwn(z,n);!hasProp(M,n)||s&&!s.defineEmitComplete?(s=a(t),s.error&&"error"===i?e(s.error):s.on(i,e)):"defined"===i&&e(M[n])}function p(t,i){var e=t.requireModules,n=!1;i?i(t):(each(e,function(i){var e=getOwn(z,i);e&&(e.error=t,e.events.error&&(n=!0,e.emit("error",t)))}),n||req.onError(t))}function c(){globalDefQueue.length&&(apsp.apply(T,[T.length,0].concat(globalDefQueue)),globalDefQueue=[])}function u(t){delete z[t],delete w[t]}function l(t,i,e){var n=t.map.id;t.error?t.emit("error",t.error):(i[n]=!0,each(t.depMaps,function(n,s){var o=n.id,r=getOwn(z,o);!r||t.depMatched[s]||e[o]||(getOwn(i,o)?(t.defineDep(s,M[o]),t.check()):l(r,i,e))}),e[n]=!0)}function d(){var t,i,e=1e3*x.waitSeconds,o=e&&O.startTime+e<(new Date).getTime(),r=[],a=[],h=!1,c=!0;if(!m){if(m=!0,eachProp(w,function(t){var e=t.map,p=e.id;if(t.enabled&&(e.isDefine||a.push(t),!t.error))if(!t.inited&&o)s(p)?(i=!0,h=!0):(r.push(p),n(p));else if(!t.inited&&t.fetched&&e.isDefine&&(h=!0,!e.prefix))return c=!1}),o&&r.length)return t=makeError("timeout","Load timeout for modules: "+r,null,r),t.contextName=O.contextName,p(t);c&&each(a,function(t){l(t,{},{})}),o&&!i||!h||!isBrowser&&!isWebWorker||b||(b=setTimeout(function(){b=0,d()},50)),m=!1}}function f(t){hasProp(M,t[0])||a(r(t[0],null,!0)).init(t[1],t[2])}function g(t,i,e,n){t.detachEvent&&!isOpera?n&&t.detachEvent(n,i):t.removeEventListener(e,i,!1)}function _(t){var i=t.currentTarget||t.srcElement;return g(i,O.onScriptLoad,"load","onreadystatechange"),g(i,O.onScriptError,"error"),{node:i,id:i&&i.getAttribute("data-requiremodule")}}function y(){var t;for(c();T.length;){if(t=T.shift(),null===t[0])return p(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));f(t)}}var m,v,O,S,b,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},z={},w={},E={},T=[],M={},P={},N={},F=1,D=1;return S={require:function(t){return t.require?t.require:t.require=O.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?M[t.map.id]=t.exports:t.exports=M[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return getOwn(x.config,t.map.id)||{}},exports:t.exports||(t.exports={})}}},v=function(t){this.events=getOwn(E,t.id)||{},this.map=t,this.shim=getOwn(x.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},v.prototype={init:function(t,i,e,n){n=n||{},this.inited||(this.factory=i,e?this.on("error",e):this.events.error&&(e=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=e,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,i){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=i)},fetch:function(){if(!this.fetched){this.fetched=!0,O.startTime=(new Date).getTime();var t=this.map;return this.shim?void O.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()})):t.prefix?this.callPlugin():this.load()}},load:function(){var t=this.map.url;P[t]||(P[t]=!0,O.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,i,e=this.map.id,n=this.depExports,s=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{s=O.execCb(e,o,n,s)}catch(r){t=r}else s=O.execCb(e,o,n,s);if(this.map.isDefine&&void 0===s&&(i=this.module,i?s=i.exports:this.usingExports&&(s=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",p(this.error=t)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(M[e]=s,req.onResourceLoad&&req.onResourceLoad(O,this.map,this.depMaps)),u(e),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var t=this.map,i=t.id,n=r(t.prefix);this.depMaps.push(n),h(n,"defined",bind(this,function(n){var s,o,c,l=getOwn(N,this.map.id),d=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,g=O.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(d=n.normalize(d,function(t){return e(t,f,!0)})||""),o=r(t.prefix+"!"+d,this.map.parentMap),h(o,"defined",bind(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),c=getOwn(z,o.id),void(c&&(this.depMaps.push(o),this.events.error&&c.on("error",bind(this,function(t){this.emit("error",t)})),c.enable()))):l?(this.map.url=O.nameToUrl(l),void this.load()):(s=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),s.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[i],eachProp(z,function(t){0===t.map.id.indexOf(i+"_unnormalized")&&u(t.map.id)}),p(t)}),s.fromText=bind(this,function(e,n){var o=t.name,h=r(o),c=useInteractive;n&&(e=n),c&&(useInteractive=!1),a(h),hasProp(x.config,i)&&(x.config[o]=x.config[i]);try{req.exec(e)}catch(u){return p(makeError("fromtexteval","fromText eval for "+i+" failed: "+u,u,[i]))}c&&(useInteractive=!0),this.depMaps.push(h),O.completeLoad(o),g([o],s)}),void n.load(t.name,g,s,x))})),O.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){w[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,i){var e,n,s;if("string"==typeof t){if(t=r(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=t,s=getOwn(S,t.id))return void(this.depExports[i]=s(this));this.depCount+=1,h(t,"defined",bind(this,function(t){this.defineDep(i,t),this.check()})),this.errback?h(t,"error",bind(this,this.errback)):this.events.error&&h(t,"error",bind(this,function(t){this.emit("error",t)}))}e=t.id,n=z[e],hasProp(S,e)||!n||n.enabled||O.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var i=getOwn(z,t.id);i&&!i.enabled&&O.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,i){var e=this.events[t];e||(e=this.events[t]=[]),e.push(i)},emit:function(t,i){each(this.events[t],function(t){t(i)}),"error"===t&&delete this.events[t]}},O={config:x,contextName:t,registry:z,defined:M,urlFetched:P,defQueue:T,Module:v,makeModuleMap:r,nextTick:req.nextTick,onError:p,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var i=x.shim,e={paths:!0,bundles:!0,config:!0,map:!0};eachProp(t,function(t,i){e[i]?(x[i]||(x[i]={}),mixin(x[i],t,!0,!0)):x[i]=t}),t.bundles&&eachProp(t.bundles,function(t,i){each(t,function(t){t!==i&&(N[t]=i)})}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=O.makeShimExports(t)),i[e]=t}),x.shim=i),t.packages&&each(t.packages,function(t){var i,e;t="string"==typeof t?{name:t}:t,e=t.name,i=t.location,i&&(x.paths[e]=t.location),x.pkgs[e]=t.name+"/"+(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(z,function(t,i){t.inited||t.map.unnormalized||(t.map=r(i))}),(t.deps||t.callback)&&O.require(t.deps||[],t.callback)},makeShimExports:function(t){function i(){var i;return t.init&&(i=t.init.apply(global,arguments)),i||t.exports&&getGlobal(t.exports)}return i},makeRequire:function(i,s){function o(e,n,h){var c,u,l;return s.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof e?isFunction(n)?p(makeError("requireargs","Invalid require call"),h):i&&hasProp(S,e)?S[e](z[i.id]):req.get?req.get(O,e,i,o):(u=r(e,i,!1,!0),c=u.id,hasProp(M,c)?M[c]:p(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+t+(i?"":". Use require([])")))):(y(),O.nextTick(function(){y(),l=a(r(null,i)),l.skipMap=s.skipMap,l.init(e,n,h,{enabled:!0}),d()}),o)}return s=s||{},mixin(o,{isBrowser:isBrowser,toUrl:function(t){var n,s=t.lastIndexOf("."),o=t.split("/")[0],r="."===o||".."===o;return-1!==s&&(!r||s>1)&&(n=t.substring(s,t.length),t=t.substring(0,s)),O.nameToUrl(e(t,i&&i.id,!0),n,!0)},defined:function(t){return hasProp(M,r(t,i,!1,!0).id)},specified:function(t){return t=r(t,i,!1,!0).id,hasProp(M,t)||hasProp(z,t)}}),i||(o.undef=function(t){c();var e=r(t,i,!0),s=getOwn(z,t);n(t),delete M[t],delete P[e.url],delete E[t],eachReverse(T,function(i,e){i[0]===t&&T.splice(e,1)}),s&&(s.events.defined&&(E[t]=s.events),u(t))}),o},enable:function(t){var i=getOwn(z,t.id);i&&a(t).enable()},completeLoad:function(t){var i,e,n,o=getOwn(x.shim,t)||{},r=o.exports;for(c();T.length;){if(e=T.shift(),null===e[0]){if(e[0]=t,i)break;i=!0}else e[0]===t&&(i=!0);f(e)}if(n=getOwn(z,t),!i&&!hasProp(M,t)&&n&&!n.inited){if(!(!x.enforceDefine||r&&getGlobal(r)))return s(t)?void 0:p(makeError("nodefine","No define call for "+t,null,[t]));f([t,o.deps||[],o.exportsFn])}d()},nameToUrl:function(t,i,e){var n,s,o,r,a,h,p,c=getOwn(x.pkgs,t);if(c&&(t=c),p=getOwn(N,t))return O.nameToUrl(p,i,e);if(req.jsExtRegExp.test(t))a=t+(i||"");else{for(n=x.paths,s=t.split("/"),o=s.length;o>0;o-=1)if(r=s.slice(0,o).join("/"),h=getOwn(n,r)){isArray(h)&&(h=h[0]),s.splice(0,o,h);break}a=s.join("/"),a+=i||(/^data\:|\?/.test(a)||e?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+a}return x.urlArgs?a+((-1===a.indexOf("?")?"?":"&")+x.urlArgs):a},load:function(t,i){req.load(O,t,i)},execCb:function(t,i,e,n){return i.apply(n,e)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var i=_(t);O.completeLoad(i.id)}},onScriptError:function(t){var i=_(t);return s(i.id)?void 0:p(makeError("scripterror","Script error for: "+i.id,t,[i.id]))}},O.require=O.makeRequire(),O}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){return"interactive"===t.readyState?interactiveScript=t:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.17",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,i,e,n){var s,o,r=defContextName;return isArray(t)||"string"==typeof t||(o=t,isArray(i)?(t=i,i=e,e=n):t=[]),o&&o.context&&(r=o.context),s=getOwn(contexts,r),s||(s=contexts[r]=req.s.newContext(r)),o&&s.configure(o),s.require(t,i,e)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var i=contexts[defContextName];return i.require[t].apply(i,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t){var i=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=t.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(t,i,e){var n,s=t&&t.config||{};if(isBrowser)return n=req.createNode(s,i,e),n.setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",i),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=e,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{importScripts(e),t.completeLoad(i)}catch(o){t.onError(makeError("importscripts","importScripts failed for "+i+" at "+e,o,[i]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){return head||(head=t.parentNode),dataMain=t.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(t,i,e){var n,s;"string"!=typeof t&&(e=i,i=t,t=null),isArray(i)||(e=i,i=null),!i&&isFunction(e)&&(i=[],e.length&&(e.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(t,e){i.push(e)}),i=(1===e.length?["require"]:["require","exports","module"]).concat(i))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(t||(t=n.getAttribute("data-requiremodule")),s=contexts[n.getAttribute("data-requirecontext")])),(s?s.defQueue:globalDefQueue).push([t,i,e])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define(function(t,i,e){function n(){var t=this.container;return[t.clientWidth,t.clientHeight]}function s(t){this.container=t,this._allocator=new a(t),this._node=new o,this._eventOutput=new r,this._size=n.call(this),this._perspectiveState=new p(0),this._perspective=void 0,this._nodeContext={allocator:this._allocator,transform:h.identity,opacity:1,origin:c,align:c,size:this._size},this._eventOutput.on("resize",function(){this.setSize(n.call(this))}.bind(this))}var o=t("./RenderNode"),r=t("./EventHandler"),a=t("./ElementAllocator"),h=t("./Transform"),p=t("../transitions/Transitionable"),c=[0,0],u=!("perspective"in document.documentElement.style),l=u?function(t,i){t.style.webkitPerspective=i?i.toFixed()+"px":""}:function(t,i){t.style.perspective=i?i.toFixed()+"px":""};s.prototype.getAllocator=function(){return this._allocator},s.prototype.add=function(t){return this._node.add(t)},s.prototype.migrate=function(t){t!==this.container&&(this.container=t,this._allocator.migrate(t))},s.prototype.getSize=function(){return this._size},s.prototype.setSize=function(t){t||(t=n.call(this)),this._size[0]=t[0],this._size[1]=t[1]},s.prototype.update=function(t){t&&(t.transform&&(this._nodeContext.transform=t.transform),t.opacity&&(this._nodeContext.opacity=t.opacity),t.origin&&(this._nodeContext.origin=t.origin),t.align&&(this._nodeContext.align=t.align),t.size&&(this._nodeContext.size=t.size));var i=this._perspectiveState.get();i!==this._perspective&&(l(this.container,i),this._perspective=i),this._node.commit(this._nodeContext)},s.prototype.getPerspective=function(){return this._perspectiveState.get()},s.prototype.setPerspective=function(t,i,e){return this._perspectiveState.set(t,i,e)},s.prototype.emit=function(t,i){return this._eventOutput.emit(t,i)},s.prototype.on=function(t,i){return this._eventOutput.on(t,i)},s.prototype.removeListener=function(t,i){return this._eventOutput.removeListener(t,i)},s.prototype.pipe=function(t){return this._eventOutput.pipe(t)},s.prototype.unpipe=function(t){return this._eventOutput.unpipe(t)},e.exports=s}),define(function(t,i,e){function n(t){t||(t=document.createDocumentFragment()),this.container=t,this.detachedNodes={},this.nodeCount=0}n.prototype.migrate=function(t){var i=this.container;if(t!==i){if(i instanceof DocumentFragment)t.appendChild(i);else for(;i.hasChildNodes();)t.appendChild(i.firstChild);this.container=t}},n.prototype.allocate=function(t){t=t.toLowerCase(),t in this.detachedNodes||(this.detachedNodes[t]=[]);var i,e=this.detachedNodes[t];return e.length>0?i=e.pop():(i=document.createElement(t),this.container.appendChild(i)),this.nodeCount++,i},n.prototype.deallocate=function(t){var i=t.nodeName.toLowerCase(),e=this.detachedNodes[i];e.push(t),this.nodeCount--},n.prototype.getNodeCount=function(){return this.nodeCount},e.exports=n}),define(function(t,i,e){function n(t){this._matrix=null,this._opacity=1,this._origin=null,this._size=null,this._eventOutput=new c,this._eventOutput.bindThis(this),this.eventForwarder=function(t){this._eventOutput.emit(t.type,t)}.bind(this),this.id=p.register(this),this._element=null,this._sizeDirty=!1,this._originDirty=!1,this._transformDirty=!1,this._invisible=!1,t&&this.attach(t)}function s(t){for(var i in this._eventOutput.listeners)t.addEventListener(i,this.eventForwarder)}function o(t){for(var i in this._eventOutput.listeners)t.removeEventListener(i,this.eventForwarder)}function r(t){t[12]=Math.round(t[12]*d)/d,t[13]=Math.round(t[13]*d)/d;for(var i="matrix3d(",e=0;15>e;e++)i+=t[e]<1e-6&&t[e]>-1e-6?"0,":t[e]+",";return i+=t[15]+")"}function a(t){return 100*t[0]+"% "+100*t[1]+"%"}function h(t,i){return t&&i?t[0]!==i[0]||t[1]!==i[1]:t!==i}var p=t("./Entity"),c=t("./EventHandler"),u=t("./Transform"),l=!("transform"in document.documentElement.style),d=window.devicePixelRatio||1;n.prototype.on=function(t,i){this._element&&this._element.addEventListener(t,this.eventForwarder),this._eventOutput.on(t,i)},n.prototype.removeListener=function(t,i){this._eventOutput.removeListener(t,i)},n.prototype.emit=function(t,i){i&&!i.origin&&(i.origin=this);var e=this._eventOutput.emit(t,i);return e&&i&&i.stopPropagation&&i.stopPropagation(),e},n.prototype.pipe=function(t){return this._eventOutput.pipe(t)},n.prototype.unpipe=function(t){return this._eventOutput.unpipe(t)},n.prototype.render=function(){return this.id};var f;f=l?function(t,i){t.style.webkitTransform=r(i)}:function(t,i){t.style.transform=r(i)};var g=l?function(t,i){t.style.webkitTransformOrigin=a(i)}:function(t,i){t.style.transformOrigin=a(i)},_=l?function(t){t.style.webkitTransform="scale3d(0.0001,0.0001,0.0001)",t.style.opacity=0}:function(t){t.style.transform="scale3d(0.0001,0.0001,0.0001)",t.style.opacity=0};n.prototype.commit=function(t){var i=this._element;if(i){{var e=t.transform,n=t.opacity,s=t.origin;t.size}if(!e&&this._matrix)return this._matrix=null,this._opacity=0,void _(i);if(h(this._origin,s)&&(this._originDirty=!0),u.notEquals(this._matrix,e)&&(this._transformDirty=!0),this._invisible&&(this._invisible=!1,this._element.style.display=""),this._opacity!==n&&(this._opacity=n,i.style.opacity=n>=1?"0.999999":n),this._transformDirty||this._originDirty||this._sizeDirty){this._sizeDirty&&(this._sizeDirty=!1),this._originDirty&&(s?(this._origin||(this._origin=[0,0]),this._origin[0]=s[0],this._origin[1]=s[1]):this._origin=null,g(i,this._origin),this._originDirty=!1),e||(e=u.identity),this._matrix=e;var o=this._size?u.thenMove(e,[-this._size[0]*s[0],-this._size[1]*s[1],0]):e;f(i,o),this._transformDirty=!1}}},n.prototype.cleanup=function(){this._element&&(this._invisible=!0,this._element.style.display="none")},n.prototype.attach=function(t){this._element=t,s.call(this,t)},n.prototype.detach=function(){var t=this._element;return t&&(o.call(this,t),this._invisible&&(this._invisible=!1,this._element.style.display="")),this._element=null,t},e.exports=n}),define(function(t,i,e){function n(){z.runLoop?(f.step(),window.requestAnimationFrame(n)):S=!1}function s(){for(var t=0;t<g.length;t++)g[t].emit("resize");x.emit("resize")}function o(){window.addEventListener("touchmove",function(t){t.preventDefault()},!0),r()}function r(){return document.body?(document.body.classList.add("famous-root"),void document.documentElement.classList.add("famous-root")):void f.nextTick(r)}function a(t,i){return document.body?void document.body.addEventListener(t,i):void f.nextTick(addEventListener.bind(this,t,i))}function h(t,i){return document.body?(document.body.appendChild(i),void t.emit("resize")):void f.nextTick(h.bind(this,t,i))}var p,c,u=t("./Context"),l=t("./EventHandler"),d=t("./OptionsManager"),f={},g=[],_=[],y=0,m=0,v=[],O=Date.now(),S=!0,b={},x=new l,z={containerType:"div",containerClass:"famous-container",fpsCap:void 0,runLoop:!0,appMode:!0},w=new d(z),E=10;f.step=function(){y++,m=y;var t=Date.now();if(!(c&&c>t-O)){var i=0;p=t-O,O=t,x.emit("prerender");for(var e=_.length;e--;)_.shift()(y);for(;v.length&&Date.now()-t<E;)v.shift().call(this);for(i=0;i<g.length;i++)g[i].update();x.emit("postrender")}},window.requestAnimationFrame(n),window.addEventListener("resize",s,!1),s();var T=!1;f.pipe=function(t){return t.subscribe instanceof Function?t.subscribe(f):x.pipe(t)},f.unpipe=function(t){return t.unsubscribe instanceof Function?t.unsubscribe(f):x.unpipe(t)},f.on=function(t,i){return t in b||(b[t]=x.emit.bind(x,t),a(t,b[t])),x.on(t,i)},f.emit=function(t,i){return x.emit(t,i)},f.removeListener=function(t,i){return x.removeListener(t,i)},f.getFPS=function(){return 1e3/p},f.setFPSCap=function(t){c=Math.floor(1e3/t)},f.getOptions=function(t){return w.getOptions(t)},f.setOptions=function(){return w.setOptions.apply(w,arguments)},f.createContext=function(t){!T&&z.appMode&&f.nextTick(o);var i=!1;t||(t=document.createElement(z.containerType),t.classList.add(z.containerClass),i=!0);var e=new u(t);return f.registerContext(e),i&&h(e,t),e},f.registerContext=function(t){return g.push(t),t},f.getContexts=function(){return g},f.deregisterContext=function(t){var i=g.indexOf(t);i>=0&&g.splice(i,1)},f.nextTick=function(t){_.push(t)},f.defer=function(t){v.push(t)},w.on("change",function(t){"fpsCap"===t.id?f.setFPSCap(t.value):"runLoop"===t.id&&!S&&t.value&&(S=!0,window.requestAnimationFrame(n))}),e.exports=f}),define(function(t,i,e){function n(t){return a[t]}function s(t,i){a[t]=i}function o(t){var i=a.length;return s(i,t),i}function r(t){s(t,null)}var a=[];e.exports={register:o,unregister:r,get:n,set:s}}),define(function(t,i,e){function n(){this.listeners={},this._owner=this}n.prototype.emit=function(t,i){var e=this.listeners[t];if(e)for(var n=0;n<e.length;n++)e[n].call(this._owner,i);return this},n.prototype.on=function(t,i){t in this.listeners||(this.listeners[t]=[]);var e=this.listeners[t].indexOf(i);return 0>e&&this.listeners[t].push(i),this},n.prototype.addListener=n.prototype.on,n.prototype.removeListener=function(t,i){var e=this.listeners[t];if(void 0!==e){var n=e.indexOf(i);n>=0&&e.splice(n,1)}return this},n.prototype.bindThis=function(t){this._owner=t},e.exports=n}),define(function(t,i,e){function n(){s.apply(this,arguments),this.downstream=[],this.downstreamFn=[],this.upstream=[],this.upstreamListeners={}}var s=t("./EventEmitter");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.setInputHandler=function(t,i){t.trigger=i.trigger.bind(i),i.subscribe&&i.unsubscribe&&(t.subscribe=i.subscribe.bind(i),t.unsubscribe=i.unsubscribe.bind(i))},n.setOutputHandler=function(t,i){i instanceof n&&i.bindThis(t),t.pipe=i.pipe.bind(i),t.unpipe=i.unpipe.bind(i),t.on=i.on.bind(i),t.addListener=t.on,t.removeListener=i.removeListener.bind(i)},n.prototype.emit=function(t,i){s.prototype.emit.apply(this,arguments);var e=0;for(e=0;e<this.downstream.length;e++)this.downstream[e].trigger&&this.downstream[e].trigger(t,i);for(e=0;e<this.downstreamFn.length;e++)this.downstreamFn[e](t,i);return this},n.prototype.trigger=n.prototype.emit,n.prototype.pipe=function(t){if(t.subscribe instanceof Function)return t.subscribe(this);var i=t instanceof Function?this.downstreamFn:this.downstream,e=i.indexOf(t);return 0>e&&i.push(t),t instanceof Function?t("pipe",null):t.trigger&&t.trigger("pipe",null),t},n.prototype.unpipe=function(t){if(t.unsubscribe instanceof Function)return t.unsubscribe(this);var i=t instanceof Function?this.downstreamFn:this.downstream,e=i.indexOf(t);return e>=0?(i.splice(e,1),t instanceof Function?t("unpipe",null):t.trigger&&t.trigger("unpipe",null),t):!1},n.prototype.on=function(t){if(s.prototype.on.apply(this,arguments),!(t in this.upstreamListeners)){var i=this.trigger.bind(this,t);this.upstreamListeners[t]=i;for(var e=0;e<this.upstream.length;e++)this.upstream[e].on(t,i)}return this},n.prototype.addListener=n.prototype.on,n.prototype.subscribe=function(t){var i=this.upstream.indexOf(t);if(0>i){this.upstream.push(t);for(var e in this.upstreamListeners)t.on(e,this.upstreamListeners[e])}return this},n.prototype.unsubscribe=function(t){var i=this.upstream.indexOf(t);if(i>=0){this.upstream.splice(i,1);for(var e in this.upstreamListeners)t.removeListener(e,this.upstreamListeners[e])}return this},e.exports=n}),define(function(t,i,e){function n(t){r.call(this,t),this._shouldRecalculateSize=!1,this._container=document.createDocumentFragment(),this.context=new s(this._container),this.setContent(this._container),this._groupSize=[void 0,void 0]}var s=t("./Context"),o=t("./Transform"),r=t("./Surface");n.SIZE_ZERO=[0,0],n.prototype=Object.create(r.prototype),n.prototype.elementType="div",n.prototype.elementClass="famous-group",n.prototype.add=function(){return this.context.add.apply(this.context,arguments)},n.prototype.render=function(){return r.prototype.render.call(this)},n.prototype.deploy=function(t){this.context.migrate(t)},n.prototype.recall=function(){this._container=document.createDocumentFragment(),this.context.migrate(this._container)},n.prototype.commit=function(t){var i=t.transform,e=t.origin,s=t.opacity,a=t.size,h=r.prototype.commit.call(this,{allocator:t.allocator,transform:o.thenMove(i,[-e[0]*a[0],-e[1]*a[1],0]),opacity:s,origin:e,size:n.SIZE_ZERO});return(a[0]!==this._groupSize[0]||a[1]!==this._groupSize[1])&&(this._groupSize[0]=a[0],this._groupSize[1]=a[1],this.context.setSize(a)),this.context.update({transform:o.translate(-e[0]*a[0],-e[1]*a[1],0),origin:e,size:a}),h},e.exports=n}),define(function(t,i,e){function n(t){this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null,this._legacyStates={},this._output={transform:o.identity,opacity:1,origin:null,align:null,size:null,proportions:null,target:null},t&&(t.transform&&this.transformFrom(t.transform),void 0!==t.opacity&&this.opacityFrom(t.opacity),t.origin&&this.originFrom(t.origin),t.align&&this.alignFrom(t.align),t.size&&this.sizeFrom(t.size),t.proportions&&this.proportionsFrom(t.proportions))}function s(){this._transformGetter&&(this._output.transform=this._transformGetter()),this._opacityGetter&&(this._output.opacity=this._opacityGetter()),this._originGetter&&(this._output.origin=this._originGetter()),this._alignGetter&&(this._output.align=this._alignGetter()),this._sizeGetter&&(this._output.size=this._sizeGetter()),this._proportionGetter&&(this._output.proportions=this._proportionGetter())}var o=t("./Transform"),r=t("../transitions/Transitionable"),a=t("../transitions/TransitionableTransform");n.prototype.transformFrom=function(t){return t instanceof Function?this._transformGetter=t:t instanceof Object&&t.get?this._transformGetter=t.get.bind(t):(this._transformGetter=null,this._output.transform=t),this},n.prototype.opacityFrom=function(t){return t instanceof Function?this._opacityGetter=t:t instanceof Object&&t.get?this._opacityGetter=t.get.bind(t):(this._opacityGetter=null,this._output.opacity=t),this},n.prototype.originFrom=function(t){return t instanceof Function?this._originGetter=t:t instanceof Object&&t.get?this._originGetter=t.get.bind(t):(this._originGetter=null,this._output.origin=t),this},n.prototype.alignFrom=function(t){return t instanceof Function?this._alignGetter=t:t instanceof Object&&t.get?this._alignGetter=t.get.bind(t):(this._alignGetter=null,this._output.align=t),this},n.prototype.sizeFrom=function(t){return t instanceof Function?this._sizeGetter=t:t instanceof Object&&t.get?this._sizeGetter=t.get.bind(t):(this._sizeGetter=null,this._output.size=t),this},n.prototype.proportionsFrom=function(t){return t instanceof Function?this._proportionGetter=t:t instanceof Object&&t.get?this._proportionGetter=t.get.bind(t):(this._proportionGetter=null,this._output.proportions=t),this},n.prototype.setTransform=function(t,i,e){return i||this._legacyStates.transform?(this._legacyStates.transform||(this._legacyStates.transform=new a(this._output.transform)),this._transformGetter||this.transformFrom(this._legacyStates.transform),this._legacyStates.transform.set(t,i,e),this):this.transformFrom(t)},n.prototype.setOpacity=function(t,i,e){return i||this._legacyStates.opacity?(this._legacyStates.opacity||(this._legacyStates.opacity=new r(this._output.opacity)),this._opacityGetter||this.opacityFrom(this._legacyStates.opacity),this._legacyStates.opacity.set(t,i,e)):this.opacityFrom(t)
},n.prototype.setOrigin=function(t,i,e){return i||this._legacyStates.origin?(this._legacyStates.origin||(this._legacyStates.origin=new r(this._output.origin||[0,0])),this._originGetter||this.originFrom(this._legacyStates.origin),this._legacyStates.origin.set(t,i,e),this):this.originFrom(t)},n.prototype.setAlign=function(t,i,e){return i||this._legacyStates.align?(this._legacyStates.align||(this._legacyStates.align=new r(this._output.align||[0,0])),this._alignGetter||this.alignFrom(this._legacyStates.align),this._legacyStates.align.set(t,i,e),this):this.alignFrom(t)},n.prototype.setSize=function(t,i,e){return t&&(i||this._legacyStates.size)?(this._legacyStates.size||(this._legacyStates.size=new r(this._output.size||[0,0])),this._sizeGetter||this.sizeFrom(this._legacyStates.size),this._legacyStates.size.set(t,i,e),this):this.sizeFrom(t)},n.prototype.setProportions=function(t,i,e){return t&&(i||this._legacyStates.proportions)?(this._legacyStates.proportions||(this._legacyStates.proportions=new r(this._output.proportions||[0,0])),this._proportionGetter||this.proportionsFrom(this._legacyStates.proportions),this._legacyStates.proportions.set(t,i,e),this):this.proportionsFrom(t)},n.prototype.halt=function(){this._legacyStates.transform&&this._legacyStates.transform.halt(),this._legacyStates.opacity&&this._legacyStates.opacity.halt(),this._legacyStates.origin&&this._legacyStates.origin.halt(),this._legacyStates.align&&this._legacyStates.align.halt(),this._legacyStates.size&&this._legacyStates.size.halt(),this._legacyStates.proportions&&this._legacyStates.proportions.halt(),this._transformGetter=null,this._opacityGetter=null,this._originGetter=null,this._alignGetter=null,this._sizeGetter=null,this._proportionGetter=null},n.prototype.getTransform=function(){return this._transformGetter()},n.prototype.getFinalTransform=function(){return this._legacyStates.transform?this._legacyStates.transform.getFinal():this._output.transform},n.prototype.getOpacity=function(){return this._opacityGetter()},n.prototype.getOrigin=function(){return this._originGetter()},n.prototype.getAlign=function(){return this._alignGetter()},n.prototype.getSize=function(){return this._sizeGetter?this._sizeGetter():this._output.size},n.prototype.getProportions=function(){return this._proportionGetter?this._proportionGetter():this._output.proportions},n.prototype.modify=function(t){return s.call(this),this._output.target=t,this._output},e.exports=n}),define(function(t,i,e){function n(t){this._value=t,this.eventOutput=null}function s(){this.eventOutput=new o,this.eventOutput.bindThis(this),o.setOutputHandler(this,this.eventOutput)}var o=t("./EventHandler");n.patch=function(t){for(var i=new n(t),e=1;e<arguments.length;e++)i.patch(arguments[e]);return t},n.prototype.patch=function(){for(var t=this._value,i=0;i<arguments.length;i++){var e=arguments[i];for(var n in e)n in t&&e[n]&&e[n].constructor===Object&&t[n]&&t[n].constructor===Object?(t.hasOwnProperty(n)||(t[n]=Object.create(t[n])),this.key(n).patch(e[n]),this.eventOutput&&this.eventOutput.emit("change",{id:n,value:this.key(n).value()})):this.set(n,e[n])}return this},n.prototype.setOptions=n.prototype.patch,n.prototype.key=function(t){var i=new n(this._value[t]);return(!(i._value instanceof Object)||i._value instanceof Array)&&(i._value={}),i},n.prototype.get=function(t){return t?this._value[t]:this._value},n.prototype.getOptions=n.prototype.get,n.prototype.set=function(t,i){var e=this.get(t);return this._value[t]=i,this.eventOutput&&i!==e&&this.eventOutput.emit("change",{id:t,value:i}),this},n.prototype.on=function(){return s.call(this),this.on.apply(this,arguments)},n.prototype.removeListener=function(){return s.call(this),this.removeListener.apply(this,arguments)},n.prototype.pipe=function(){return s.call(this),this.pipe.apply(this,arguments)},n.prototype.unpipe=function(){return s.call(this),this.unpipe.apply(this,arguments)},e.exports=n}),define(function(t,i,e){function n(t){this._object=null,this._child=null,this._hasMultipleChildren=!1,this._isRenderable=!1,this._isModifier=!1,this._resultCache={},this._prevResults={},this._childResult=null,t&&this.set(t)}function s(t,i,e){for(var n=r.parse(t,i),a=Object.keys(n),h=0;h<a.length;h++){var p=a[h],c=o.get(p),u=n[p];u.allocator=i.allocator;var l=c.commit(u);l?s(l,i,e):e[p]=u}}var o=t("./Entity"),r=t("./SpecParser");n.prototype.add=function(t){var i=t instanceof n?t:new n(t);return this._child instanceof Array?this._child.push(i):this._child?(this._child=[this._child,i],this._hasMultipleChildren=!0,this._childResult=[]):this._child=i,i},n.prototype.get=function(){return this._object||(this._hasMultipleChildren?null:this._child?this._child.get():null)},n.prototype.set=function(t){return this._childResult=null,this._hasMultipleChildren=!1,this._isRenderable=t.render?!0:!1,this._isModifier=t.modify?!0:!1,this._object=t,this._child=null,t instanceof n?t:this},n.prototype.getSize=function(){var t=null,i=this.get();return i&&i.getSize&&(t=i.getSize()),!t&&this._child&&this._child.getSize&&(t=this._child.getSize()),t},n.prototype.commit=function(t){for(var i=Object.keys(this._prevResults),e=0;e<i.length;e++){var n=i[e];if(void 0===this._resultCache[n]){var r=o.get(n);r.cleanup&&r.cleanup(t.allocator)}}this._prevResults=this._resultCache,this._resultCache={},s(this.render(),t,this._resultCache)},n.prototype.render=function(){if(this._isRenderable)return this._object.render();var t=null;if(this._hasMultipleChildren){t=this._childResult;for(var i=this._child,e=0;e<i.length;e++)t[e]=i[e].render()}else this._child&&(t=this._child.render());return this._isModifier?this._object.modify(t):t},e.exports=n}),define(function(t,i,e){function n(t){this.id=null,this._objects=null,this.node=new c,this._definition=null,t&&this.load(t)}function s(t){for(var i in u)if(i in t){var e=t[i];return e instanceof Array||(e=[e]),u[i].apply(this,e)}}function o(t){var i=t.transform,e=t.opacity,n=t.origin,o=t.align,r=t.size,a=h.identity;if(i instanceof Array)if(16===i.length&&"number"==typeof i[0])a=i;else for(var c=0;c<i.length;c++)a=h.multiply(a,s(i[c]));else i instanceof Function?a=i:i instanceof Object&&(a=s(i));var u=new p({transform:a,opacity:e,origin:n,align:o,size:r});return u}function r(t){for(var i=new c,e=0;e<t.length;e++){var n=a.call(this,t[e]);n&&i.add(n)}return i}function a(t){var i,e;if(t instanceof Array)i=r.call(this,t);else if(e=this._objects.length,t.render&&t.render instanceof Function)i=t;else if(t.target){var n=a.call(this,t.target),s=o.call(this,t);i=new c(s),i.add(n),t.id&&(this.id[t.id]=s)}else t.id&&(i=new c,this.id[t.id]=i);return this._objects[e]=i,i}var h=t("./Transform"),p=t("./Modifier"),c=t("./RenderNode"),u={translate:h.translate,rotate:h.rotate,rotateX:h.rotateX,rotateY:h.rotateY,rotateZ:h.rotateZ,rotateAxis:h.rotateAxis,scale:h.scale,skew:h.skew,matrix3d:function(){return arguments}};n.prototype.create=function(){return new n(this._definition)},n.prototype.load=function(t){this._definition=t,this.id={},this._objects=[],this.node.set(a.call(this,t))},n.prototype.add=function(){return this.node.add.apply(this.node,arguments)},n.prototype.render=function(){return this.node.render.apply(this.node,arguments)},e.exports=n}),define(function(t,i,e){function n(){this.result={}}function s(t,i){return[t[0]*i[0]+t[1]*i[4]+t[2]*i[8],t[0]*i[1]+t[1]*i[5]+t[2]*i[9],t[0]*i[2]+t[1]*i[6]+t[2]*i[10]]}var o=t("./Transform");n._instance=new n,n.parse=function(t,i){return n._instance.parse(t,i)},n.prototype.parse=function(t,i){return this.reset(),this._parseSpec(t,i,o.identity),this.result},n.prototype.reset=function(){this.result={}};var r=[0,0];n.prototype._parseSpec=function(t,i,e){var n,a,h,p,c,u,l;if("number"==typeof t){if(n=t,h=i.transform,u=i.align||r,i.size&&u&&(u[0]||u[1])){var d=[u[0]*i.size[0],u[1]*i.size[1],0];h=o.thenMove(h,s(d,e))}this.result[n]={transform:h,opacity:i.opacity,origin:i.origin||r,align:i.align||r,size:i.size}}else{if(!t)return;if(t instanceof Array)for(var f=0;f<t.length;f++)this._parseSpec(t[f],i,e);else{a=t.target,h=i.transform,p=i.opacity,c=i.origin,u=i.align,l=i.size;var g=e;if(void 0!==t.opacity&&(p=i.opacity*t.opacity),t.transform&&(h=o.multiply(i.transform,t.transform)),t.origin&&(c=t.origin,g=i.transform),t.align&&(u=t.align),t.size||t.proportions){var _=l;l=[l[0],l[1]],t.size&&(void 0!==t.size[0]&&(l[0]=t.size[0]),void 0!==t.size[1]&&(l[1]=t.size[1])),t.proportions&&(void 0!==t.proportions[0]&&(l[0]=l[0]*t.proportions[0]),void 0!==t.proportions[1]&&(l[1]=l[1]*t.proportions[1])),_&&(u&&(u[0]||u[1])&&(h=o.thenMove(h,s([u[0]*_[0],u[1]*_[1],0],e))),c&&(c[0]||c[1])&&(h=o.moveThen([-c[0]*l[0],-c[1]*l[1],0],h))),g=i.transform,c=null,u=null}this._parseSpec(a,{transform:h,opacity:p,origin:c,align:u,size:l},g)}}},e.exports=n}),define(function(t,i,e){function n(t){c.call(this),this.options={},this.properties={},this.attributes={},this.content="",this.classList=[],this.size=null,this._classesDirty=!0,this._stylesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._trueSizeCheck=!0,this._dirtyClasses=[],t&&this.setOptions(t),this._currentTarget=null}function s(t){for(var i=0;i<this._dirtyClasses.length;i++)t.classList.remove(this._dirtyClasses[i]);this._dirtyClasses=[]}function o(t){for(var i in this.properties)t.style[i]=this.properties[i]}function r(t){for(var i in this.properties)t.style[i]=""}function a(t){for(var i in this.attributes)t.setAttribute(i,this.attributes[i])}function h(t){for(var i in this.attributes)t.removeAttribute(i)}function p(t,i){return t&&i?t[0]!==i[0]||t[1]!==i[1]:t!==i}var c=t("./ElementOutput");n.prototype=Object.create(c.prototype),n.prototype.constructor=n,n.prototype.elementType="div",n.prototype.elementClass="famous-surface",n.prototype.setAttributes=function(t){for(var i in t){if("style"===i)throw new Error('Cannot set styles via "setAttributes" as it will break Famo.us.  Use "setProperties" instead.');this.attributes[i]=t[i]}this._attributesDirty=!0},n.prototype.getAttributes=function(){return this.attributes},n.prototype.setProperties=function(t){for(var i in t)this.properties[i]=t[i];return this._stylesDirty=!0,this},n.prototype.getProperties=function(){return this.properties},n.prototype.addClass=function(t){return this.classList.indexOf(t)<0&&(this.classList.push(t),this._classesDirty=!0),this},n.prototype.removeClass=function(t){var i=this.classList.indexOf(t);return i>=0&&(this._dirtyClasses.push(this.classList.splice(i,1)[0]),this._classesDirty=!0),this},n.prototype.toggleClass=function(t){var i=this.classList.indexOf(t);return i>=0?this.removeClass(t):this.addClass(t),this},n.prototype.setClasses=function(t){var i=0,e=[];for(i=0;i<this.classList.length;i++)t.indexOf(this.classList[i])<0&&e.push(this.classList[i]);for(i=0;i<e.length;i++)this.removeClass(e[i]);for(i=0;i<t.length;i++)this.addClass(t[i]);return this},n.prototype.getClassList=function(){return this.classList},n.prototype.setContent=function(t){return this.content!==t&&(this.content=t,this._contentDirty=!0),this},n.prototype.getContent=function(){return this.content},n.prototype.setOptions=function(t){return t.size&&this.setSize(t.size),t.classes&&this.setClasses(t.classes),t.properties&&this.setProperties(t.properties),t.attributes&&this.setAttributes(t.attributes),t.content&&this.setContent(t.content),this},n.prototype.setup=function(t){var i=t.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var e=0;e<this.elementClass.length;e++)i.classList.add(this.elementClass[e]);else i.classList.add(this.elementClass);i.style.display="",this.attach(i),this._opacity=null,this._currentTarget=i,this._stylesDirty=!0,this._classesDirty=!0,this._attributesDirty=!0,this._sizeDirty=!0,this._contentDirty=!0,this._originDirty=!0,this._transformDirty=!0},n.prototype.commit=function(t){this._currentTarget||this.setup(t.allocator);var i=this._currentTarget,e=t.size;if(this._classesDirty){s.call(this,i);for(var n=this.getClassList(),r=0;r<n.length;r++)i.classList.add(n[r]);this._classesDirty=!1,this._trueSizeCheck=!0}if(this._stylesDirty&&(o.call(this,i),this._stylesDirty=!1,this._trueSizeCheck=!0),this._attributesDirty&&(a.call(this,i),this._attributesDirty=!1,this._trueSizeCheck=!0),this.size){var h=t.size;if(e=[this.size[0],this.size[1]],void 0===e[0]&&(e[0]=h[0]),void 0===e[1]&&(e[1]=h[1]),e[0]===!0||e[1]===!0){if(e[0]===!0)if(this._trueSizeCheck||0===this._size[0]){var u=i.offsetWidth;this._size&&this._size[0]!==u&&(this._size[0]=u,this._sizeDirty=!0),e[0]=u}else this._size&&(e[0]=this._size[0]);if(e[1]===!0)if(this._trueSizeCheck||0===this._size[1]){var l=i.offsetHeight;this._size&&this._size[1]!==l&&(this._size[1]=l,this._sizeDirty=!0),e[1]=l}else this._size&&(e[1]=this._size[1]);this._trueSizeCheck=!1}}p(this._size,e)&&(this._size||(this._size=[0,0]),this._size[0]=e[0],this._size[1]=e[1],this._sizeDirty=!0),this._sizeDirty&&(this._size&&(i.style.width=this.size&&this.size[0]===!0?"":this._size[0]+"px",i.style.height=this.size&&this.size[1]===!0?"":this._size[1]+"px"),this._eventOutput.emit("resize")),this._contentDirty&&(this.deploy(i),this._eventOutput.emit("deploy"),this._contentDirty=!1,this._trueSizeCheck=!0),c.prototype.commit.call(this,t)},n.prototype.cleanup=function(t){var i=0,e=this._currentTarget;this._eventOutput.emit("recall"),this.recall(e),e.style.display="none",e.style.opacity="",e.style.width="",e.style.height="",r.call(this,e),h.call(this,e);var n=this.getClassList();for(s.call(this,e),i=0;i<n.length;i++)e.classList.remove(n[i]);if(this.elementClass)if(this.elementClass instanceof Array)for(i=0;i<this.elementClass.length;i++)e.classList.remove(this.elementClass[i]);else e.classList.remove(this.elementClass);this.detach(e),this._currentTarget=null,t.deallocate(e)},n.prototype.deploy=function(t){var i=this.getContent();if(i instanceof Node){for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(i)}else t.innerHTML=i},n.prototype.recall=function(t){for(var i=document.createDocumentFragment();t.hasChildNodes();)i.appendChild(t.firstChild);this.setContent(i)},n.prototype.getSize=function(){return this._size?this._size:this.size},n.prototype.setSize=function(t){return this.size=t?[t[0],t[1]]:null,this._sizeDirty=!0,this},e.exports=n}),define(function(t,i,e){function n(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function s(t){return Math.sqrt(n(t))}function o(t){return 0>t?-1:1}var r={};r.precision=1e-6,r.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.multiply4x4=function(t,i){return[t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12]*i[3],t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13]*i[3],t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14]*i[3],t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15]*i[3],t[0]*i[4]+t[4]*i[5]+t[8]*i[6]+t[12]*i[7],t[1]*i[4]+t[5]*i[5]+t[9]*i[6]+t[13]*i[7],t[2]*i[4]+t[6]*i[5]+t[10]*i[6]+t[14]*i[7],t[3]*i[4]+t[7]*i[5]+t[11]*i[6]+t[15]*i[7],t[0]*i[8]+t[4]*i[9]+t[8]*i[10]+t[12]*i[11],t[1]*i[8]+t[5]*i[9]+t[9]*i[10]+t[13]*i[11],t[2]*i[8]+t[6]*i[9]+t[10]*i[10]+t[14]*i[11],t[3]*i[8]+t[7]*i[9]+t[11]*i[10]+t[15]*i[11],t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12]*i[15],t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13]*i[15],t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14]*i[15],t[3]*i[12]+t[7]*i[13]+t[11]*i[14]+t[15]*i[15]]},r.multiply=function(t,i){return[t[0]*i[0]+t[4]*i[1]+t[8]*i[2],t[1]*i[0]+t[5]*i[1]+t[9]*i[2],t[2]*i[0]+t[6]*i[1]+t[10]*i[2],0,t[0]*i[4]+t[4]*i[5]+t[8]*i[6],t[1]*i[4]+t[5]*i[5]+t[9]*i[6],t[2]*i[4]+t[6]*i[5]+t[10]*i[6],0,t[0]*i[8]+t[4]*i[9]+t[8]*i[10],t[1]*i[8]+t[5]*i[9]+t[9]*i[10],t[2]*i[8]+t[6]*i[9]+t[10]*i[10],0,t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12],t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13],t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14],1]},r.thenMove=function(t,i){return i[2]||(i[2]=0),[t[0],t[1],t[2],0,t[4],t[5],t[6],0,t[8],t[9],t[10],0,t[12]+i[0],t[13]+i[1],t[14]+i[2],1]},r.moveThen=function(t,i){t[2]||(t[2]=0);var e=t[0]*i[0]+t[1]*i[4]+t[2]*i[8],n=t[0]*i[1]+t[1]*i[5]+t[2]*i[9],s=t[0]*i[2]+t[1]*i[6]+t[2]*i[10];return r.thenMove(i,[e,n,s])},r.translate=function(t,i,e){return void 0===e&&(e=0),[1,0,0,0,0,1,0,0,0,0,1,0,t,i,e,1]},r.thenScale=function(t,i){return[i[0]*t[0],i[1]*t[1],i[2]*t[2],0,i[0]*t[4],i[1]*t[5],i[2]*t[6],0,i[0]*t[8],i[1]*t[9],i[2]*t[10],0,i[0]*t[12],i[1]*t[13],i[2]*t[14],1]},r.scale=function(t,i,e){return void 0===e&&(e=1),void 0===i&&(i=t),[t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1]},r.rotateX=function(t){var i=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,i,e,0,0,-e,i,0,0,0,0,1]},r.rotateY=function(t){var i=Math.cos(t),e=Math.sin(t);return[i,0,-e,0,0,1,0,0,e,0,i,0,0,0,0,1]},r.rotateZ=function(t){var i=Math.cos(t),e=Math.sin(t);return[i,e,0,0,-e,i,0,0,0,0,1,0,0,0,0,1]},r.rotate=function(t,i,e){var n=Math.cos(t),s=Math.sin(t),o=Math.cos(i),r=Math.sin(i),a=Math.cos(e),h=Math.sin(e),p=[o*a,n*h+s*r*a,s*h-n*r*a,0,-o*h,n*a-s*r*h,s*a+n*r*h,0,r,-s*o,n*o,0,0,0,0,1];return p},r.rotateAxis=function(t,i){var e=Math.sin(i),n=Math.cos(i),s=1-n,o=t[0]*t[0]*s,r=t[0]*t[1]*s,a=t[0]*t[2]*s,h=t[1]*t[1]*s,p=t[1]*t[2]*s,c=t[2]*t[2]*s,u=t[0]*e,l=t[1]*e,d=t[2]*e,f=[o+n,r+d,a-l,0,r-d,h+n,p+u,0,a+l,p-u,c+n,0,0,0,0,1];return f},r.aboutOrigin=function(t,i){var e=t[0]-(t[0]*i[0]+t[1]*i[4]+t[2]*i[8]),n=t[1]-(t[0]*i[1]+t[1]*i[5]+t[2]*i[9]),s=t[2]-(t[0]*i[2]+t[1]*i[6]+t[2]*i[10]);return r.thenMove(i,[e,n,s])},r.skew=function(t,i,e){return[1,Math.tan(i),0,0,Math.tan(e),1,0,0,0,Math.tan(t),1,0,0,0,0,1]},r.skewX=function(t){return[1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]},r.skewY=function(t){return[1,Math.tan(t),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},r.perspective=function(t){return[1,0,0,0,0,1,0,0,0,0,1,-1/t,0,0,0,1]},r.getTranslate=function(t){return[t[12],t[13],t[14]]},r.inverse=function(t){var i=t[5]*t[10]-t[6]*t[9],e=t[4]*t[10]-t[6]*t[8],n=t[4]*t[9]-t[5]*t[8],s=t[1]*t[10]-t[2]*t[9],o=t[0]*t[10]-t[2]*t[8],r=t[0]*t[9]-t[1]*t[8],a=t[1]*t[6]-t[2]*t[5],h=t[0]*t[6]-t[2]*t[4],p=t[0]*t[5]-t[1]*t[4],c=t[0]*i-t[1]*e+t[2]*n,u=1/c,l=[u*i,-u*s,u*a,0,-u*e,u*o,-u*h,0,u*n,-u*r,u*p,0,0,0,0,1];return l[12]=-t[12]*l[0]-t[13]*l[4]-t[14]*l[8],l[13]=-t[12]*l[1]-t[13]*l[5]-t[14]*l[9],l[14]=-t[12]*l[2]-t[13]*l[6]-t[14]*l[10],l},r.transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},r.interpret=function(t){var i=[t[0],t[1],t[2]],e=o(i[0]),a=s(i),h=[i[0]+e*a,i[1],i[2]],p=2/n(h);if(p>=1/0)return{translate:r.getTranslate(t),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];c[0]=1-p*h[0]*h[0],c[5]=1-p*h[1]*h[1],c[10]=1-p*h[2]*h[2],c[1]=-p*h[0]*h[1],c[2]=-p*h[0]*h[2],c[6]=-p*h[1]*h[2],c[4]=c[1],c[8]=c[2],c[9]=c[6];var u=r.multiply(c,t),l=[u[5],u[6]],d=o(l[0]),f=s(l),g=[l[0]+d*f,l[1]],_=2/n(g),y=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];y[5]=1-_*g[0]*g[0],y[10]=1-_*g[1]*g[1],y[6]=-_*g[0]*g[1],y[9]=y[6];var m=r.multiply(y,c),v=r.multiply(m,t),O=r.scale(v[0]<0?-1:1,v[5]<0?-1:1,v[10]<0?-1:1);v=r.multiply(v,O),m=r.multiply(O,m);var S={};return S.translate=r.getTranslate(t),S.rotate=[Math.atan2(-m[6],m[10]),Math.asin(m[2]),Math.atan2(-m[1],m[0])],S.rotate[0]||(S.rotate[0]=0,S.rotate[2]=Math.atan2(m[4],m[5])),S.scale=[v[0],v[5],v[10]],S.skew=[Math.atan2(v[9],S.scale[2]),Math.atan2(v[8],S.scale[2]),Math.atan2(v[4],S.scale[0])],Math.abs(S.rotate[0])+Math.abs(S.rotate[2])>1.5*Math.PI&&(S.rotate[1]=Math.PI-S.rotate[1],S.rotate[1]>Math.PI&&(S.rotate[1]-=2*Math.PI),S.rotate[1]<-Math.PI&&(S.rotate[1]+=2*Math.PI),S.rotate[0]<0?S.rotate[0]+=Math.PI:S.rotate[0]-=Math.PI,S.rotate[2]<0?S.rotate[2]+=Math.PI:S.rotate[2]-=Math.PI),S},r.average=function(t,i,e){e=void 0===e?.5:e;for(var n=r.interpret(t),s=r.interpret(i),o={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},a=0;3>a;a++)o.translate[a]=(1-e)*n.translate[a]+e*s.translate[a],o.rotate[a]=(1-e)*n.rotate[a]+e*s.rotate[a],o.scale[a]=(1-e)*n.scale[a]+e*s.scale[a],o.skew[a]=(1-e)*n.skew[a]+e*s.skew[a];return r.build(o)},r.build=function(t){var i=r.scale(t.scale[0],t.scale[1],t.scale[2]),e=r.skew(t.skew[0],t.skew[1],t.skew[2]),n=r.rotate(t.rotate[0],t.rotate[1],t.rotate[2]);return r.thenMove(r.multiply(r.multiply(n,e),i),t.translate)},r.equals=function(t,i){return!r.notEquals(t,i)},r.notEquals=function(t,i){return t===i?!1:!(t&&i)||t[12]!==i[12]||t[13]!==i[13]||t[14]!==i[14]||t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[4]!==i[4]||t[5]!==i[5]||t[6]!==i[6]||t[8]!==i[8]||t[9]!==i[9]||t[10]!==i[10]},r.normalizeRotation=function(t){var i=t.slice(0);for((i[0]===.5*Math.PI||i[0]===.5*-Math.PI)&&(i[0]=-i[0],i[1]=Math.PI-i[1],i[2]-=Math.PI),i[0]>.5*Math.PI&&(i[0]=i[0]-Math.PI,i[1]=Math.PI-i[1],i[2]-=Math.PI),i[0]<.5*-Math.PI&&(i[0]=i[0]+Math.PI,i[1]=-Math.PI-i[1],i[2]-=Math.PI);i[1]<-Math.PI;)i[1]+=2*Math.PI;for(;i[1]>=Math.PI;)i[1]-=2*Math.PI;for(;i[2]<-Math.PI;)i[2]+=2*Math.PI;for(;i[2]>=Math.PI;)i[2]-=2*Math.PI;return i},r.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,.001,1],r.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-.001,1],e.exports=r}),define(function(t,i,e){function n(t){this._node=new r,this._eventInput=new s,this._eventOutput=new s,s.setInputHandler(this,this._eventInput),s.setOutputHandler(this,this._eventOutput),this.options=a.clone(this.constructor.DEFAULT_OPTIONS||n.DEFAULT_OPTIONS),this._optionsManager=new o(this.options),t&&this.setOptions(t)}var s=t("./EventHandler"),o=t("./OptionsManager"),r=t("./RenderNode"),a=t("../utilities/Utility");n.DEFAULT_OPTIONS={},n.prototype.getOptions=function(t){return this._optionsManager.getOptions(t)},n.prototype.setOptions=function(t){this._optionsManager.patch(t)},n.prototype.add=function(){return this._node.add.apply(this._node,arguments)},n.prototype._add=n.prototype.add,n.prototype.render=function(){return this._node.render()},n.prototype.getSize=function(){return this._node&&this._node.getSize?this._node.getSize.apply(this._node,arguments)||this.options.size:this.options.size},e.exports=n}),define(function(t,i,e){function n(t){t||(t=[]),t instanceof Array&&(t={array:t}),this._=null,this.index=t.index||0,t.array?this._=new this.constructor.Backing(t.array):t._&&(this._=t._),this.index===this._.firstIndex&&(this._.firstNode=this),this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),void 0!==t.loop&&(this._.loop=t.loop),void 0!==t.trackSize&&(this._.trackSize=t.trackSize),this._previousNode=null,this._nextNode=null}n.Backing=function(t){this.array=t,this.firstIndex=0,this.loop=!1,this.firstNode=null,this.lastNode=null,this.cumulativeSizes=[[0,0]],this.sizeDirty=!0,this.trackSize=!1},n.Backing.prototype.getValue=function(t){var i=t-this.firstIndex;return 0>i||i>=this.array.length?null:this.array[i]},n.Backing.prototype.setValue=function(t,i){this.array[t-this.firstIndex]=i},n.Backing.prototype.getSize=function(t){return this.cumulativeSizes[t]},n.Backing.prototype.calculateSize=function(t){t=t||this.array.length;for(var i=[0,0],e=0;t>e;e++){var n=this.array[e].getSize();if(!n)return void 0;void 0!==i[0]&&(void 0===n[0]?i[0]=void 0:i[0]+=n[0]),void 0!==i[1]&&(void 0===n[1]?i[1]=void 0:i[1]+=n[1]),this.cumulativeSizes[e+1]=i.slice()}return this.sizeDirty=!1,i},n.Backing.prototype.reindex=function(t,i,e){if(this.array[0]){for(var n=0,s=this.firstIndex,o=e-i,r=this.firstNode;t-1>s;)r=r.getNext(),s++;var a=r;for(n=0;i>n;n++)r=r.getNext(),r&&(r._previousNode=a);var h=r?r.getNext():null;for(a._nextNode=null,r=a,n=0;e>n;n++)r=r.getNext();if(s+=e,r!==h&&(r._nextNode=h,h&&(h._previousNode=r)),h)for(r=h,s++;r&&s<this.array.length+this.firstIndex;)r._nextNode?r.index+=o:r.index=s,r=r.getNext(),s++;this.trackSize&&(this.sizeDirty=!0)}},n.prototype.getPrevious=function(){var t=this._.array.length;return t?this.index===this._.firstIndex?this._.loop?(this._previousNode=this._.lastNode||new this.constructor({_:this._,index:this._.firstIndex+t-1}),this._previousNode._nextNode=this):this._previousNode=null:this._previousNode||(this._previousNode=new this.constructor({_:this._,index:this.index-1}),this._previousNode._nextNode=this):this._previousNode=null,this._previousNode},n.prototype.getNext=function(){var t=this._.array.length;return t?this.index===this._.firstIndex+t-1?this._.loop?(this._nextNode=this._.firstNode||new this.constructor({_:this._,index:this._.firstIndex}),this._nextNode._previousNode=this):this._nextNode=null:this._nextNode||(this._nextNode=new this.constructor({_:this._,index:this.index+1}),this._nextNode._previousNode=this):this._nextNode=null,this._nextNode},n.prototype.indexOf=function(t){return this._.array.indexOf(t)},n.prototype.getIndex=function(){return this.index},n.prototype.toString=function(){return""+this.index},n.prototype.unshift=function(){this._.array.unshift.apply(this._.array,arguments),this._.firstIndex-=arguments.length,this._.trackSize&&(this._.sizeDirty=!0)},n.prototype.push=function(){this._.array.push.apply(this._.array,arguments),this._.trackSize&&(this._.sizeDirty=!0)},n.prototype.splice=function(t,i){var e=Array.prototype.slice.call(arguments,2);this._.array.splice.apply(this._.array,[t-this._.firstIndex,i].concat(e)),this._.reindex(t,i,e.length)},n.prototype.swap=function(t){var i=t.get(),e=this.get();this._.setValue(this.index,i),this._.setValue(t.index,e);var n=this._previousNode,s=this._nextNode,o=this.index,r=t._previousNode,a=t._nextNode,h=t.index;this.index=h,this._previousNode=r===this?t:r,this._previousNode&&(this._previousNode._nextNode=this),this._nextNode=a===this?t:a,this._nextNode&&(this._nextNode._previousNode=this),t.index=o,t._previousNode=n===t?this:n,t._previousNode&&(t._previousNode._nextNode=t),t._nextNode=s===t?this:s,t._nextNode&&(t._nextNode._previousNode=t),this.index===this._.firstIndex?this._.firstNode=this:this.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=this),t.index===this._.firstIndex?this._.firstNode=t:t.index===this._.firstIndex+this._.array.length-1&&(this._.lastNode=t),this._.trackSize&&(this._.sizeDirty=!0)},n.prototype.get=function(){return this._.getValue(this.index)},n.prototype.getSize=function(){var t=this.get();return t?t.getSize():null},n.prototype.render=function(){this._.trackSize&&this._.sizeDirty&&this._.calculateSize();var t=this.get();return t?t.render.apply(t,arguments):null},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS||n.DEFAULT_OPTIONS),this._optionsManager=new r(this.options),t&&this.setOptions(t),this._eventInput=new o,this._eventOutput=new o,o.setInputHandler(this,this._eventInput),o.setOutputHandler(this,this._eventOutput),this._id=s.register(this)}var s=t("../core/Entity"),o=(t("../core/Transform"),t("../core/EventHandler")),r=t("../core/OptionsManager");n.DEFAULT_OPTIONS={},n.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},n.prototype.getOptions=function(t){return this._optionsManager.getOptions(t)},n.prototype.render=function(){return this._id},n.prototype.commit=function(){},e.exports=n}),define(function(t,i,e){function n(){c.apply(this,arguments),this.state=new h(0),this._isOpen=!1,this.setOutputFunction(function(t,i,e){var n=s.call(this),o=this.options.direction===p.Direction.X?r.translate(n*i,0,.001*(n-1)*i):r.translate(0,n*i,.001*(n-1)*i),a=t.render();if(this.options.stackRotation){var h=this.options.stackRotation*e*(1-n);a={transform:r.rotateZ(h),origin:[.5,.5],target:a}}return{transform:o,size:t.getSize(),target:a}})}function s(t){return t?this._isOpen?1:0:this.state.get()}function o(t,i,e){this.state.halt(),this.state.set(t,i,e)}var r=t("../core/Transform"),a=t("../core/OptionsManager"),h=t("../transitions/Transitionable"),p=t("../utilities/Utility"),c=t("./SequentialLayout");n.prototype=Object.create(c.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS=a.patch(c.DEFAULT_OPTIONS,{transition:{curve:"easeOutBounce",duration:500},stackRotation:0}),n.prototype.getSize=function(){var t=c.prototype.getSize.apply(this,arguments),i=this._items?this._items.get().getSize():[0,0];i||(i=[0,0]);var e=s.call(this),n=1-e;return[i[0]*n+t[0]*e,i[1]*n+t[1]*e]},n.prototype.isOpen=function(){return this._isOpen},n.prototype.open=function(t){this._isOpen=!0,o.call(this,1,this.options.transition,t)},n.prototype.close=function(t){this._isOpen=!1,o.call(this,0,this.options.transition,t)},n.prototype.toggle=function(t){this._isOpen?this.close(t):this.open(t)},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new u(this.options),t&&this.setOptions(t),this._position=new l(0),this._direction=s(this.options.side),this._orientation=o(this.options.side),this._isOpen=!1,this._cachedLength=0,this.drawer=new p,this.content=new p,this._eventInput=new d,this._eventOutput=new d,d.setInputHandler(this,this._eventInput),d.setOutputHandler(this,this._eventOutput),this._eventInput.on("update",a.bind(this)),this._eventInput.on("end",h.bind(this))}function s(t){var i=n.SIDES;return t===i.LEFT||t===i.RIGHT?f:g}function o(t){var i=n.SIDES;return t===i.LEFT||t===i.TOP?1:-1}function r(t){var i,e=this.options;if(e.drawerLength)i=e.drawerLength;else{var n=t.getSize();i=n?n[this._direction]:e.drawerLength}return this._orientation*i}function a(t){var i,e,n=this.getPosition()+t.delta;this._cachedLength=r.call(this,this.drawer),1===this._orientation?(i=0,e=this._cachedLength):(i=this._cachedLength,e=0),n>e?n=e:i>n&&(n=i),this.setPosition(n)}function h(t){var i=t.velocity,e=this._orientation*this.getPosition(),n=this.options,s=this._orientation*this._cachedLength,o=n.positionThreshold||s/2,r=n.velocityThreshold;if(n.transition instanceof Object&&(n.transition.velocity=t.velocity),0===e)return void(this._isOpen=!1);if(e===s)return void(this._isOpen=!0);var a=Math.abs(i)>r||!this._isOpen&&e>o||this._isOpen&&o>e;a?this.toggle():this.reset()}var p=t("../core/RenderNode"),c=t("../core/Transform"),u=t("../core/OptionsManager"),l=t("../transitions/Transitionable"),d=t("../core/EventHandler"),f=0,g=1;n.SIDES={LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},n.DEFAULT_OPTIONS={side:n.SIDES.LEFT,drawerLength:0,velocityThreshold:0,positionThreshold:0,transition:!0},n.prototype.setOptions=function(t){this._optionsManager.setOptions(t),void 0!==t.side&&(this._direction=s(t.side),this._orientation=o(t.side))},n.prototype.open=function(t,i){t instanceof Function&&(i=t),void 0===t&&(t=this.options.transition),this._cachedLength=r.call(this,this.drawer),this.setPosition(this._cachedLength,t,i),this._isOpen||(this._isOpen=!0,this._eventOutput.emit("open"))},n.prototype.close=function(t,i){t instanceof Function&&(i=t),void 0===t&&(t=this.options.transition),this.setPosition(0,t,i),this._isOpen&&(this._isOpen=!1,this._eventOutput.emit("close"))},n.prototype.setPosition=function(t,i,e){this._position.isActive()&&this._position.halt(),this._position.set(t,i,e)},n.prototype.getPosition=function(){return this._position.get()},n.prototype.setProgress=function(t,i,e){return this._position.set(t*this._cachedLength,i,e)},n.prototype.getProgress=function(){return this._position.get()/this._cachedLength},n.prototype.toggle=function(t){this._isOpen?this.close(t):this.open(t)},n.prototype.reset=function(t){this._isOpen?this.open(t):this.close(t)},n.prototype.isOpen=function(){return this._isOpen},n.prototype.render=function(){var t=this.getPosition();(!this._isOpen&&0>t&&1===this._orientation||t>0&&-1===this._orientation)&&(t=0,this.setPosition(t));var i=this._direction===f?c.translate(t,0,0):c.translate(0,t,0);return[{transform:c.behind,target:this.drawer.render()},{transform:i,target:this.content.render()}]},e.exports=n}),define(function(t,i,e){function n(t){this._currentTarget=null,this._size=[void 0,void 0],this._controller=new p(t),this._controller.inTransformFrom(o.create(s.bind(this,1e-4))),this._controller.outTransformFrom(o.create(s.bind(this,-1e-4))),this._eventInput=new a,a.setInputHandler(this,this._eventInput),this._entityId=r.register(this),t&&this.setOptions(t)}function s(t,i){return h.translate(this._size[0]*(1-i),0,t*(1-i))}var o=t("../transitions/CachedMap"),r=t("../core/Entity"),a=t("../core/EventHandler"),h=t("../core/Transform"),p=t("./RenderController");n.prototype.show=function(t){this._currentTarget&&this._eventInput.unpipe(this._currentTarget),this._currentTarget=t,this._currentTarget&&this._currentTarget.trigger&&this._eventInput.pipe(this._currentTarget),this._controller.show.apply(this._controller,arguments)
},n.prototype.setOptions=function(t){this._controller.setOptions(t)},n.prototype.render=function(){return this._entityId},n.prototype.commit=function(t){return this._size[0]=t.size[0],this._size[1]=t.size[1],{transform:t.transform,opacity:t.opacity,origin:t.origin,size:t.size,target:this._controller.render()}},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this.optionsManager=new h(this.options),t&&this.setOptions(t),this.id=r.register(this),this._ratios=new c(this.options.ratios),this._nodes=[],this._size=[0,0],this._cachedDirection=null,this._cachedLengths=[],this._cachedTransforms=null,this._ratiosDirty=!1,this._eventOutput=new p,p.setOutputHandler(this,this._eventOutput)}function s(t,i,e){var s,o,r,h,p=0,c=i,u=0;for(this._cachedLengths=[],this._cachedTransforms=[],h=0;h<t.length;h++)o=t[h],r=this._nodes[h],"number"!=typeof o?c-=r.getSize()[e]||0:u+=o;for(h=0;h<t.length;h++)r=this._nodes[h],o=t[h],i="number"==typeof o?c*o/u:r.getSize()[e],s=e===n.DIRECTION_X?a.translate(p,0,0):a.translate(0,p,0),this._cachedTransforms.push(s),this._cachedLengths.push(i),p+=i}function o(t,i){for(var e=0;e<t.length;e++)if("number"!=typeof t[e]&&this._nodes[e].getSize()[i]!==this._cachedLengths[e])return!0;return!1}var r=t("../core/Entity"),a=t("../core/Transform"),h=t("../core/OptionsManager"),p=t("../core/EventHandler"),c=t("../transitions/Transitionable");n.DIRECTION_X=0,n.DIRECTION_Y=1,n.DEFAULT_OPTIONS={direction:n.DIRECTION_X,transition:!1,ratios:[]},n.prototype.render=function(){return this.id},n.prototype.setOptions=function(t){this.optionsManager.setOptions(t)},n.prototype.sequenceFrom=function(t){if(this._nodes=t,0===this._ratios.get().length){for(var i=[],e=0;e<this._nodes.length;e++)i.push(1);this.setRatios(i)}},n.prototype.setRatios=function(t,i,e){void 0===i&&(i=this.options.transition);var n=this._ratios;0===n.get().length&&(i=void 0),n.isActive()&&n.halt(),n.set(t,i,e),this._ratiosDirty=!0},n.prototype.getSize=function(){return this._size},n.prototype.commit=function(t){var i,e=t.size,n=t.transform,r=t.origin,h=t.opacity,p=this._ratios.get(),c=this.options.direction,u=e[c];(u!==this._size[c]||this._ratiosDirty||this._ratios.isActive()||c!==this._cachedDirection||o.call(this,p,c))&&(s.call(this,p,u,c),u!==this._size[c]&&(this._size[0]=e[0],this._size[1]=e[1]),c!==this._cachedDirection&&(this._cachedDirection=c),this._ratiosDirty&&(this._ratiosDirty=!1));for(var l=[],d=0;d<p.length;d++)i=[void 0,void 0],u=this._cachedLengths[d],i[c]=u,l.push({transform:this._cachedTransforms[d],size:i,target:this._nodes[d].render()});return e&&0!==r[0]&&0!==r[1]&&(n=a.moveThen([-e[0]*r[0],-e[1]*r[1],0],n)),{transform:n,size:e,opacity:h,target:l}},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new r(this.options),t&&this.setOptions(t),this.angle=new o(0),this.frontNode=void 0,this.backNode=void 0,this.flipped=!1}var s=t("../core/Transform"),o=t("../transitions/Transitionable"),r=(t("../core/RenderNode"),t("../core/OptionsManager"));n.DIRECTION_X=0,n.DIRECTION_Y=1;var a=1;n.DEFAULT_OPTIONS={transition:!0,direction:n.DIRECTION_X},n.prototype.flip=function(t,i){var e=this.flipped?0:Math.PI;this.setAngle(e,t,i),this.flipped=!this.flipped},n.prototype.setAngle=function(t,i,e){void 0===i&&(i=this.options.transition),this.angle.isActive()&&this.angle.halt(),this.angle.set(t,i,e)},n.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},n.prototype.setFront=function(t){this.frontNode=t},n.prototype.setBack=function(t){this.backNode=t},n.prototype.render=function(){var t,i,e=this.angle.get();this.options.direction===n.DIRECTION_X?(t=s.rotateY(e),i=s.rotateY(e+Math.PI)):(t=s.rotateX(e),i=s.rotateX(e+Math.PI));var o=[];return this.frontNode&&o.push({transform:t,target:this.frontNode.render()}),this.backNode&&o.push({transform:s.moveThen([0,0,a],i),target:this.backNode.render()}),o},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this.optionsManager=new l(this.options),t&&this.setOptions(t),this.id=a.register(this),this._modifiers=[],this._states=[],this._contextSizeCache=[0,0],this._dimensionsCache=[0,0],this._activeCount=0,this._eventOutput=new c,c.setOutputHandler(this,this._eventOutput)}function s(t,i,e){var n=[t[0],t[1]];n[0]-=this.options.gutterSize[0]*(i-1),n[1]-=this.options.gutterSize[1]*(e-1);for(var s,a=Math.round(n[1]/e),h=Math.round(n[0]/i),p=0,c=0,u=0;e>u;u++){s=0;for(var l=0;i>l;l++)void 0===this._modifiers[c]?o.call(this,c,[h,a],[s,p,0],1):r.call(this,c,[h,a],[s,p,0],1),c++,s+=h+this.options.gutterSize[0];p+=a+this.options.gutterSize[1]}for(this._dimensionsCache=[this.options.dimensions[0],this.options.dimensions[1]],this._contextSizeCache=[t[0],t[1]],this._activeCount=e*i,u=this._activeCount;u<this._modifiers.length;u++)r.call(this,u,[Math.round(h),Math.round(a)],[0,0],0);this._eventOutput.emit("reflow")}function o(t,i,e,n){var s={transform:new f(h.translate.apply(null,e)),opacity:new d(n),size:new d(i)},o=new u({transform:s.transform,opacity:s.opacity,size:s.size});this._states[t]=s,this._modifiers[t]=o}function r(t,i,e,n){var s=this._states[t],o=s.size,r=s.opacity,a=s.transform,h=this.options.transition;a.halt(),r.halt(),o.halt(),a.setTranslate(e,h),o.set(i,h),r.set(n,h)}var a=t("../core/Entity"),h=(t("../core/RenderNode"),t("../core/Transform")),p=t("../core/ViewSequence"),c=t("../core/EventHandler"),u=t("../core/Modifier"),l=t("../core/OptionsManager"),d=t("../transitions/Transitionable"),f=t("../transitions/TransitionableTransform");n.DEFAULT_OPTIONS={dimensions:[1,1],transition:!1,gutterSize:[0,0]},n.prototype.render=function(){return this.id},n.prototype.setOptions=function(t){return this.optionsManager.setOptions(t)},n.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new p(t)),this.sequence=t},n.prototype.getSize=function(){return this._contextSizeCache},n.prototype.commit=function(t){var i=t.transform,e=t.opacity,n=t.origin,o=t.size,r=this.options.dimensions[0],a=this.options.dimensions[1];(o[0]!==this._contextSizeCache[0]||o[1]!==this._contextSizeCache[1]||r!==this._dimensionsCache[0]||a!==this._dimensionsCache[1])&&s.call(this,o,r,a);for(var p=this.sequence,c=[],u=0;p&&u<this._modifiers.length;){var l=p.get(),d=this._modifiers[u];u>=this._activeCount&&this._states[u].opacity.isActive()&&(this._modifiers.splice(u,1),this._states.splice(u,1)),l&&c.push(d.modify({origin:n,target:l.render()})),p=p.getNext(),u++}return o&&(i=h.moveThen([-o[0]*n[0],-o[1]*n[1],0],i)),{transform:i,opacity:e,size:o,target:c}},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this.setOptions(t),this._entityId=a.register(this),this.header=new h,this.footer=new h,this.content=new h}function s(t,i){var e=t.getSize();return e?e[this.options.direction]:i}function o(t){return this.options.direction===n.DIRECTION_X?p.translate(t,0,0):p.translate(0,t,0)}function r(t,i){return this.options.direction===n.DIRECTION_X?[t,i[1]]:[i[0],t]}var a=t("../core/Entity"),h=t("../core/RenderNode"),p=t("../core/Transform"),c=t("../core/OptionsManager");n.DIRECTION_X=0,n.DIRECTION_Y=1,n.DEFAULT_OPTIONS={direction:n.DIRECTION_Y,headerSize:void 0,footerSize:void 0,defaultHeaderSize:0,defaultFooterSize:0},n.prototype.render=function(){return this._entityId},n.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},n.prototype.commit=function(t){var i=t.transform,e=t.origin,n=t.size,a=t.opacity,h=void 0!==this.options.headerSize?this.options.headerSize:s.call(this,this.header,this.options.defaultHeaderSize),c=void 0!==this.options.footerSize?this.options.footerSize:s.call(this,this.footer,this.options.defaultFooterSize),u=n[this.options.direction]-h-c;n&&(i=p.moveThen([-n[0]*e[0],-n[1]*e[1],0],i));var l=[{size:r.call(this,h,n),target:this.header.render()},{transform:o.call(this,h),size:r.call(this,u,n),target:this.content.render()},{transform:o.call(this,h+u),size:r.call(this,c,n),target:this.footer.render()}];return{transform:i,opacity:a,size:n,target:l}},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new h(this.options),t&&this.setOptions(t),this._showing=!1,this.nodes=[],this.transforms=[],this.states=[]}var s=t("../core/Transform"),o=t("../core/Modifier"),r=t("../core/RenderNode"),a=t("../utilities/Utility"),h=t("../core/OptionsManager"),p=t("../transitions/Transitionable"),c=t("../transitions/TransitionableTransform");n.DEFAULT_OPTIONS={inTransform:s.scale(.001,.001,.001),inOpacity:0,inOrigin:[.5,.5],inAlign:[.5,.5],outTransform:s.scale(.001,.001,.001),outOpacity:0,outOrigin:[.5,.5],outAlign:[.5,.5],showTransform:s.identity,showOpacity:1,showOrigin:[.5,.5],showAlign:[.5,.5],inTransition:!0,outTransition:!0,overlap:!1},n.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},n.prototype.show=function(t,i,e){if(!t)return this.hide(e);if(i instanceof Function&&(e=i,i=void 0),this._showing){if(!this.options.overlap)return this.hide(this.show.bind(this,t,i,e));this.hide()}this._showing=!0;var n={transform:new c(this.options.inTransform),origin:new p(this.options.inOrigin),align:new p(this.options.inAlign),opacity:new p(this.options.inOpacity)},s=new o({transform:n.transform,opacity:n.opacity,origin:n.origin,align:n.align}),h=new r;h.add(s).add(t),this.nodes.push(h),this.states.push(n),this.transforms.push(s);var u=e?a.after(3,e):void 0;i||(i=this.options.inTransition),n.transform.set(this.options.showTransform,i,u),n.opacity.set(this.options.showOpacity,i,u),n.origin.set(this.options.showOrigin,i,u),n.align.set(this.options.showAlign,i,u)},n.prototype.hide=function(t,i){if(this._showing){this._showing=!1,t instanceof Function&&(i=t,t=void 0);var e=this.nodes[this.nodes.length-1],n=this.transforms[this.transforms.length-1],s=this.states[this.states.length-1],o=a.after(3,function(){this.nodes.splice(this.nodes.indexOf(e),1),this.states.splice(this.states.indexOf(s),1),this.transforms.splice(this.transforms.indexOf(n),1),i&&i.call(this)}.bind(this));t||(t=this.options.outTransition),s.transform.set(this.options.outTransform,t,o),s.opacity.set(this.options.outOpacity,t,o),s.origin.set(this.options.outOrigin,t,o),s.align.set(this.options.outAlign,t,o)}},n.prototype.render=function(){for(var t=[],i=0;i<this.nodes.length;i++)t.push(this.nodes[i].render());return t},e.exports=n}),define(function(t,i,e){function n(){p.apply(this,arguments),this._showing=-1,this._outgoingRenderables=[],this._nextRenderable=null,this._renderables=[],this._nodes=[],this._modifiers=[],this._states=[],this.inTransformMap=n.DefaultMap.transform,this.inOpacityMap=n.DefaultMap.opacity,this.inOriginMap=n.DefaultMap.origin,this.inAlignMap=n.DefaultMap.align,this.outTransformMap=n.DefaultMap.transform,this.outOpacityMap=n.DefaultMap.opacity,this.outOriginMap=n.DefaultMap.origin,this.outAlignMap=n.DefaultMap.align,this._output=[]}function s(t,i){return t(i.get())}var o=t("../core/Modifier"),r=t("../core/RenderNode"),a=t("../core/Transform"),h=t("../transitions/Transitionable"),p=t("../core/View");n.prototype=Object.create(p.prototype),n.prototype.constructor=n,n.DEFAULT_OPTIONS={inTransition:!0,outTransition:!0,overlap:!0},n.DefaultMap={transform:function(){return a.identity},opacity:function(t){return t},origin:null,align:null},n.prototype.inTransformFrom=function(t){if(t instanceof Function)this.inTransformMap=t;else{if(!t||!t.get)throw new Error("inTransformFrom takes only function or getter object");this.inTransformMap=t.get.bind(t)}return this},n.prototype.inOpacityFrom=function(t){if(t instanceof Function)this.inOpacityMap=t;else{if(!t||!t.get)throw new Error("inOpacityFrom takes only function or getter object");this.inOpacityMap=t.get.bind(t)}return this},n.prototype.inOriginFrom=function(t){if(t instanceof Function)this.inOriginMap=t;else{if(!t||!t.get)throw new Error("inOriginFrom takes only function or getter object");this.inOriginMap=t.get.bind(t)}return this},n.prototype.inAlignFrom=function(t){if(t instanceof Function)this.inAlignMap=t;else{if(!t||!t.get)throw new Error("inAlignFrom takes only function or getter object");this.inAlignMap=t.get.bind(t)}return this},n.prototype.outTransformFrom=function(t){if(t instanceof Function)this.outTransformMap=t;else{if(!t||!t.get)throw new Error("outTransformFrom takes only function or getter object");this.outTransformMap=t.get.bind(t)}return this},n.prototype.outOpacityFrom=function(t){if(t instanceof Function)this.outOpacityMap=t;else{if(!t||!t.get)throw new Error("outOpacityFrom takes only function or getter object");this.outOpacityMap=t.get.bind(t)}return this},n.prototype.outOriginFrom=function(t){if(t instanceof Function)this.outOriginMap=t;else{if(!t||!t.get)throw new Error("outOriginFrom takes only function or getter object");this.outOriginMap=t.get.bind(t)}return this},n.prototype.outAlignFrom=function(t){if(t instanceof Function)this.outAlignMap=t;else{if(!t||!t.get)throw new Error("outAlignFrom takes only function or getter object");this.outAlignMap=t.get.bind(t)}return this},n.prototype.show=function(t,i,e){if(!t)return this.hide(e);if(i instanceof Function&&(e=i,i=null),this._showing>=0){if(!this.options.overlap)return void(this._nextRenderable?this._nextRenderable=t:(this._nextRenderable=t,this.hide(function(){this._nextRenderable===t&&this.show(this._nextRenderable,e),this._nextRenderable=null})));this.hide()}var n=null,a=this._renderables.indexOf(t);if(a>=0){this._showing=a,n=this._states[a],n.halt();var p=this._outgoingRenderables.indexOf(t);p>=0&&this._outgoingRenderables.splice(p,1)}else{n=new h(0);var c=new o({transform:this.inTransformMap?s.bind(this,this.inTransformMap,n):null,opacity:this.inOpacityMap?s.bind(this,this.inOpacityMap,n):null,origin:this.inOriginMap?s.bind(this,this.inOriginMap,n):null,align:this.inAlignMap?s.bind(this,this.inAlignMap,n):null}),u=new r;u.add(c).add(t),this._showing=this._nodes.length,this._nodes.push(u),this._modifiers.push(c),this._states.push(n),this._renderables.push(t)}i||(i=this.options.inTransition),n.set(1,i,e)},n.prototype.hide=function(t,i){if(!(this._showing<0)){var e=this._showing;this._showing=-1,t instanceof Function&&(i=t,t=void 0);var n=this._nodes[e],o=this._modifiers[e],r=this._states[e],a=this._renderables[e];o.transformFrom(this.outTransformMap?s.bind(this,this.outTransformMap,r):null),o.opacityFrom(this.outOpacityMap?s.bind(this,this.outOpacityMap,r):null),o.originFrom(this.outOriginMap?s.bind(this,this.outOriginMap,r):null),o.alignFrom(this.outAlignMap?s.bind(this,this.outAlignMap,r):null),this._outgoingRenderables.indexOf(a)<0&&this._outgoingRenderables.push(a),t||(t=this.options.outTransition),r.halt(),r.set(0,t,function(t,e,n,s){if(this._outgoingRenderables.indexOf(s)>=0){var o=this._nodes.indexOf(t);this._nodes.splice(o,1),this._modifiers.splice(o,1),this._states.splice(o,1),this._renderables.splice(o,1),this._outgoingRenderables.splice(this._outgoingRenderables.indexOf(s),1),this._showing>=o&&this._showing--}i&&i.call(this)}.bind(this,n,o,r,a))}},n.prototype.render=function(){var t=this._output;t.length>this._nodes.length&&t.splice(this._nodes.length);for(var i=0;i<this._nodes.length;i++)t[i]=this._nodes[i].render();return t},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new a(this.options),t&&this.setOptions(t),this.container=new s(this.options.container),this.scrollview=new r(this.options.scrollview),this.container.add(this.scrollview),this._eventInput=new o,o.setInputHandler(this,this._eventInput),this._eventInput.pipe(this.scrollview),this._eventOutput=new o,o.setOutputHandler(this,this._eventOutput),this.container.pipe(this._eventOutput),this.scrollview.pipe(this._eventOutput)}var s=t("../surfaces/ContainerSurface"),o=t("../core/EventHandler"),r=t("./Scrollview"),a=(t("../utilities/Utility"),t("../core/OptionsManager"));n.DEFAULT_OPTIONS={container:{properties:{overflow:"hidden"}},scrollview:{}},n.prototype.setOptions=function(t){return this._optionsManager.setOptions(t)},n.prototype.sequenceFrom=function(){return this.scrollview.sequenceFrom.apply(this.scrollview,arguments)},n.prototype.getSize=function(){return this.container.getSize.apply(this.container,arguments)},n.prototype.render=function(){return this.container.render()},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(this.constructor.DEFAULT_OPTIONS),this._optionsManager=new c(this.options),t&&this._optionsManager.setOptions(t),this._node=null,this._position=0,this._positionOffset=0,this._positionGetter=null,this._outputFunction=null,this._masterOutputFunction=null,this.outputFrom(),this._onEdge=0,this.group=new p,this.group.add({render:a.bind(this)}),this._entityId=h.register(this),this._size=[void 0,void 0],this._contextSize=[void 0,void 0],this._eventInput=new f,this._eventOutput=new f,f.setInputHandler(this,this._eventInput),f.setOutputHandler(this,this._eventOutput)}function s(t){t||(t=this._contextSize);var i=this.options.direction;return void 0===t[i]?this._contextSize[i]:t[i]}function o(t,i,e){var n=t.getSize?t.getSize():this._contextSize,o=this._outputFunction(i);return e.push({transform:o,target:t.render()}),s.call(this,n)}function r(){return void 0!==this.options.clipSize?this.options.clipSize:this._contextSize[this.options.direction]>this.getCumulativeSize()[this.options.direction]?s.call(this,this.getCumulativeSize()):s.call(this,this._contextSize)}function a(){for(var t=null,i=this._position,e=[],n=-this._positionOffset,a=r.call(this),h=this._node;h&&n-i<a+this.options.margin;)n+=o.call(this,h,n,e),h=h.getNext?h.getNext():null;var p=this._node,c=s.call(this,p.getSize());if(a>n){for(;p&&a>c;)p=p.getPrevious(),p&&(c+=s.call(this,p.getSize()));for(p=this._node;p&&a>c;)p=p.getNext(),p&&(c+=s.call(this,p.getSize()))}for(!h&&a-g>n-i?1!==this._onEdge&&(this._onEdge=1,this._eventOutput.emit("onEdge",{position:n-a})):!this._node.getPrevious()&&-g>i?-1!==this._onEdge&&(this._onEdge=-1,this._eventOutput.emit("onEdge",{position:0})):0!==this._onEdge&&(this._onEdge=0,this._eventOutput.emit("offEdge")),h=this._node&&this._node.getPrevious?this._node.getPrevious():null,n=-this._positionOffset,h&&(t=h.getSize?h.getSize():this._contextSize,n-=s.call(this,t));h&&n-i>-(a+this.options.margin);)o.call(this,h,n,e),h=h.getPrevious?h.getPrevious():null,h&&(t=h.getSize?h.getSize():this._contextSize,n-=s.call(this,t));return e}var h=t("../core/Entity"),p=t("../core/Group"),c=t("../core/OptionsManager"),u=t("../core/Transform"),l=t("../utilities/Utility"),d=t("../core/ViewSequence"),f=t("../core/EventHandler");n.DEFAULT_OPTIONS={direction:l.Direction.Y,margin:0,clipSize:void 0,groupScroll:!1};var g=0;n.prototype.getCumulativeSize=function(t){return void 0===t&&(t=this._node._.cumulativeSizes.length-1),this._node._.getSize(t)},n.prototype.setOptions=function(t){t.groupScroll!==this.options.groupScroll&&(t.groupScroll?this.group.pipe(this._eventOutput):this.group.unpipe(this._eventOutput)),this._optionsManager.setOptions(t)},n.prototype.onEdge=function(){return this._onEdge},n.prototype.outputFrom=function(t,i){t||(t=function(t){return this.options.direction===l.Direction.X?u.translate(t,0):u.translate(0,t)}.bind(this),i||(i=t)),this._outputFunction=t,this._masterOutputFunction=i?i:function(i){return u.inverse(t(-i))}},n.prototype.positionFrom=function(t){t instanceof Function?this._positionGetter=t:t&&t.get?this._positionGetter=t.get.bind(t):(this._positionGetter=null,this._position=t),this._positionGetter&&(this._position=this._positionGetter.call(this))},n.prototype.sequenceFrom=function(t){t instanceof Array&&(t=new d({array:t})),this._node=t,this._positionOffset=0},n.prototype.getSize=function(t){return t?this._contextSize:this._size},n.prototype.render=function(){return this._node?(this._positionGetter&&(this._position=this._positionGetter.call(this)),this._entityId):null},n.prototype.commit=function(t){var i=t.transform,e=t.opacity,n=t.origin,s=t.size;this.options.clipSize||s[0]===this._contextSize[0]&&s[1]===this._contextSize[1]||(this._onEdge=0,this._contextSize[0]=s[0],this._contextSize[1]=s[1],this.options.direction===l.Direction.X?(this._size[0]=r.call(this),this._size[1]=void 0):(this._size[0]=void 0,this._size[1]=r.call(this)));var o=this._masterOutputFunction(-this._position);return{transform:u.multiply(i,o),size:s,opacity:e,origin:n,target:this.group.render()}},e.exports=n}),define(function(t,i,e){function n(t){this.options=Object.create(n.DEFAULT_OPTIONS),this._optionsManager=new S(this.options),this._scroller=new x(this.options),this.sync=new w(["scroll","touch"],{direction:this.options.direction,scale:this.options.syncScale,rails:this.options.rails,preventDefault:void 0!==this.options.preventDefault?this.options.preventDefault:this.options.direction!==z.Direction.Y}),this._physicsEngine=new _,this._particle=new y,this._physicsEngine.addBody(this._particle),this.spring=new v({anchor:[0,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),this.drag=new m({forceFunction:m.FORCE_FUNCTIONS.QUADRATIC,strength:this.options.drag}),this.friction=new m({forceFunction:m.FORCE_FUNCTIONS.LINEAR,strength:this.options.friction}),this._node=null,this._touchCount=0,this._springState=M.NONE,this._onEdge=P.NONE,this._pageSpringPosition=0,this._edgeSpringPosition=0,this._touchVelocity=0,this._earlyEnd=!1,this._needsPaginationCheck=!1,this._displacement=0,this._totalShift=0,this._cachedIndex=0,this._scroller.positionFrom(this.getPosition.bind(this)),this._eventInput=new O,this._eventOutput=new O,this._eventInput.pipe(this.sync),this.sync.pipe(this._eventInput),O.setInputHandler(this,this._eventInput),O.setOutputHandler(this,this._eventOutput),a.call(this),t&&this.setOptions(t)}function s(t){this._touchCount=t.count,void 0===t.count&&(this._touchCount=1),p.call(this),this.setVelocity(0),this._touchVelocity=0,this._earlyEnd=!1}function o(t){var i=-t.velocity,e=-t.delta;if(this._onEdge!==P.NONE&&t.slip&&(0>i&&this._onEdge===P.TOP||i>0&&this._onEdge===P.BOTTOM?this._earlyEnd||(r.call(this,t),this._earlyEnd=!0):this._earlyEnd&&Math.abs(i)>Math.abs(this.getVelocity())&&s.call(this,t)),!this._earlyEnd){if(this._touchVelocity=i,t.slip){var n=this.options.speedLimit;-n>i?i=-n:i>n&&(i=n),this.setVelocity(i);var o=16*n;e>o?e=o:-o>e&&(e=-o)}this.setPosition(this.getPosition()+e),this._displacement+=e,this._springState===M.NONE&&f.call(this)}}function r(t){if(this._touchCount=t.count||0,!this._touchCount){p.call(this),this._onEdge!==P.NONE&&d.call(this,this._edgeSpringPosition,M.EDGE),h.call(this);var i=-t.velocity,e=this.options.speedLimit;t.slip&&(e*=this.options.edgeGrip),-e>i?i=-e:i>e&&(i=e),this.setVelocity(i),this._touchVelocity=0,this._needsPaginationCheck=!0}}function a(){this._eventInput.bindThis(this),this._eventInput.on("start",s),this._eventInput.on("update",o),this._eventInput.on("end",r),this._eventInput.on("resize",function(){this._node._.calculateSize()}.bind(this)),this._scroller.on("onEdge",function(t){this._edgeSpringPosition=t.position,u.call(this,this._scroller.onEdge()),this._eventOutput.emit("onEdge")}.bind(this)),this._scroller.on("offEdge",function(){this.sync.setOptions({scale:this.options.syncScale}),this._onEdge=this._scroller.onEdge(),this._eventOutput.emit("offEdge")}.bind(this)),this._particle.on("update",function(t){this._springState===M.NONE&&f.call(this),this._displacement=t.position.x-this._totalShift}.bind(this)),this._particle.on("end",function(){(!this.options.paginated||this.options.paginated&&this._springState!==M.NONE)&&this._eventOutput.emit("settle")}.bind(this))}function h(){this._springState?this._physicsEngine.attach([this.spring],this._particle):this._physicsEngine.attach([this.drag,this.friction],this._particle)}function p(){this._springState=M.NONE,this._physicsEngine.detachAll()}function c(t){var i=this.options.direction,e=t.getSize();return e?e[i]:this._scroller.getSize()[i]}function u(t){this.sync.setOptions({scale:this.options.edgeGrip}),this._onEdge=t,this._touchCount||this._springState===M.EDGE||d.call(this,this._edgeSpringPosition,M.EDGE),this._springState&&Math.abs(this.getVelocity())<.001&&(p.call(this),h.call(this))}function l(){if(!this._touchCount&&this._springState!==M.EDGE){var t=this.getVelocity();if(!(Math.abs(t)>=this.options.pageStopSpeed)){var i=this.getPosition(),e=Math.abs(t)>this.options.pageSwitchSpeed,n=c.call(this,this._node),s=i>.5*n,o=t>0,r=0>t;this._needsPaginationCheck=!1,s&&!e||e&&o?this.goToNextPage():e&&r?this.goToPreviousPage():d.call(this,0,M.PAGE)}}}function d(t,i){var e;i===M.EDGE?(this._edgeSpringPosition=t,e={anchor:[this._edgeSpringPosition,0,0],period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}):i===M.PAGE&&(this._pageSpringPosition=t,e={anchor:[this._pageSpringPosition,0,0],period:this.options.pagePeriod,dampingRatio:this.options.pageDamp}),this.spring.setOptions(e),i&&!this._springState&&(p.call(this),this._springState=i,h.call(this)),this._springState=i}function f(){var t=0,i=this.getPosition();i+=(0>i?-.5:.5)>>0;for(var e=c.call(this,this._node),n=this._node.getNext();t+i>=e&&n;)t-=e,this._scroller.sequenceFrom(n),this._node=n,n=this._node.getNext(),e=c.call(this,this._node);for(var s,o=this._node.getPrevious();0>=t+i&&o;)s=c.call(this,o),this._scroller.sequenceFrom(o),this._node=o,t+=s,o=this._node.getPrevious();t&&g.call(this,t),this._node&&(this._node.index!==this._cachedIndex?this.getPosition()<.5*e&&(this._cachedIndex=this._node.index,this._eventOutput.emit("pageChange",{direction:-1,index:this._cachedIndex})):this.getPosition()>.5*e&&(this._cachedIndex=this._node.index+1,this._eventOutput.emit("pageChange",{direction:1,index:this._cachedIndex})))}function g(t){this._edgeSpringPosition+=t,this._pageSpringPosition+=t,this.setPosition(this.getPosition()+t),this._totalShift+=t,this._springState===M.EDGE?this.spring.setOptions({anchor:[this._edgeSpringPosition,0,0]}):this._springState===M.PAGE&&this.spring.setOptions({anchor:[this._pageSpringPosition,0,0]})}var _=t("../physics/PhysicsEngine"),y=t("../physics/bodies/Particle"),m=t("../physics/forces/Drag"),v=t("../physics/forces/Spring"),O=t("../core/EventHandler"),S=t("../core/OptionsManager"),b=t("../core/ViewSequence"),x=t("../views/Scroller"),z=t("../utilities/Utility"),w=t("../inputs/GenericSync"),E=t("../inputs/ScrollSync"),T=t("../inputs/TouchSync");w.register({scroll:E,touch:T});var M={NONE:0,EDGE:1,PAGE:2},P={TOP:-1,NONE:0,BOTTOM:1};n.DEFAULT_OPTIONS={direction:z.Direction.Y,rails:!0,friction:.005,drag:1e-4,edgeGrip:.2,edgePeriod:300,edgeDamp:1,margin:1e3,paginated:!1,pagePeriod:500,pageDamp:.8,pageStopSpeed:10,pageSwitchSpeed:.5,speedLimit:5,groupScroll:!1,syncScale:1},n.prototype.getCurrentIndex=function(){return this._node.index},n.prototype.goToPreviousPage=function(){if(!this._node||this._onEdge===P.TOP)return null;if(this.getPosition()>1&&this._springState===M.NONE)return d.call(this,0,M.PAGE),this._node;var t=this._node.getPrevious();if(t){var i=c.call(this,t);this._scroller.sequenceFrom(t),this._node=t,g.call(this,i),d.call(this,0,M.PAGE)}return t},n.prototype.goToNextPage=function(){if(!this._node||this._onEdge===P.BOTTOM)return null;var t=this._node.getNext();if(t){var i=c.call(this,this._node);this._scroller.sequenceFrom(t),this._node=t,g.call(this,-i),d.call(this,0,M.PAGE)}return t},n.prototype.goToPage=function(t){var i,e=this.getCurrentIndex();if(e>t)for(i=0;e-t>i;i++)this.goToPreviousPage();if(t>e)for(i=0;t-e>i;i++)this.goToNextPage()},n.prototype.outputFrom=function(){return this._scroller.outputFrom.apply(this._scroller,arguments)},n.prototype.getPosition=function(){return this._particle.getPosition1D()},n.prototype.getAbsolutePosition=function(){return this._scroller.getCumulativeSize(this.getCurrentIndex())[this.options.direction]+this.getPosition()},n.prototype.getOffset=n.prototype.getPosition,n.prototype.setPosition=function(t){this._particle.setPosition1D(t)},n.prototype.setOffset=n.prototype.setPosition,n.prototype.getVelocity=function(){return this._touchCount?this._touchVelocity:this._particle.getVelocity1D()},n.prototype.setVelocity=function(t){this._particle.setVelocity1D(t)},n.prototype.setOptions=function(t){void 0!==t.direction&&("x"===t.direction?t.direction=z.Direction.X:"y"===t.direction&&(t.direction=z.Direction.Y)),t.groupScroll!==this.options.groupScroll&&(t.groupScroll?this.subscribe(this._scroller):this.unsubscribe(this._scroller)),this._optionsManager.setOptions(t),this._scroller.setOptions(t),void 0!==t.drag&&this.drag.setOptions({strength:this.options.drag}),void 0!==t.friction&&this.friction.setOptions({strength:this.options.friction}),(void 0!==t.edgePeriod||void 0!==t.edgeDamp)&&this.spring.setOptions({period:this.options.edgePeriod,dampingRatio:this.options.edgeDamp}),(t.rails||void 0!==t.direction||void 0!==t.syncScale||t.preventDefault)&&this.sync.setOptions({rails:this.options.rails,direction:this.options.direction===z.Direction.X?w.DIRECTION_X:w.DIRECTION_Y,scale:this.options.syncScale,preventDefault:this.options.preventDefault})},n.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new b({array:t,trackSize:!0})),this._node=t,this._scroller.sequenceFrom(t)},n.prototype.getSize=function(){return this._scroller.getSize.apply(this._scroller,arguments)},n.prototype.render=function(){return this.options.paginated&&this._needsPaginationCheck&&l.call(this),this._scroller.render()},e.exports=n}),define(function(t,i,e){function n(t){this._items=null,this._size=null,this._outputFunction=n.DEFAULT_OUTPUT_FUNCTION,this.options=h.clone(this.constructor.DEFAULT_OPTIONS||n.DEFAULT_OPTIONS),this.optionsManager=new s(this.options),this.id=o.register(this),this.cachedSize=[void 0,void 0],t&&this.setOptions(t)}var s=t("../core/OptionsManager"),o=t("../core/Entity"),r=t("../core/Transform"),a=t("../core/ViewSequence"),h=t("../utilities/Utility");n.DEFAULT_OPTIONS={direction:h.Direction.Y,itemSpacing:0},n.DEFAULT_OUTPUT_FUNCTION=function(t,i){var e=this.options.direction===h.Direction.X?r.translate(i,0):r.translate(0,i);return{size:this.cachedSize,transform:e,target:t.render()}},n.prototype.getSize=function(){return this._size||this.render(),this._size},n.prototype.sequenceFrom=function(t){return t instanceof Array&&(t=new a(t)),this._items=t,this},n.prototype.setOptions=function(){return this.optionsManager.setOptions.apply(this.optionsManager,arguments),this},n.prototype.setOutputFunction=function(t){return this._outputFunction=t,this},n.prototype.render=function(){return this.id},n.prototype.commit=function(t){var i=0,e=1^this.options.direction,n=this._items,s=null,o=[],r={},a=[],h=0;for(this._size=[0,0],this.cachedSize=t.size;n&&(s=n.get());)s.getSize&&(o=s.getSize()),r=this._outputFunction.call(this,s,i,h++),a.push(r),o&&(o[this.options.direction]&&(i+=o[this.options.direction]),o[e]>this._size[e]&&(this._size[e]=o[e]),0===o[e]&&(this._size[e]=void 0)),n=n.getNext(),this.options.itemSpacing&&n&&(i+=this.options.itemSpacing);return this._size[this.options.direction]=i,{transform:t.transform,origin:t.origin,opacity:t.opacity,size:this.getSize(),target:a}},e.exports=n}),define(function(t,i,e){function n(){s.apply(this,arguments),this._id=o.register(this),this._parentSize=[]}var s=t("../core/View"),o=t("../core/Entity"),r=t("../core/Transform");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.commit=function(t){var i=t.transform,e=t.opacity,n=t.origin;return this._parentSize&&this._parentSize[0]===t.size[0]&&this._parentSize[1]===t.size[1]||(this._parentSize[0]=t.size[0],this._parentSize[1]=t.size[1],this._eventInput.emit("parentResize",this._parentSize),this.onResize&&this.onResize(this._parentSize)),this._parentSize&&(i=r.moveThen([-this._parentSize[0]*n[0],-this._parentSize[1]*n[1],0],i)),{transform:i,opacity:e,size:this._parentSize,target:this._node.render()}
},n.prototype.getParentSize=function(){return this._parentSize},n.prototype.render=function(){return this._id},e.exports=n});