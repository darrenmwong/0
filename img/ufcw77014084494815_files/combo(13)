YUI.add("hermes-template-photo-comment-permission-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return"checked"}function h(e,t){return'\n	<label for="dialog-photo-commenting-contacts" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-contacts" value="2" checked>\n		Contacts\n	</label>\n	'}function p(e,t){return'\n	<label for="dialog-photo-commenting-ff" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-ff" value="1" checked>\n		Friends &amp; Family\n	</label>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=this,l=n.helperMissing;s+='Allow people to comment on this photo?\n\n<form class="pure-form"><fieldset>\n	\n	<label for="dialog-photo-commenting-public" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-public" value="3" ',a={hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",3,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",3,a));if(u||u===0)s+=u;s+=">\n		Yes\n	</label>\n	\n	",a={hash:{},inverse:f.noop,fn:f.program(3,h,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",2,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",2,a));if(u||u===0)s+=u;s+="\n	\n	",a={hash:{},inverse:f.noop,fn:f.program(5,p,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",1,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",1,a));if(u||u===0)s+=u;s+='\n	\n	<label for="dialog-photo-commenting-private" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-private" value="0" ',a={hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",0,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",0,a));if(u||u===0)s+=u;return s+=">\n		No\n	</label>\n	\n</fieldset></form>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-comment-permission-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-unimplemented-feature-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"\n	<br>\n	While we don't yet support what you&rsquo;re trying to do, you are free to opt out of the new experience and then opt back in if you wish.\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+="This is a beta version of the photo page redesign and is missing some features. We are working hard on adding new functionality frequently. We will provide most of the functionality you expect on Flickr soon.<br>\n",o=n["if"].call(t,t["opt-out-enabled"],{hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n<br>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-unimplemented-feature-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-download-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n			"'+l((r=(r=e.photo,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+'"\n		',n}function d(e,t){var n="",r;return n+='\n            <i class="ui-icon-tiny-'+l((r=(r=e.photo,r==null||r===!1?r:r.license),typeof r===f?r.apply(e):r))+'cc"></i>\n        ',n}function v(e,t){return'\n            <i class="ui-icon-tiny-government"></i>\n        '}function m(e,t){return'\n            <i class="ui-icon-tiny-noKnown"></i>\n        '}function g(e,t){return'\n			<i class="ui-icon-tiny-copyright">&nbsp;</i>\n		'}function y(e,t){var n="",r;return n+='\n		    <span class="license license-'+l((r=(r=e.photo,r==null||r===!1?r:r.license),typeof r===f?r.apply(e):r))+'">Some rights reserved</span>\n		',n}function b(e,t){var r="",i,s;return r+='\n		    <span class="license license-'+l((i=(i=e.photo,i==null||i===!1?i:i.license),typeof i===f?i.apply(e):i))+'">',s={hash:{},data:t},r+=l((i=n.licenseString||e.licenseString,i?i.call(e,(i=e.photo,i==null||i===!1?i:i.license),s):c.call(e,"licenseString",(i=e.photo,i==null||i===!1?i:i.license),s)))+"</span>\n		",r}function w(e,t){var r="",i;r+='\n			<li class="',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i),i=n["if"].call(e,e.selected,{hash:{},inverse:h.noop,fn:h.program(16,E,t),data:t});if(i||i===0)r+=i;return r+='">\n				<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-track="downloadSizeSelected',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i)+'">\n					<span class="label">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===f?i.apply(e):i),r+=l(i)+'</span>\n					<span class="resolution">',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===f?i.apply(e):i),r+=l(i)+" &times; ",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span>\n				</a>\n			</li>\n		",r}function E(e,t){return" selected"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="download-dialog">\n	<h2>Download photo</h2>\n	<p class="title">\n		',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.title),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n		by "+l((o=(o=(o=t.photo,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===f?o.apply(t):o))+'\n	</p>\n	<p class="license-info">\n	<a href="',a={hash:{},data:i},s+=l((o=n.configVal||t.configVal,o?o.call(t,"licenseUrls",(o=t.photo,o==null||o===!1?o:o.license),a):c.call(t,"configVal","licenseUrls",(o=t.photo,o==null||o===!1?o:o.license),a)))+'" class="license-url" target="_newtab">\n        ',u=n["if"].call(t,t.licenseIsCreativeCommons,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisGovt,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisNoLic,{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n["if"].call(t,t.licenseisCopy,{hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.licenseIsCreativeCommons,{hash:{},inverse:h.program(13,b,i),fn:h.program(11,y,i),data:i});if(u||u===0)s+=u;s+='\n	</a>\n    </p>\n	<ul class="sizes">\n		',u=n.each.call(t,t.sizes,{hash:{},inverse:h.noop,fn:h.program(15,w,i),data:i});if(u||u===0)s+=u;return s+="\n	</ul>\n	<p class='buttons'>\n		<a href=\""+l((o=(o=t.photo,o==null||o===!1?o:o.url),typeof o===f?o.apply(t):o))+'/sizes/l" class="all-sizes" data-track="viewAllSizesClick">View all sizes</a>\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done" data-track="downloadClick"><span>Download</span></button>\n	</p>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/download-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("more-menu-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:["more-menu-view","common"],initializer:function(e){this.nsid=e.nsid,this.photoId=e.photoId,this.optOutEnabled=this.appContext.experiments.optOut.enabled(),this.realFullscreen=!!e.realFullscreen;if(this.get("container").get("innerHTML")===""){var t=this.templates("more-button")({loadingView:!0});this.setContainerHTML(t)}return this.appContext.flipper.isFlipped("rename-set-to-album")?this.addToSetLabel=this.intlMessage({intlName:"more-menu-view.ADD_TO_ALBUM"}):this.addToSetLabel=this.intlMessage({intlName:"more-menu-view.ADD_TO_SET"}),this.addToGroupLabel=this.intlMessage({intlName:"more-menu-view.ADD_TO_GROUP"}),this.addToGalleryLabel=this.intlMessage({intlName:"more-menu-view.ADD_TO_GALLERY"}),this},loadState:function(){var t=this,n=[];return n.push(t.appContext.getModel("person-relationship-models",t.nsid).then(function(e){t.set("ownerRelationship",e)})),n.push(t.appContext.getModel("photo-models",t.photoId).then(function(e){t.set("photo",e)})),t.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.set("person",e)})),n.push(t.appContext.getModel("photo-privacy-models",t.photoId).then(function(e){t.set("photoPrivacy",e)})),this.appContext.flipper.isFlipped("show-edit-date-dialog")&&n.push(t.appContext.getModel("photo-stats-models",t.photoId).then(function(e){t.set("stats",e)})),n.push(t.appContext.getModel("photo-exif-models",t.photoId).then(function(e){t.set("hasExif",!0)},function(){t.set("hasExif",!1)})),t.appContext.getModel("photo-contexts-models",t.photoId).then(function(e){t.updateContextLabels(e),e.on("valuesChanged",function(n){t.updateContextLabels(e)})}),this.appContext.auth.signedIn&&n.push(t.appContext.getModel("person-groups-models",t.appContext.auth.user.nsid).then(function(e){return t.set("personGroups",e),t.get("personGroups").getValue("groups").getPage({page:1,perPage:400})})),e.batch.apply(null,n)},buildContainer:function(){var e;return e=this.templates("more-button")({}),this.setContainerHTML(e),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:this.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:this.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},setupDropdown:function(){var t=this.get("container"),n=this.get("photo"),r=this.get("photoPrivacy"),i,s=this.get("ownerRelationship"),o=s.getValue("isMe"),u=[],a=!1,f=!1,l=t,c,h=o,p=!1,d=!1,v=!1,m=!1,g=!1,y=n.getValue("isVideo"),b=n.getValue("id"),w=this,E=w.appContext.flipper.isFlipped("show-edit-date-dialog"),S=r.getValue("permComment");this.appContext.auth.signedIn&&(u=this.get("personGroups").getValue("groups").toJSON()),n.getValue("safetyLevel")===0&&r.getValue("isPublic")&&!o&&this.appContext.auth.signedIn&&(p=!0),u.forEach(function(e){if(e.isAdmin){a=!0;return}}),this.appContext.getViewer().signedIn&&(f=!0),this.appContext.flipper.isFlipped("add-to-group")&&(d=!0),this.appContext.flipper.isFlipped("add-location")&&o&&(v=!0),this.appContext.flipper.isFlipped("add-people")&&o&&(m=!0),this.appContext.flipper.isFlipped("aviary")&&o&&(g=!0),i=e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias")}),c=this.templates("more-menu")({photoURL:i,photoId:b,viewerIsOwner:o,isAtLeastOneGroupAdmin:a,showFlagLink:!o&&this.appContext.auth.signedIn,showDeleteLink:o,showEditMetaLink:o,showCommentControl:o,showReportAbuseLink:!o&&this.appContext.auth.signedIn,showRotateLink:o,showReplaceLink:o,showAddToSetLink:o,enableAddToSet:h,isVideo:y,showAddToGroupLink:f,enableAddToGroup:d,enableAddToGallery:p,showAddLocationLink:o,enableAddLocation:v,showPeopleTagLink:o,enableAddPeople:m,showEditInAviaryLink:o,enableEditInAviary:g&&!y,commentPermissionValue:S,addToSetLabel:this.addToSetLabel,addToGroupLabel:this.addToGroupLabel,addToGalleryLabel:this.addToGalleryLabel,showDownloadLink:this.get("photo").getValue("engagement").getValue("canDownload"),downloadDialogEnabled:this.appContext.flipper.isFlipped("download-dialog-enabled"),showEditDate:E,"opt-out-enabled":this.optOutEnabled}),this.moreMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:c,anchorTo:l,parent:this,positioning:!1,rootEl:t}),this.moreMenu.render(),this.moreMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?w.fire("subviewViewEvent","make in view",t):w.fire("subviewViewEvent","close in view"))})},updateContextLabels:function(e){var t=e.registry.getContextsOfType(this.photoId,"set-models"),n=e.registry.getContextsOfType(this.photoId,"groups-pool-models"),r=e.registry.getContextsOfType(this.photoId,"gallery-models"),i=this.get("ownerRelationship"),s=i.getValue("isMe");this.appContext.flipper.isFlipped("rename-set-to-album")?this.addToSetLabel=t.length>0?this.intlMessage({intlName:"more-menu-view.ADD_TO_REMOVE_FROM_ALBUM"}):this.intlMessage({intlName:"more-menu-view.ADD_TO_ALBUM"}):this.addToSetLabel=t.length>0?this.intlMessage({intlName:"more-menu-view.ADD_TO_REMOVE_FROM_SET"}):this.intlMessage({intlName:"more-menu-view.ADD_TO_SET"}),this.addToGalleryLabel=r.length>0?this.intlMessage({intlName:"more-menu-view.ADD_TO_REMOVE_FROM_GALLERY"}):this.intlMessage({intlName:"more-menu-view.ADD_TO_GALLERY"}),s?this.addToGroupLabel=n.length>0?this.intlMessage({intlName:"more-menu-view.ADD_TO_REMOVE_FROM_GROUP"}):this.intlMessage({intlName:"more-menu-view.ADD_TO_GROUP"}):this.addToGroupLabel=n.length>0?this.intlMessage({intlName:"more-menu-view.INVITE_TO_REMOVE_FROM_GROUP"}):this.intlMessage({intlName:"more-menu-view.INVITE_TO_GROUP"}),this.isBuilt&&(this.get("container").one(".add-to-set")&&this.get("container").one(".add-to-set span").set("text",this.addToSetLabel),this.get("container").one(".add-to-group")&&this.get("container").one(".add-to-group span").set("text",this.addToGroupLabel
),this.get("container").one(".add-to-gallery")&&this.get("container").one(".add-to-gallery span").set("text",this.addToGalleryLabel))},handleMenuButtonClick:function(t){t.halt(),e.rapidTracker.beacon(this.name,"moreMenuClick"),this.moreMenu.toggle()},handleFlagPhotoClick:function(t){t.preventDefault();var n=this.get("photo").getValue("safetyLevel"),r=this.get("personPreferences").getValue("safeSearch"),i,s,o,u=this;this.moreMenu.hide(),i=this.templates("flag-photo-dialog-content")({safetyLevel:n,fallsWithinSettings:n<=r}),s=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:this.intlMessage({intlName:"more-menu-view.FLAG_PHOTO"}),icon:"ui-icon-modal-flag",content:i,confirmButtonLabel:this.intlMessage({intlName:"more-menu-view.MARK_FOR_REVIEW"})}),s.render(),s.activate(),o=s.get("container"),o.all("a").on("click",function(){u.flagDialog.close(),u.flagDialog.destroy()}),s.registerEventHandler(o.one(".ui-dialog-button-confirm").on("click",this.handleFlagPhotoConfirmClick,this)),this.fire("subviewViewEvent","getDialogOffset",function(t){u.flagDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:s.get("container"),appContext:u.appContext,offsetLeft:t}),u.flagDialog.show()}),e.rapidTracker.beacon(this.name,"flagPhotoClick")},handleFlagPhotoConfirmClick:function(t){var n=this;e.rapidTracker.beacon(this.name,"flagPhotoConfirmationClick"),n.flagDialog.close(),n.flagDialog.destroy(),this.appContext.flickrAPI.callMethod("flickr.moderation.flagPhoto",{photo_id:this.photoId,offensive:1}).then(function(e){n.get("container").one(".flag-photo").replace(n.intlMessage({intlName:"more-menu-view.PHOTO_HAS_BEEN_FLAGGED"}))},function(e){n.onError(n.intlMessage({intlName:"more-menu-view.PROBLEM_FLAGGING"}))})},handleAddToGroupClick:function(t){function f(){i?a=o.intlMessage({intlName:"more-menu-view.NO_GROUPS"}):a=o.intlMessage({intlName:"more-menu-view.NO_GROUPS_ADMIN"}),n=new e.Views["group-selection-dialog-view"]({type:"group",titleSelect:s,loadingText:o.intlMessage({intlName:"more-menu-view.LOADING_GROUPS"}),noneText:a,placeholderSearch:o.intlMessage({intlName:"more-menu-view.SEARCH_GROUPS_PLACEHOLDER"}),buttonTextComplete:"",canCreateNew:!1,photoID:o.photoId,viewerIsOwner:o.get("ownerRelationship").getValue("isMe")}),n.on("subviewViewEvent",function(e){e&&e.details&&e.details.length===2&&o.fire("subviewViewEvent",e.details[0],e.details[1])}),n.appContext=this.appContext,n.buildContainer(),r=n.get("container"),o.fire("subviewViewEvent","getDialogOffset",function(t){o.addToGroupDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:o.appContext,offsetLeft:t}),o.addToGroupDialog.show(),n._params.keyEventScope=o.addToGroupDialog.getKeyEventScope(),n.activate()})}t.preventDefault();var n,r,i=this.get("ownerRelationship").getValue("isMe"),s=i?this.intlMessage({intlName:"more-menu-view.ADD_PHOTO_TO_GROUP"}):this.intlMessage({intlName:"more-menu-view.INVITE_PHOTO_TO_GROUP"}),o=this,u,a;this.moreMenu.hide(),!this.get("photoPrivacy").getValue("isPublic")&&(!localStorage.getItem("dontShowPrivatePhotoGroupsWarningAgain")||localStorage.getItem("dontShowPrivatePhotoGroupsWarningAgain")===null)&&this.get("ownerRelationship").getValue("isMe")?o.fire("subviewViewEvent","getDialogOffset",function(t){u=e.Views.dialog.getNewInstance("dialog-alert",{content:"<p>"+o.intlMessage({intlName:"more-menu-view.GROUP_PRIVACY_WARNING"})+'</p><p><input type="checkbox" id="dont-show-again" /> <label for="dont-show-again">'+o.intlMessage({intlName:"more-menu-view.DONT_SHOW_ME_AGAIN"})+"</label></p>",attrs:{title:o.intlMessage({intlName:"common.WARNING"}),level:"ui-icon-modal-warning",confirmLabel:o.intlMessage({intlName:"common.OK"})},parent:o,offsetLeft:t}),u.show(),u.on("hide",function(e){u.get("container").one("input").get("checked")&&localStorage.setItem("dontShowPrivatePhotoGroupsWarningAgain",!0),f()})}):f(),e.rapidTracker.beacon(this.name,"addToGroupClick")},handleAddToGalleryClick:function(t){t.preventDefault();var n,r,i=this;this.moreMenu.hide(),n=new e.Views["gallery-selection-dialog-view"]({type:"galleries",titleSelect:this.intlMessage({intlName:"more-menu-view.ADD_PHOTO_TO_GALLERY"}),titleCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_GALLERY"}),loadingText:this.intlMessage({intlName:"more-menu-view.LOADING_GALLERIES"}),noneText:this.intlMessage({intlName:"more-menu-view.NO_GALLERIES"}),placeholderSearch:this.intlMessage({intlName:"more-menu-view.SEARCH_GALLERIES_PLACEHOLDER"}),placeholderTitle:this.intlMessage({intlName:"more-menu-view.GALLERY_TITLE_PLACEHOLDER"}),placeholderDescription:this.intlMessage({intlName:"more-menu-view.GALLERY_DESCRIPTION_PLACEHOLDER"}),buttonTextSwitchCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_GALLERY"}),buttonTextCreate:this.intlMessage({intlName:"more-menu-view.CREATE_GALLERY"}),buttonTextComplete:this.intlMessage({intlName:"common.DONE"}),buttonTextCancel:this.intlMessage({intlName:"more-menu-view.BACK_TO_GALLERIES"}),canCreateNew:!0,photoID:this.photoId}),n.appContext=this.appContext,n.on("subviewViewEvent",function(e){e&&e.details&&e.details.length===2&&i.fire("subviewViewEvent",e.details[0],e.details[1])}),n.buildContainer(),r=n.get("container"),this.fire("subviewViewEvent","getDialogOffset",function(t){i.addToGalleryDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:i.appContext,offsetLeft:t}),i.addToGalleryDialog.show(),n._params.keyEventScope=i.addToGalleryDialog.getKeyEventScope(),n.activate()}),e.rapidTracker.beacon(this.name,"addToGalleriesClick")},handleAddToSetClick:function(t){t.preventDefault();var n,r,i=this;this.moreMenu.hide(),this.appContext.flipper.isFlipped("rename-set-to-album")?n=new e.Views["set-selection-dialog-view"]({type:"sets",titleSelect:this.intlMessage({intlName:"more-menu-view.ADD_PHOTO_TO_ALBUM"}),titleCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_ALBUM"}),loadingText:this.intlMessage({intlName
:"more-menu-view.LOADING_ALBUMS"}),noneText:this.intlMessage({intlName:"more-menu-view.NO_ALBUMS"}),placeholderSearch:this.intlMessage({intlName:"more-menu-view.SEARCH_ALBUMS_PLACEHOLDER"}),placeholderTitle:this.intlMessage({intlName:"more-menu-view.ALBUM_TITLE_PLACEHOLDER"}),placeholderDescription:this.intlMessage({intlName:"more-menu-view.DESCRIPTION_PLACEHOLDER"}),buttonTextSwitchCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_ALBUM"}),buttonTextCreate:this.intlMessage({intlName:"more-menu-view.CREATE_ALBUM"}),buttonTextComplete:this.intlMessage({intlName:"common.DONE"}),buttonTextCancel:this.intlMessage({intlName:"more-menu-view.BACK_TO_ALBUMS"}),canCreateNew:!0,photoID:this.photoId}):n=new e.Views["set-selection-dialog-view"]({type:"sets",titleSelect:this.intlMessage({intlName:"more-menu-view.ADD_PHOTO_TO_SET"}),titleCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_SET"}),loadingText:this.intlMessage({intlName:"more-menu-view.LOADING_SETS"}),noneText:this.intlMessage({intlName:"more-menu-view.NO_SETS"}),placeholderSearch:this.intlMessage({intlName:"more-menu-view.SEARCH_SETS_PLACEHOLDER"}),placeholderTitle:this.intlMessage({intlName:"more-menu-view.SET_TITLE_PLACEHOLDER"}),placeholderDescription:this.intlMessage({intlName:"more-menu-view.ALBUM_TITLE_PLACEHOLDER"}),buttonTextSwitchCreate:this.intlMessage({intlName:"more-menu-view.CREATE_NEW_SET"}),buttonTextCreate:this.intlMessage({intlName:"more-menu-view.CREATE_SET"}),buttonTextComplete:this.intlMessage({intlName:"common.DONE"}),buttonTextCancel:this.intlMessage({intlName:"more-menu-view.BACK_TO_SETS"}),canCreateNew:!0,photoID:this.photoId}),n.appContext=this.appContext,n.buildContainer(),r=n.get("container"),this.fire("subviewViewEvent","getDialogOffset",function(t){i.addToSetDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:i.appContext,offsetLeft:t}),i.addToSetDialog.show(),n._params.keyEventScope=i.addToSetDialog.getKeyEventScope(),n.activate()}),e.rapidTracker.beacon(this.name,"addToSetsClick")},handleDownloadClick:function(e){e.preventDefault(),this.showDownloadDialog()},showDownloadDialog:function(){var t,n=e.clone(this.get("photo").toJSON()),r=n.license,i=[],s,o=this,u;n.sizes.q&&(n.sizes.q.label="Square",i.push(n.sizes.q)),n.sizes.s&&(n.sizes.s.label="Small",i.push(n.sizes.s)),n.sizes.z&&(n.sizes.z.label="Medium",i.push(n.sizes.z)),n.sizes.l&&(n.sizes.l.label="Large",n.sizes.l.selected=!0,i.push(n.sizes.l)),!n.sizes.l&&i.length>0&&(i[i.length-1].selected=!0),n.sizes.o&&(n.sizes.o.label="Original",i.push(n.sizes.o));for(u=0;u<i.length;u++)i[u].url=i[u].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");this.moreMenu.hide(),t=this.templates("download-dialog")({photo:n,sizes:i,licenseIsCreativeCommons:r!==0&&r!==7&&r!==8,licenseisGovt:r===8,licenseisNoLic:r===7,licenseisCopy:r===0}),this.fire("subviewViewEvent","getDialogOffset",function(n){function r(t){var n=s.one(".selected a").getAttribute("href");document.location=n,o.downloadDialog.hide(),e.rapidTracker.beacon(o.name,"photoDownloadClick")}function i(e){e.charCode===37?s.one("ul li.selected")!==s.one("ul li:first-child")&&s.one("li.selected").removeClass("selected").previous("li").addClass("selected"):s.one("ul li.selected")!==s.one("ul li:last-child")&&s.one("li.selected").removeClass("selected").next("li").addClass("selected")}o.downloadDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:t,appContext:o.appContext,offsetLeft:n}),o.downloadDialog.show(),s=o.downloadDialog.get("container"),o.registerEventHandler(s.one(".ui-dialog-button-close").on("click",function(e){o.downloadDialog.hide()})),o.registerEventHandler(s.all(".sizes li a").on("click",function(e){e.preventDefault(),e.target.ancestor("ul").one(".selected")&&e.target.ancestor("ul").one(".selected").removeClass("selected"),e.target.ancestor("li").addClass("selected")})),o.registerEventHandler(s.one(".ui-dialog-button-done").on("click",r)),o._params.keyEventScope=o.downloadDialog.getKeyEventScope(),o.attachKeyEvent("down:13",r),o.attachKeyEvent("down:37",i),o.attachKeyEvent("down:39",i)}),e.rapidTracker.beacon(this.name,"downloadDialogClick")},handleDeletePhotoClick:function(t){t.preventDefault();var n,r,i,s,o,u,a=525/347,f=this;this.moreMenu.hide(),n=this.templates("delete-photo-dialog-content")({}),o=this.getDeleteBackgroundImageUrl(this.get("photo")),s=o.url,u=o.width/o.height,r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:this.intlMessage({intlName:"more-menu-view.DELETE_PHOTO"}),content:n,confirmButtonLabel:this.intlMessage({intlName:"more-menu-view.PERMANENTLY_DELETE_PHOTO"}),confirmButtonClass:"ui-dialog-button-negative",deletePhotoConfirmation:!0}),r.render(),r.activate(),i=r.get("container"),o.width<=525&&o.height<=347?(i.one(".photo-to-delete").setStyle("width",o.width),i.one(".photo-to-delete").setStyle("height",o.height)):u>a?(i.one(".photo-to-delete").setStyle("width",525),i.one(".photo-to-delete").setStyle("height",525*o.height/o.width)):(i.one(".photo-to-delete").setStyle("width",o.width*347/o.height),i.one(".photo-to-delete").setStyle("height",347)),i.one(".photo-to-delete").setAttribute("src",s),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",this.handleDeletePhotoConfirmClick,this)),this.fire("subviewViewEvent","getDialogOffset",function(t){f.deleteDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:f.appContext,offsetLeft:t}),f.deleteDialog.show()}),e.rapidTracker.beacon(this.name,"deletePhotoClick")},getDeleteBackgroundImageUrl:function(e){var t,n,r;return n=this.appContext.getViewer().getPixelRatio(),t={width:525*n,height:347*n},r=e.getSizeToFit(t),r},handleReplacePhotoClick:function(t){t.halt();var n=this.get("container"),r=this,i=this.get("photo").getValue("isVideo");if(i)return;this.moreMenu.hide(),this.fire("subviewViewEvent","getDialogOffset",function(t){r.replaceDialog=e.Views.dialog.getNewInstance("dialog-cta",{
id:"replace-"+r.photoId,attrs:{},template:"dialog-cta-reboot",content:r.templates("replace-photo-dialog-content"),parent:r,photoTitle:r.get("photo").getValue("title"),username:r.get("photo").getValue("owner").getValue("displayname"),rootEl:n.ancestor(".photo-page-view"),offsetLeft:t}),r.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];if(!t)return;r._imgFile=t,r.replaceConfirm()},":submit":function(){r.replaceSubmit()}}),r.replaceDialog.on("hide",function(){r._imgFileXhr&&r._imgFileXhr.abort(),r._imgFileXhr=null,r._imgFile=null,r.replaceDialog.destroy(),r.replaceDialog=null}),r.replaceDialog.show()}),e.rapidTracker.beacon(this.name,"replacePhotoClick")},replaceConfirm:function(){this.replaceDialog.set("fileName",this._imgFile.name),this.replaceDialog.renderContent({photoTitle:this.get("photo").getValue("title"),username:this.get("photo").getValue("owner").getValue("displayname")}),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t=new FormData,n=this,r,i,s="https://up.flickr.com/services/replace",o,u,a;this.replaceDialog.set("uploading",!0),this.replaceDialog.renderContent(),this.replaceDialog.switchToWorking(),t.append("api_key",e.config.flickr.api.site_key),t.append("csrf",e.config.flickr.csrf.token),t.append("photo",this._imgFile,this._imgFile.name),t.append("photo_id",this.photoId),r=this._imgFileXhr=new XMLHttpRequest,r.open("POST",s,!0),r.withCredentials=!0,u=function(e){var t=typeof e=="object"?e.target.statusText:e+"";n.replaceDialog.switchToWorking(!1),n.replaceDialog.set("error",!0),n.replaceDialog.renderContent(),n.appContext.error("[more-menu-view] photo-replace: error during upload ("+t+")")},a=function(e){var t,r,i;try{i=document.createElement("div"),i.innerHTML=e.target.responseText,r=i.getElementsByTagName("rsp")[0]||"",r&&(r=r.getAttribute("stat")||""),t=i.getElementsByTagName("err")[0]||"",t&&(t=t.getAttribute("msg")||"")}catch(s){r="",t=""}if(r!=="ok")return u((r||"empty")+": "+(t||"no message"));n.replaceDialog.close(),document.location.reload()},r.addEventListener("load",a),r.addEventListener("error",u),o=n.replaceDialog.get("container").one("progress").getDOMNode(),r.upload.addEventListener("progress",function(e){o.value=i=Math.floor(100*(e.loaded/e.total)),e.loaded===e.total&&o.removeAttribute("value")}),r.send(t)},handleRotatePhotoClick:function(t){t.halt();var n=this,r=240,i=this.get("photo").getValue("isVideo");if(i)return;this.moreMenu.hide(),this.fire("subviewViewEvent","getDialogOffset",function(t){n.rotateDialog=e.Views.dialog.getNewInstance("dialog-cta",{id:"rotate-"+n.photoId,attrs:{},template:"dialog-cta-reboot",content:n.templates("rotate-photo-dialog-content"),parent:n,offsetLeft:t}),n.rotateDialog.attachEvents({":select":function(t,r){n.rotateDialog.switchToLocked(!1),t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),n._imgRotation=e.flutil.constrainToValues(r.rotation,["90","180","270"])},":submit":function(){n.rotateSubmit()}}),n.rotateDialog.on("hide",function(){n.rotateDialog.destroy(),n.rotateDialog=null}),n.rotateDialog.set("preview",n.get("photo").getSizeToFit({width:r,height:r})),n.rotateDialog.switchToLocked(),n.rotateDialog.show()}),e.rapidTracker.beacon(this.name,"rotatePhotoClick")},rotateSubmit:function(){var t=this;this.rotateDialog.switchToWorking(),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick"),this.appContext.flickrAPI.callMethod("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation}).then(function(){setTimeout(function(){t.rotateDialog.close(),document.location.reload()},2e3)},function(e){t.rotateDialog.switchToWorking(!1),t.rotateDialog.set("error",!0),t.rotateDialog.renderContent(),t.appContext.error("[more-menu-view] photo-rotate: error during rotation ("+e.toString()+")")})},handleEditAviaryClick:function(t){t.halt();var n=this,r=this.get("photo").getValue("isVideo");if(r)return;this.moreMenu.hide(),this.aviary=new e.Views.Aviary({attrs:{},photo:this.get("photo"),appContext:this.appContext}),this.aviary.show(),this.on("destroy",function(){n.aviary.destroy()}),e.rapidTracker.beacon(this.name,"editAviary")},handleDeletePhotoConfirmClick:function(t){var n=this;e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),n.deleteDialog.close(),n.deleteDialog.destroy(),this.appContext.flickrAPI.callMethod("flickr.photos.delete",{photo_id:this.photoId}).then(function(e){var t=n.get("photo").getValue("owner");window.location="/photos/"+(t.getValue("pathAlias")||t.getValue("nsid"))+"/?deleted="+n.photoId},function(e){n.onError(n.intlMessage({intlName:"more-menu-view.PROBLEM_DELETING"}))})},handleCommentPermissionChangeClick:function(t){e.rapidTracker.beacon(this.name,"photoCommentPermissionConfirmationClick");var n=this.get("photoPrivacy"),r=this.get("container");t.target.hasClass("selected-comment-permission")||(t.target.hasClass("commenting-off")?n.setValue("permComment",0):n.setValue("permComment",3),n.getValue("permComment")?(r.one(".commenting-on").addClass("selected-comment-permission"),r.one(".commenting-off").removeClass("selected-comment-permission")):(r.one(".commenting-off").addClass("selected-comment-permission"),r.one(".commenting-on").removeClass("selected-comment-permission")),n.remoteUpdate())},handleUnimplementedClick:function(t){var n=this.templates("reboot-unimplemented-feature-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),r=[],i=this;if(t.target.hasClass("isVideo")){t.halt();return}this.moreMenu.hide(),this.unimplementedFeatureDialog?i.unimplementedFeatureDialog.show():(this.appContext.experiments.optOut.enabled()&&r.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":window.location.pathname}))}),this.fire("subviewViewEvent","getDialogOffset",function(t){i.unimplementedFeatureDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:
{title:i.intlMessage({intlName:"common.ZOINKS"}),hideConfirmButton:!0,useCancelButton:!0,cancelButtonText:i.intlMessage({intlName:"common.CANCEL"}),verticalButtonList:!0,additionalButtons:r},content:n,parent:i,offsetLeft:t}),i.unimplementedFeatureDialog.show()})),e.rapidTracker.beacon(this.name,"moreMenuUnimplementedFeatureClick")},handleAddLocationClick:function(t){var n=this.get("photo"),r=this,i=n.getValue("id"),s,o,u=this.templates("temporary-organizr-dialog-content")();this.moreMenu.hide(),s=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:this.intlMessage({intlName:"more-menu-view.ADD_LOCATION"}),icon:"ui-icon-modal-warning",organizrLink:"/photos/organize/?batch_geotag=1&ids="+i+"&from_geo_ids="+i+"",content:u}),s.render(),s.activate(),o=s.get("container"),s.registerEventHandler(o.one(".ui-dialog-button-confirm").on("click",function(){r.addLocationDialog.close(),r.addLocationDialog.destroy()})),this.fire("subviewViewEvent","getDialogOffset",function(t){r.addLocationDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:s.get("container"),appContext:r.appContext,offsetLeft:t}),r.addLocationDialog.show()}),e.rapidTracker.beacon(this.name,"moreMenuAddLocationClick")},handleAddPeopleClick:function(t){if(this.appContext.flipper.isFlipped("people-tagging"))this.moreMenu.hide(),e.fire("flickr:photo-page-open-add-people-tag");else{var n=this.get("photo"),r=n.getValue("id"),i=this.get("container"),s=this.templates("temporary-organizr-dialog-content")();this.moreMenu.hide(),this.addPeopleDialog||(this.addPeopleDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:this.intlMessage({intlName:"more-menu-view.PEOPLE_TAGGING"}),hideConfirmButton:!0,useCancelButton:!0,cancelButtonText:this.intlMessage({intlName:"common.CANCEL"}),verticalButtonList:!0,additionalButtons:[{buttonMarkup:new e.Handlebars.SafeString('<a class="ui-button" href="/photos/organize/?ids='+r+'&edit_pop=add_people" target="_blank"><span>'+this.intlMessage({intlName:"more-menu-view.OPEN_IN_ORGANIZER"})+"</span></a>")}]},content:s,parent:this,rootEl:i.ancestor(".photo-page-view")})),this.addPeopleDialog.show()}e.rapidTracker.beacon(this.name,"moreMenuAddPeopleClick")},showDateEditor:function(t){var n,r=this;t.halt(),this.moreMenu.hide(),n=new e.Views["date-modify-dialog-view"]({photoID:this.photoId,dateTaken:this.get("stats").getDateObj("dateTaken"),datePosted:this.get("stats").getDateObj("datePosted"),earliestPosted:this.get("person").getValue("dateCreated")}),n.appContext=this.appContext,n.buildContainer(),n.on("subviewViewEvent",function(e){e&&e.details&&e.details.length===2&&r.fire("subviewViewEvent",e.details[0],e.details[1])}),this.fire("subviewViewEvent","getDialogOffset",function(t){r.editDateDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:r.appContext,offsetLeft:t}),r.editDateDialog.show(),n.activate()}),e.rapidTracker.beacon(this.name,"moreMenuEditDateClick")},activate:function(){var t=this,n=this.get("container"),r,i={};return this.appContext.experiments.fullscreen.getMode()||(this.setupDropdown(),r=t.moreMenu.get("container"),this.registerEventHandler(e.on("flickr:photo-sidebar-action-more-expand",function(){this.moreMenu.toggle()},this))),n&&this.registerEventHandler(n.on("click",this.handleMenuButtonClick,this)),this.appContext.experiments.fullscreen.getMode()||(this.appContext.auth.signedIn&&(this.appContext.getModel("person-preferences-models",this.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),i.flagMenuItem=r.one(".flag-photo"),i.flagMenuItem&&i.flagMenuItem.on("click",t.handleFlagPhotoClick,t)}),this.appContext.getModel("photo-privacy-models",this.get("photo").getValue("id")).then(function(e){t.set("photoPrivacy",e),i.commentMenuItemOn=r.one(".commenting-on"),i.commentMenuItemOff=r.one(".commenting-off");if(i.commentMenuItemOn||i.commentMenuItemOff)i.commentMenuItemOn.on("click",t.handleCommentPermissionChangeClick,t),i.commentMenuItemOff.on("click",t.handleCommentPermissionChangeClick,t);i.reportPhotoMenuItem=r.one(".report-photo"),i.reportPhotoMenuItem&&i.reportPhotoMenuItem.on("click",function(){document.location="/abuse/"},t)}),i.deleteMenuItem=r.one(".delete-photo"),i.deleteMenuItem&&i.deleteMenuItem.on("click",t.handleDeletePhotoClick,t),i.rotateMenuItem=r.one(".rotate-photo"),i.rotateMenuItem&&i.rotateMenuItem.on("click",t.handleRotatePhotoClick,t),i.replaceMenuItem=r.one(".replace-photo"),i.replaceMenuItem&&i.replaceMenuItem.on("click",t.handleReplacePhotoClick,t),i.aviaryMenuItem=r.one(".edit-aviary"),i.aviaryMenuItem&&i.aviaryMenuItem.on("click",t.handleEditAviaryClick,t),i.addToSetItem=r.one(".add-to-set"),i.addToSetItem&&(i.addToSetItem.on("click",t.handleAddToSetClick,t),t.attachKeyEvent("down:65,69",t.handleAddToSetClick.bind(t)),e.on("flickr:photo-page-open-add-set",t.handleAddToSetClick.bind(t))),i.addToGalleryItem=r.one(".add-to-gallery"),i.addToGalleryItem&&(i.addToGalleryItem.on("click",t.handleAddToGalleryClick,t),t.attachKeyEvent("down:65",t.handleAddToGalleryClick.bind(t)),e.on("flickr:photo-page-open-add-gallery",t.handleAddToGalleryClick.bind(t))),i.addToGroupItem=r.one(".add-to-group"),i.addToGroupItem&&(i.addToGroupItem.on("click",t.handleAddToGroupClick,t),t.attachKeyEvent("down:71",t.handleAddToGroupClick.bind(t)),e.on("flickr:photo-page-open-add-group",t.handleAddToGroupClick.bind(t))),i.addLocationItem=r.one(".add-location"),i.addLocationItem&&i.addLocationItem.on("click",t.handleAddLocationClick,t),i.addPeopleItem=r.one(".add-people"),i.addPeopleItem&&i.addPeopleItem.on("click",t.handleAddPeopleClick,t),t.appContext.flipper.isFlipped("show-edit-date-dialog")&&(i.editDateItem=r.one(".edit-title-tags-dates"),i.editDateItem&&i.editDateItem.on("click",t.showDateEditor,t)),this.optOutEnabled||(i.feedbackItem=r.one(".feedback"),i.feedbackItem&&i.feedbackItem.on("click",function(n){n.halt(),e.rapidTracker.beacon(t.name,"feedbackMenuClick"),t.fire("subviewViewEvent"
,"setRedirect",function(){window.location.href="https://yahoo.uservoice.com/forums/230787-flickr-photo-page-beta"})})),i.unimplementedMenuItems=r.all(".unavailable-feature"),i.unimplementedMenuItems&&i.unimplementedMenuItems.on("click",t.handleUnimplementedClick,t)),t.appContext.flipper.isFlipped("download-dialog-enabled")&&(i.downloadMenuItem=r.one(".view-all-sizes"),i.downloadMenuItem&&(t.attachKeyEvent("down:68",t.handleDownloadClick.bind(t)),i.downloadMenuItem.on("click",t.handleDownloadClick,t))),this.optOutEnabled||(i.feedbackItem=r.one(".feedback"),i.feedbackItem&&i.feedbackItem.on("click",function(n){n.halt(),e.rapidTracker.beacon(t.name,"feedbackMenuClick"),t.fire("subviewViewEvent","setRedirect",function(){window.location.href="https://yahoo.uservoice.com/forums/230787-flickr-photo-page-beta"})}))),this},onParentViewEvent:function(e,t){if(t&&t.length>0&&t[0]==="rightClickPhoto")return this.showDownloadDialog(),!1}})},"@VERSION@",{requires:["flickr-view","dialog","flutil","hermes-template-dialog-cta-reboot","flickr-promise","aviary","more-menu-css","download-dialog-css","confirmation-dialog-view","set-selection-dialog-view","gallery-selection-dialog-view","group-selection-dialog-view","date-modify-dialog-view","date-modify-css","hermes-template-more-button","hermes-template-more-menu","hermes-template-temporary-organizr-dialog-content","hermes-template-flag-photo-dialog-content","hermes-template-delete-photo-dialog-content","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","hermes-template-photo-comment-permission-dialog-content","hermes-template-reboot-unimplemented-feature-dialog-content","hermes-template-photo-opt-out","hermes-template-download-dialog"],optional:["set-models"],langBundles:["more-menu-view","common"]});
YUI.add("hermes-lang-more-menu-view",function(e,t){e.Intl.add("hermes/more-menu-view","en-US",{ADD_TO_ALBUM:["Add to album"],ADD_TO_SET:["Add to set"],ADD_TO_GROUP:["Add to group"],INVITE_TO_GROUP:["Invite to group"],ADD_TO_GALLERY:["Add to Gallery"],ADD_TO_REMOVE_FROM_ALBUM:["Add to / remove from album"],ADD_TO_REMOVE_FROM_SET:["Add to / remove from set"],ADD_TO_REMOVE_FROM_GALLERY:["Add to / remove from gallery"],ADD_TO_REMOVE_FROM_GROUP:["Add to / remove from group"],INVITE_TO_REMOVE_FROM_GROUP:["Invite to / remove from group"],FLAG_PHOTO:["Flag this Photo?"],FLAG:["Flag photo"],MARK_FOR_REVIEW:["Mark for review"],PHOTO_HAS_BEEN_FLAGGED:["This photo has been flagged"],PROBLEM_FLAGGING:["There was a problem flagging this photo"],ADD_PHOTO_TO_GROUP:["Add this photo to a group"],INVITE_PHOTO_TO_GROUP:["Invite this photo to a group"],ADD_PHOTO_TO_GALLERY:["Add this photo to a gallery"],ADD_PHOTO_TO_ALBUM:["Add photo to an album"],ADD_PHOTO_TO_SET:["Add photo to a set"],NO_GROUPS:["You're not in any groups! <a href='//www.flickr.com/groups'>Why not join one</a>?"],NO_GROUPS2:["You're not in any groups! <a href='","${url}","'>Why not join one</a>?"],NO_GROUPS_ADMIN:["You're not an admin of any groups! <a href='//www.flickr.com/groups_create.gne'>Why not create one</a>?"],NO_GROUPS_ADMIN2:["You're not an admin of any groups! <a href='","${url}","'>Why not create one</a>?"],NO_GALLERIES:["No galleries"],NO_ALBUMS:["No albums"],NO_SETS:["No sets"],LOADING_GROUPS:["Loading groups..."],LOADING_GALLERIES:["Loading galleries..."],LOADING_ALBUMS:["Loading albums..."],LOADING_SETS:["Loading sets..."],SEARCH_GROUPS_PLACEHOLDER:["search groups"],SEARCH_GALLERIES_PLACEHOLDER:["search galleries"],SEARCH_ALBUMS_PLACEHOLDER:["search albums"],SEARCH_SETS_PLACEHOLDER:["search sets"],GALLERY_TITLE_PLACEHOLDER:["gallery title (required)"],GALLERY_DESCRIPTION_PLACEHOLDER:["gallery description"],ALBUM_TITLE_PLACEHOLDER:["Album title"],SET_TITLE_PLACEHOLDER:["Set title"],DESCRIPTION_PLACEHOLDER:["Description (optional)"],CREATE_NEW_GALLERY:["Create a new gallery"],CREATE_NEW_ALBUM:["Create new album"],CREATE_NEW_SET:["Create new set"],CREATE_GALLERY:["Create gallery"],CREATE_SET:["Create set"],CREATE_ALBUM:["Create album"],BACK_TO_GALLERIES:["Back to current galleries"],BACK_TO_ALBUMS:["Back to current albums"],BACK_TO_SETS:["Back to current sets"],GROUP_PRIVACY_WARNING:["This photo is private. If you add it to a group, the members of that group will be able to view, comment on, tag and add notes to it."],DONT_SHOW_ME_AGAIN:["Don't show me this message again"],DELETE_PHOTO:["Delete Photo"],PERMANENTLY_DELETE_PHOTO:["Permanently Delete This Photo"],PROBLEM_DELETING:["There was a problem deleting this photo"],ADD_LOCATION:["Add Location"],ADD_PEOPLE:["Add people"],DOWNLOAD_ALL_SIZES:["Download / All sizes"],EDIT_DATES:["Edit dates"],EDIT_TITLE_TAGS_DATES:["Edit title, tags, and dates"],ROTATE:["Rotate"],REPLACE:["Replace"],VIDEOS_NO_EDIT_IN_AVIARY:["Videos cannot be edited in Aviary"],EDIT_IN_AVIARY:["Edit in Aviary"],COMMENTING:["Commenting"],REPORT_ABUSE:["Report abuse"],FEEDBACK:["Feedback"],PEOPLE_TAGGING:["People tagging!"],OPEN_IN_ORGANIZER:["Open In Organizr"],MORE_ACTIONS:["More Actions"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-sidebar-actions-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:["photo-sidebar-actions-view"],subviewConfig:{"fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"more-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},initializer:function(e){return this.photoId=e.photoId,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this.isFullscreen=this.appContext.experiments.fullscreen.getMode(),this.signinPendingQueue=e.signinPendingQueue,this},loadState:function(){var t=this;return e.batch(t.appContext.getModel("photo-engagement-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)).then(function(e){t.set("photo-engagement",e[0]),t.set("photo",e[1])})},buildContainer:function(){var e=this.get("photo-engagement"),t;return t=this.templates("photo-sidebar-actions")({photo:e.toJSON(),"fave-view":this.subviews["fave-view"].get("container"),"more-menu-view":this.subviews["more-menu-view"].get("container"),realFullscreen:this.realFullscreen,"is-fullscreen":this.isFullscreen}),this.setContainerHTML(t),this},commentClicked:function(t){function s(){e.SigninHelper.addPendingComment({id:self.photoId})}if(t.ctrlKey)return;var n,r,i;t.preventDefault(),t.stopPropagation(),this.appContext.experiments.fullscreen.getMode()&&this.appContext.getViewer().signedIn?(setTimeout(function(){e.fire("flickr:photo-sidebar-actions-focus-comment-form")},1500),this.appContext.flapp.navigate(e.config.doc.location.href.replace("/lightbox",""))):this.appContext.getViewer().signedIn?(i=this.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"),i&&i.focus()):(n=new e.Views["confirmation-dialog-view"]({title:this.intlMessage({intlName:"photo-sidebar-actions-view.OOPS"}),icon:"ui-icon-modal-error",content:this.intlMessage({intlName:"photo-sidebar-actions-view.SIGN_IN_TO_COMMENT"}),confirmButtonLabel:this.intlMessage({intlName:"photo-sidebar-actions-view.SIGN_IN"}),cancelButtonLabel:this.intlMessage({intlName:"photo-sidebar-actions-view.CANCEL"})}),n.appContext=this.appContext,n.render(),n.activate(),r=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),r.show(),n.registerEventHandler(n.get("container").one(".ui-dialog-button-confirm").on("click",function(){r.close(),r.destroy(),s()}))),e.rapidTracker.beacon(this.name,"commentActionBarButtonClick")},menuItemsOpened:function(t){this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()&&(t.preventDefault(),t.stopPropagation(),e.fire("flickr:photo-sidebar-fullscreen-expand"),t.keyCode===65?setTimeout(function(){e.fire("flickr:photo-page-open-add-gallery",t)},500):t.keyCode===69?setTimeout(function(){e.fire("flickr:photo-page-open-add-set",t)},500):t.keyCode===71?setTimeout(function(){e.fire("flickr:photo-page-open-add-group",t)},500):t.keyCode===84&&setTimeout(function(){e.fire("flickr:photo-page-open-add-tag",t)},500))},moreClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"detailedViewActionBarButtonClick")},downloadClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"downloadActionBarButtonClick")},infoClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"infoActionBarButtonClick")},shareClicked:function(t){var n=this,r=this.subviews["share-view"];t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"shareActionBarButtonClick");if(r)return r.fire("subviewViewEvent","openShareMenu",{}),r[r.isVisible()?"hide":"show"]();this.appContext.getView("share-view",{photoId:this.get("photo-engagement").id,anchorTo:n.get("container").one(".share"),arrow:!0,parent:this}).then(function(e){n.subviews["share-view"]=e,e.switchToLoading(),e.initialize().then(function(){e.show()})}).then(null,function(e){n.appContext.warn(e)})},activate:function(){var t=this.get("container"),n,r=this;return t&&(t.one(".comment")&&this.registerEventHandler(t.one(".comment").on("click",this.commentClicked,this)),t.one(".share")&&this.registerEventHandler(t.one(".share").on("click",this.shareClicked,this)),e.on("flickr:photo-sidebar-actions-focus-comment-form",function(){r.get("container").ancestor(".photo-sidebar-view")?n=r.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"):(n=e.one(".sub-photo-comments-view textarea"),n&&n.scrollIntoView()),n&&n.focus()}),this.appContext.experiments.fullscreen.getMode()&&(t.one(".more")&&this.registerEventHandler(t.one(".more").on("click",this.moreClicked,this)),t.one(".download")&&this.registerEventHandler(t.one(".download").on("click",this.downloadClicked,this)),t.one(".info")&&this.registerEventHandler(t.one(".info").on("click",this.infoClicked,this)))),this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(e){e.commentCount&&t.one(".comment span.button-comment-count").set("text",e.commentCount.newVal)})),this.attachKeyEvent("down:67",this.commentClicked.bind(this)),this.appContext.experiments.fullscreen.getMode()&&this.attachKeyEvent("down:71,65,69,84",this.menuItemsOpened.bind(this)),this}})},"@VERSION@",{requires:["flickr-view","flickrui-css","hermes-template-photo-sidebar-actions","photo-sidebar-actions-css","share-view","dialog","signin-helper"],optional:["fave-view","more-menu-view","photo-engagement-models"],langBundles:["photo-sidebar-actions-view"]});
YUI.add("hermes-lang-photo-sidebar-actions-view",function(e,t){e.Intl.add("hermes/photo-sidebar-actions-view","en-US",{OOPS:["Oops!"],SIGN_IN_TO_COMMENT:["So you want to comment? Sign in and try again."],SIGN_IN:["Sign in"],CANCEL:["Forget it"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-comment",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=(r=e.author,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function v(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=e.author,r==null||r===!1?r:r.buddyicon),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function m(e,t){var r="",i;r+="\n				",i=n["if"].call(e,e.commentBelongsToViewer,{hash:{},inverse:c.program(12,E,t),fn:c.program(6,g,t),data:t});if(i||i===0)r+=i;r+="\n				",i=n["if"].call(e,e.canCommentBeDeleted,{hash:{},inverse:c.noop,fn:c.program(20,C,t),data:t});if(i||i===0)r+=i;return r+='\n				<a href="',(i=n.permalink)?i=i.call(e,{hash:{},data:t}):(i=e.permalink,i=typeof i===f?i.apply(e):i),r+=l(i)+'" class="comment-permalink ui-icon-comment-permalink" data-track="commentPermalinkClick" data-action="follow"></a>\n			',r}function g(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.noIcons,{hash:{},inverse:c.program(9,b,t),fn:c.program(7,y,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function y(e,t){return"\n					"}function b(e,t){var r="",i;r+="\n						",i=n["if"].call(e,e.enabledEditableComments,{hash:{},inverse:c.noop,fn:c.program(10,w,t),data:t});if(i||i===0)r+=i;return r+="\n					",r}function w(e,t){var r="",i;return r+='\n							<a href="#" class="comment-edit ui-icon-comment-edit" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="edit" title="Edit"></a>\n						',r}function E(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.canComment,{hash:{},inverse:c.noop,fn:c.program(13,S,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function S(e,t){var r="",i,s,o;r+='\n						<a href="#" class="comment-reply ',i=n["if"].call(e,e.noIcons,{hash:{},inverse:c.program(16,T,t),fn:c.program(14,x,t),data:t});if(i||i===0)r+=i;r+='" data-pathalias="'+l((i=(i=e.author,i==null||i===!1?i:i.pathAlias),typeof i===f?i.apply(e):i))+'" data-action="reply" title="Reply">',o={hash:{},inverse:c.noop,fn:c.program(18,N,t),data:t},(s=n.noIcons)?s=s.call(e,o):(s=e.noIcons,s=typeof s===f?s.apply(e):s),n.noIcons||(s=h.call(e,s,o));if(s||s===0)r+=s;return r+="</a>\n					",r}function x(e,t){var n="";return n}function T(e,t){return"ui-icon-comment-reply"}function N(e,t){return"Reply"}function C(e,t){var r="",i;return r+='\n					<a href="#" class="comment-delete ui-icon-comment-delete" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="delete" title="Delete"></a>\n				',r}function k(e,t){var r="",i,s;return r+='\n        <div class="comment-content">',s={hash:{},data:t},r+=l((i=n.renderSafeInlineComment||e.renderSafeInlineComment,i?i.call(e,e.contentSecure,e.ellipsis,s):p.call(e,"renderSafeInlineComment",e.contentSecure,e.ellipsis,s)))+"</div>\n	",r}function L(e,t){var r="",i,s;return r+='\n        <div class="comment-content">',s={hash:{},data:t},r+=l((i=n.renderTrustedMarkupWithLineBreaks||e.renderTrustedMarkupWithLineBreaks,i?i.call(e,e.contentSecure,s):p.call(e,"renderTrustedMarkupWithLineBreaks",e.contentSecure,s)))+"</div>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<li class="comment" id="',a={hash:{},data:i},s+=l((o=n.commentPermalinkId||t.commentPermalinkId,o?o.call(t,t.id,a):p.call(t,"commentPermalinkId",t.id,a)))+'">\n	<div class="comment-icon circle-icon">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentBuddyIconClick" data-action="follow">\n		',u=n["if"].call(t,(o=(o=t.author,o==null||o===!1?o:o.buddyicon),o==null||o===!1?o:o["default"]),{hash:{},inverse:c.program(3,v,i),fn:c.program(1,d,i),data:i});if(u||u===0)s+=u;s+='\n		</a>\n	</div>\n	<p class="comment-author">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentUserNameClick" data-action="follow">\n			',a={hash:{},data:i},s+=l((o=n.truncate||t.truncate,o?o.call(t,(o=t.author,o==null||o===!1?o:o.displayname),20,a):p.call(t,"truncate",(o=t.author,o==null||o===!1?o:o.displayname),20,a)))+'\n		</a>\n		<span class="comment-actions">\n			',u=n["if"].call(t,t.isSignedIn,{hash:{},inverse:c.noop,fn:c.program(5,m,i),data:i});if(u||u===0)s+=u;s+='\n		</span>\n	</p>\n	<div class="comment-date">',(u=n.timeago)?u=u.call(t,{hash:{},data:i}):(u=t.timeago,u=typeof u===f?u.apply(t):u),s+=l(u)+"</div>\n	",u=n["if"].call(t,t.isTooltipComment,{hash:{},inverse:c.program(24,L,i),fn:c.program(22,k,i),data:i});if(u||u===0)s+=u;return s+="\n</li>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comment",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-comments",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function u(e,t){var r="",i;r+="\n	<ul class='comments'>\n		",i=n.each.call(e,e.comments,{hash:{},inverse:o.noop,fn:o.program(2,a,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function a(e,t){var i="",s;i+="\n			",s=o.invokePartial(r.comment,"comment",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s,o=this;return s=n["if"].call(t,t.comments,{hash:{},inverse:o.noop,fn:o.program(1,u,i),data:i}),s||s===0?s:""}),r={};e.Array.each(["comment"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comments",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-comment"]});
YUI.add("hermes-template-comment-form",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n		<div class="comment-icon circle-icon">\n			',s=n["if"].call(e,(i=(i=e.user,i==null||i===!1?i:i.buddyicon),i==null||i===!1?i:i.medium),{hash:{},inverse:f.program(4,h,t),fn:f.program(2,c,t),data:t});if(s||s===0)r+=s;return r+='\n		</div>\n		<div class="comment-form-field">\n			<textarea class="new-comment-text" name="comment" placeholder="Add a comment" data-notutorial="Add a comment" data-tutorial="press Enter to post and Shift+Enter for newline" data-action="comment"></textarea>\n			<textarea class="false-comment-content"></textarea>\n		</div>\n	',r}function c(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r.medium),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function h(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function p(e,t){return'\n		<div class="comment-form-field is-logged-out">\n			<a href="#"></a>\n			<textarea name="comment" disabled placeholder="You must be signed in to post a comment" data-action="comment"></textarea>\n		</div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="comments-form">\n	',o=n["if"].call(t,t.user,{hash:{},inverse:f.program(6,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comment-form",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-comments-view",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){return'\n	<div class=\'loadingError\'>\n		<p>Error loading comments</p>\n		<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">Retry</button></p>\n	</div>\n'}function l(e,t){var r="",i;r+="\n	<div class='comments-holder order-",(i=n.commentsOrder)?i=i.call(e,{hash:{},data:t}):(i=e.commentsOrder,i=typeof i===o?i.apply(e):i),r+=u(i)+" ",(i=n.photosInCommentsClass)?i=i.call(e,{hash:{},data:t}):(i=e.photosInCommentsClass,i=typeof i===o?i.apply(e):i),r+=u(i)+"'>\n		",i=n["if"].call(e,e.commentsChronological,{hash:{},inverse:a.program(12,m,t),fn:a.program(4,c,t),data:t});if(i||i===0)r+=i;return r+="\n	</div>\n",r}function c(e,t){var i="",s;i+="\n			",s=n["if"].call(e,e.showMore,{hash:{},inverse:a.noop,fn:a.program(5,h,t),data:t});if(s||s===0)i+=s;i+="\n			",s=a.invokePartial(r.comments,"comments",e,n,r,t);if(s||s===0)i+=s;i+="\n			",s=n["if"].call(e,e.canComment,{hash:{},inverse:a.noop,fn:a.program(10,v,t),data:t});if(s||s===0)i+=s;return i+="\n		",i}function h(e,t){var r="",i;r+="\n				<div class='comments-more'>\n					<i class=\"ui-icon-comments\"></i>\n					",i=n["if"].call(e,e.isTooltipComments,{hash:{},inverse:a.program(8,d,t),fn:a.program(6,p,t),data:t});if(i||i===0)r+=i;return r+="\n				</div>\n			",r}function p(e,t){var r="",i;return r+='\n                        <a href="',(i=n.photoUrl)?i=i.call(e,{hash:{},data:t}):(i=e.photoUrl,i=typeof i===o?i.apply(e):i),r+=u(i)+'" data-action="follow" >',(i=n.showMoreString)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreString,i=typeof i===o?i.apply(e):i),r+=u(i)+"</a>\n					",r}function d(e,t){var r="",i;return r+="\n                        <a href='#'>",(i=n.showMoreString)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreString,i=typeof i===o?i.apply(e):i),r+=u(i)+"</a>\n					",r}function v(e,t){var i="",s;i+="\n				",s=a.invokePartial(r["comment-form"],"comment-form",e,n,r,t);if(s||s===0)i+=s;return i+="\n			",i}function m(e,t){var i="",s;i+="\n			",s=n["if"].call(e,e.canComment,{hash:{},inverse:a.noop,fn:a.program(10,v,t),data:t});if(s||s===0)i+=s;i+="\n			",s=a.invokePartial(r.comments,"comments",e,n,r,t);if(s||s===0)i+=s;i+="\n			",s=n["if"].call(e,e.showMore,{hash:{},inverse:a.noop,fn:a.program(13,g,t),data:t});if(s||s===0)i+=s;return i+="\n		",i}function g(e,t){var r="",i;return r+="\n				<div class='comments-more'><a href='#'>",(i=n.showMoreCount)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreCount,i=typeof i===o?i.apply(e):i),r+=u(i)+" more</a></div>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t.loadingError,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each(["comments","comment-form","comment-form","comments"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/comments-view",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-comments","hermes-template-comment-form","hermes-template-comment-form","hermes-template-comments"]});
YUI.add("flickr-photos-comments-addComment-creator",function(e){"use strict";function t(e){var t={extras:"icon_urls"};return t.photo_id=e.photoId,t.comment_text=e.commentText,t.expand_bbml=!0,t.use_text_for_links=1,t.secure_image_embeds=1,e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s={id:n.comment.author,username:n.comment.authorname,pathAlias:n.comment.pathAlias,realname:n.comment.realname,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(n.comment.iconurls),isPro:n.comment.ispro,isAdFree:n.comment.isAdFree},o=r.exists(n.comment.author)?r.proxy(n.comment.author):r.add(s);return i.add({id:n.comment.id,author:o,date:n.comment.datecreate,permalink:n.comment.permalink,content:n.comment.content,contentRaw:n.comment.rawComment.content,contentSecure:n.comment.secureComment.content})}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.addComment",this._processParams(t)),n.getModelRegistry("person-models"),n.getModelRegistry("comment-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-addComment-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photos-comments-addComment"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-photos-comments-editComment-updater",function(e){"use strict";function t(e){var t={extras:"icon_urls"};return t.comment_id=e.commentId,t.comment_text=e.content,t.expand_bbml=!0,t.full_result=1,t.use_text_for_links=1,t.secure_image_embeds=1,e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(e){var t=e[0],n=e[1];return n.setValues({content:t.comment.content,contentRaw:t.comment.rawComment.content,contentSecure:t.comment.secureComment.content}),n}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.editComment",this._processParams(t)),n.getModel("comment-models",t.commentId)).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-editComment-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-comments-editComment"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-photos-comments-deleteComment-deletor",function(e){"use strict";function t(e,t){var n={};return n.comment_id=e,t.callAPI("flickr.photos.comments.deleteComment",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-comments-deleteComment-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelDeletors")["flickr-photos-comments-deleteComment"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-comments-addComment"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-photos-comments-editComment"].run({commentId:t,content:n.content.newVal,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")},this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-comments-deleteComment"].run(t,this.appContext)}},attributes:{author:{isModel:!0},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,n){return e.moment.unix(this.getValue(n,"date")).fromNow()}},permalink:{},content:{},contentSecure:{},contentRaw:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-photos-comments-addComment-creator","flickr-photos-comments-editComment-updater","flickr-photos-comments-deleteComment-deletor"]});
YUI.add("photo-comments-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{comments:{isListProxy:!0,rangeFetch:{listFetcher:e.ListFetchers["flickr-photos-comments-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-comments-getList-fetcher"]});
YUI.add("flickr-photos-comments-getList-fetcher",function(e){"use strict";function t(e){var t={photo_id:e.id,offset:e.offset||0,limit:e.limit||4,sort:e.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:!0,use_text_for_links:1,secure_image_embeds:1};return e.photosInCommentsEnabled&&(t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=240),t}function n(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=[],u=typeof n.comments.comment=="undefined"?0:n.comments.comment.length,a,f,l,c,h;return u>0&&e.Array.each(n.comments.comment,function(t,n,r){a={id:t.author,username:t.authorname,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro},a.pathAlias=t.pathAlias,l=s.exists(t.author)?s.proxy(t.author):s.add(a),f={id:t.id,author:l,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},o.push(i.exists(t.id)?i.proxy(t.id):i.add(f))}),r.exists(n.comments.photoId)?(c=r.proxy(n.comments.photoId).getValue("comments").getList(),h=c.concat(o),r.proxy(n.comments.photoId).setValue("comments",h)):r.add({id:n.comments.photoId,comments:o}),o}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.getList",this._processParams(t)),n.getModelRegistry("photo-comments-models"),n.getModelRegistry("comment-models"),n.getModelRegistry("person-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});
YUI.add("comments-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:["comments"],initializer:function(e){return this.photoId=e.photoId,this.appContext.flipper.isFlipped("comments-chronological")?(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:3,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:200):(this.initiallyShowingMaximum=e.initiallyShowingMaximum?e.initiallyShowingMaximum:4,this.showMoreMaximum=e.showMoreMaximum?e.showMoreMaximum:10),this.isTooltipComments=e.isTooltipComments?!0:!1,this.currentlyShowingCount=0,this.initiallyShowingCount=0,this.textAreaMaxHeight=180,this.textAreaMinHeight=35,this.textAreaUserSetHeight=this.textAreaMinHeight,this.noIcons=e.noIcons,this.postingComment=!1,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelsRegistry=e})),n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(n){t.photoEngagement=n;var r=t.photoEngagement.getValue("commentCount"),i=e.config.win.location.hash,s=/#comment{1}/g;i&&s.test(i)?(t.initiallyShowingCount=r,t.currentlyShowingCount=r):r>=t.initiallyShowingMaximum?(t.initiallyShowingCount=t.initiallyShowingMaximum,t.currentlyShowingCount=t.initiallyShowingMaximum):(t.initiallyShowingCount=r,t.currentlyShowingCount=r)}).then(function(){return t.appContext.getModel("photo-comments-models",t.photoId)}).then(function(e){t.photoComments=e;if(t.photoEngagement.getValue("commentCount")>0)return t.photoComments.getValue("comments").getRange({offset:0,limit:t.initiallyShowingCount,photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){t.set("comments",e)});t.set("comments",[])})),n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){t.photoModel=e})),this.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-models",t.appContext.getViewer().nsid).then(function(e){t.person=e})),e.batch.apply(null,n)},buildContainer:function(){var t,n=this.photoModel.getValue("url"),r=this.person?this.person.toJSON():null,i=this.get("comments"),s=this.appContext.flipper.isFlipped("comments-chronological")?"chronological":"reverse-chronological",o=this.calculateShowMoreCount(),u=o===1?"1 more comment":o+" more comments",a,f=e.config.win.location.hash,l=/#comment{1}/g;this.appContext.flipper.isFlipped("comments-chronological")&&(i=i.reverse()),this.isTooltipComments&&(this.ellipsis=this.intlMessage({intlName:"comments.SEE_MORE_LINK",photoUrl:n}));for(a=0;a<i.length;a++)i[a]=i[a].toJSON?i[a].toJSON():i[a],i[a].isSignedIn=this.appContext.getViewer().signedIn,i[a].isLoggedInUsersPhoto=this.isLoggedInUsersPhoto(),i[a].canCommentBeDeleted=this.canCommentBeDeleted(i[a].author.nsid),i[a].commentBelongsToViewer=this.commentBelongsToViewer(i[a].author.nsid),i[a].enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i[a].canComment=this.photoModel.getValue("canComment"),i[a].isTooltipComment=this.isTooltipComments,i[a].ellipsis=this.ellipsis,i[a].noIcons=this.noIcons;return t=this.templates("comments-view")({user:r,comments:i,showMore:this.calculateShowMoreCount()>0?!0:!1,showMoreCount:this.calculateShowMoreCount(),showMoreString:u,canComment:this.photoModel.getValue("canComment"),tutorialMode:!0,isTooltipComments:this.isTooltipComments,photoUrl:n,commentsOrder:s,commentsChronological:this.appContext.flipper.isFlipped("comments-chronological"),photosInCommentsClass:this.appContext.flipper.isFlipped("photos-in-comments")?"photosInComments":""}),this.setContainerHTML(t),this.retinafyCommentImages(),f&&l.test(f)&&this.jumpToPermalinkedComment(),this},buildErrorContainer:function(){this.setContainerHTML(this.templates("comments-view")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container").one(".new-comment-text");return t.get("container").one(".comments-more")&&t.registerEventHandler(t.get("container").one(".comments-more a").on("click",t.handleMoreCommentsClick.bind(t))),e.use("transition",function(e){t.attachEvents({"keydown:comment":t.handleCommentKeyDown.bind(t),"blur:comment":t.handleCommentBlur.bind(t),"focus:comment":t.handleCommentFocus.bind(t),"mouseup:comment":t.handleCommentMouseUp.bind(t),"mouseleave:comment":t.handleCommentMouseLeave.bind(t),"mousedown:comment":t.handleCommentMouseDown.bind(t),".comment-reply click:reply":t.handleReplyClick.bind(t),".comment-delete click:delete":t.handleDeleteClick.bind(t),".comment-edit click:edit":t.handleEditClick.bind(t)})}),n&&n.setStyles({minHeight:this.textAreaMinHeight+"px",maxHeight:this.textAreaMaxHeight+"px"}),this},postComment:function(t){var n=this,r,i,s,o,u=this.photoEngagement.getValue("commentCount");n.fire("addingNewComment");if(e.Lang.trim(t)===""){this.onError("An empty comment box? That won't work!"),this.postingComment=!1;return}e.rapidTracker.beacon(this.name,"commentPosted"),this.commentModelsRegistry.remoteCreate({photoId:this.photoId,commentText:t,photosInCommentsEnabled:this.appContext.flipper.isFlipped("photos-in-comments")}).then(function(t){i=t.toJSON(),i.isSignedIn=n.appContext.getViewer().signedIn,i.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),i.enabledEditableComments=this.appContext.flipper.isFlipped("enable-editable-comments"),i.canCommentBeDeleted=!0,i.commentBelongsToViewer=!0,i.canComment=!0,n.get("container").one(".new-comment-text").set("value","").setStyle("height",n.textAreaMinHeight+"px"),r=e.Node.create(n.templates("comment")(i)).setStyle("opacity","0.1"),u>0?n.appContext.flipper.isFlipped("comments-chronological")?n.get("container").one(".comments").append(r).one("li:last-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):n.get("container").one(".comments").prepend(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"}):(n.appContext.flipper.isFlipped("comments-chronological"
)?n.get("container").one(".comments-holder").prepend("<ul class='comments'></ul>"):n.get("container").one(".comments-holder").append("<ul class='comments'></ul>"),n.get("container").one(".comments").append(r).one("li:first-child").transition({easing:"ease-in",duration:.5,opacity:"1"})),n.retinafyCommentImages(),s=n.photoComments.getValue("comments").prependToList(t),o=n.photoEngagement.getValue("commentCount")+1,n.photoEngagement.setValue("commentCount",o),n.currentlyShowingCount++,n.fire("newCommentAdded"),n.postingComment=!1},function(e){e.code===8?n.onError("An empty comment box? That won't work!"):n.onError("We couldn't post your comment."),n.postingComment=!1}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})},handleMoreCommentsClick:function(e){e.preventDefault();var t=this,n=this.get("container"),r="",i=n.one(".comments-more"),s;i.one("a").set("text","Loading"),i.addClass("is-loading"),this.appContext.getModel("photo-comments-models",this.photoId).then(function(e){e.getValue("comments").getRange({offset:t.currentlyShowingCount,limit:t.calculateShowMoreCount(),photosInCommentsEnabled:t.appContext.flipper.isFlipped("photos-in-comments")}).then(function(e){var o;t.appContext.flipper.isFlipped("comments-chronological")&&(e=e.reverse());for(o=0;o<e.length;o++)s=e[o].toJSON(),s.isSignedIn=t.appContext.getViewer().signedIn,s.isLoggedInUsersPhoto=t.isLoggedInUsersPhoto(),s.canCommentBeDeleted=t.canCommentBeDeleted(s.author.nsid),s.commentBelongsToViewer=t.commentBelongsToViewer(s.author.nsid),s.enabledEditableComments=t.appContext.flipper.isFlipped("enable-editable-comments"),s.canComment=t.photoModel.getValue("canComment"),r+=t.templates("comment")(s);t.appContext.flipper.isFlipped("comments-chronological")?n.one(".comments").prepend(r):n.one(".comments").append(r),t.retinafyCommentImages(),t.currentlyShowingCount=t.currentlyShowingCount+e.length,t.calculateShowMoreCount()>0?(i.one("a").set("text",t.calculateShowMoreCount()+" more"),i.removeClass("is-loading")):i.remove()},function(e){t.onError("We couldn't get more comments.")}).then(null,function(e){t.appContext.error(e.message),t.appContext.error(e.stack)})})},calculateShowMoreCount:function(){var e=this.photoEngagement.getValue("commentCount");return e>this.currentlyShowingCount+this.showMoreMaximum?this.showMoreMaximum:e<=this.currentlyShowingCount+this.showMoreMaximum?e-this.currentlyShowingCount:0},isLoggedInUsersPhoto:function(){return this.photoModel.getValue("owner").getValue("nsid")===this.appContext.getViewer().nsid},canCommentBeDeleted:function(e){return e===this.appContext.getViewer().nsid||this.isLoggedInUsersPhoto()?!0:!1},commentBelongsToViewer:function(e){return e===this.appContext.getViewer().nsid?!0:!1},jumpToPermalinkedComment:function(){var t=e.config.win.location.hash,n=this.get("container"),r,i=this,s;r=n.one(t),r?(r.scrollIntoView(!0),r.addClass("permalinked-comment")):i.fire("viewEvent","getDialogOffset",function(t){s=e.Views.dialog.getNewInstance("dialog-alert",{content:"We were unable to find the specified comment in the Photo.",attrs:{title:"Oops!",level:"warning",confirmLabel:"OK"},parent:i,offsetLeft:t}),s.show()})},retinafyCommentImages:function(){if(this.appContext.getCookie("density")>1){var t=e.all(".comments li .comment-content a[data-photo-size-m]");t.each(function(e){e.one("img").setAttribute("src",e.getAttribute("data-photo-size-m")),e.removeAttribute("data-photo-size-m")})}},handleCommentKeyDown:function(e){var t=this,n=this.get("container").one(".new-comment-text"),r=n.get("value"),i=this.get("container").one(".false-comment-content"),s;if(e.charCode===13&&!e.altKey&&!e.shiftKey&&!this.postingComment){this.textAreaUserSetHeight=this.textAreaMinHeight,e.preventDefault(),this.postingComment=!0,this.postComment(r);return}setTimeout(function(){i.set("value",n.get("value")),s=i._node.scrollHeight<t.textAreaMinHeight?t.textAreaMinHeight:i._node.scrollHeight,s=i._node.scrollHeight>t.textAreaMaxHeight?t.textAreaMaxHeight:s,s=t.textAreaUserSetHeight>i._node.scrollHeight?t.textAreaUserSetHeight:s,n.setStyle("height",s+"px")},10)},handleCommentMouseDown:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=t.getComputedStyle("height"),isNaN(n)||(this.textAreaUserSetHeight=this.textAreaUserSetHeight!==n?n:this.textAreaUserSetHeight))},handleCommentMouseUp:function(e){var t=this.get("container").one(".new-comment-text"),n=0;t&&(n=parseInt(t.getComputedStyle("height"),10),!isNaN(n)&&this.textAreaUserSetHeight!==n&&(this.textAreaUserSetHeight=n>this.textAreaMaxHeight?this.textAreaMaxHeight:n,t.setStyle("height",this.textAreaUserSetHeight+"px")))},handleCommentMouseLeave:function(t){e.config.win.clearTimeout(this.textAreaUserMouseLeave),this.textAreaUserMouseLeave=setTimeout(e.bind(function(){var e=this.get("container").one(".new-comment-text"),t=0;e&&(t=parseInt(e.getComputedStyle("height"),10),isNaN(t)||(this.textAreaUserSetHeight=t<this.textAreaMinHeight?this.textAreaMinHeight:t,this.textAreaUserSetHeight=t>this.textAreaMaxHeight?this.textAreaMaxHeight:t))},this),100)},handleCommentBlur:function(e){var t=this.get("container").one("textarea");t.getData("notutorial")&&t.set("placeholder",t.getData("notutorial"))},handleCommentFocus:function(e){var t=this.get("container").one("textarea");t.getData("tutorial")&&t.set("placeholder",t.getData("tutorial"))},handleReplyClick:function(t){t.preventDefault();var n=this.get("container").one("textarea"),r=n.get("value"),i="",s=n.getDOMNode(),o;r.length>0&&(i+=r+" "),i+="["+e.url("/photos/"+t.target.getAttribute("data-pathalias"))+"] ",s.setSelectionRange?(s.focus(),s.setSelectionRange(s.value.length,s.value.length)):s.createTextRange&&(o=s.createTextRange(),o.collapse(!0),o.moveEnd("character",s.value.length),o.moveStart("character",s.value.length),o.select()),n.focus(),n.set("value",i),s.scrollTop=s.scrollHeight},handleEditClick:function(t){t.preventDefault();var n=this,r=t.target.ancestor(".comment"),i=t.target.getAttribute
("data-id"),s,o,u,a=this.get("container").one(".false-comment-content"),f;if(r.one("textarea")){r.one("textarea").remove(),r.one(".comment-content").show();return}n.appContext.getModel("comment-models",i).then(function(t){r.one(".comment-content").hide(),n.appContext.flipper.isFlipped("photos-in-comments")?r.append("<textarea>"+t.getValue("contentRaw")+"</textarea>"):r.append("<textarea>"+t.getValue("content")+"</textarea>"),s=r.one("textarea"),a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px"),s.select(),s.on("keydown",function(l){setTimeout(function(){a.set("value",s.get("value")),f=a._node.scrollHeight<n.textAreaMinHeight?n.textAreaMinHeight:a._node.scrollHeight,f=a._node.scrollHeight>n.textAreaMaxHeight?n.textAreaMaxHeight:f,s.setStyle("height",f+"px")},10);if(l.charCode===13&&!l.altKey&&!l.shiftKey&&!n.postingEditedComment){l.preventDefault();if(e.Lang.trim(s.get("value"))===""){n.onError("An empty comment box? That won't work!");return}n.postingEditedComment=!0,t.setValues({content:s.get("value")}),n.appContext.modelRegistries["comment-models"].remoteUpdate(i).then(function(i){i?u=i.toJSON():u=t.toJSON(),u.isSignedIn=n.appContext.getViewer().signedIn,u.isLoggedInUsersPhoto=n.isLoggedInUsersPhoto(),u.enabledEditableComments=n.appContext.flipper.isFlipped("enable-editable-comments"),u.canCommentBeDeleted=!0,u.commentBelongsToViewer=!0,u.canComment=n.photoModel.getValue("canComment"),u.isTooltipComment=n.isTooltipComments,u.ellipsis=n.ellipsis,o=e.Node.create(n.templates("comment")(u)),r.replace(o),n.fire("commentEdited"),n.postingEditedComment=!1},function(e){n.postingEditedComment=!1,t.revertValue("content"),n.onError(e.message)})}})})},handleDeleteClick:function(t){t.preventDefault();var n=this,r,i,s=t.target.ancestor(".comment"),o=t.target.getAttribute("data-id"),u;r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Delete Comment",icon:"ui-icon-modal-warning",content:"Are you sure you want to delete this comment?",confirmButtonLabel:"Delete"}),r.render(),r.activate(),i=r.get("container"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",function(){n.commentingDialog.close(),n.commentingDialog.destroy(),n.appContext.modelRegistries["comment-models"].remoteDelete(o).then(function(){n.photoComments.getValue("comments").removeFromList(o),u=n.photoEngagement.getValue("commentCount")-1,n.photoEngagement.setValue("commentCount",u),n.currentlyShowingCount--,n.fire("commentDeleted"),s.transition({easing:"ease-out",duration:.5,opacity:"0"},function(){s.remove(),u===0&&n.get("container").one(".comments").remove()})},function(e){n.onError("We couldn't delete your comment.")}).then(null,function(e){n.appContext.error(e.message),n.appContext.error(e.stack)})})),this.fire("subviewViewEvent","getDialogOffset",function(t){n.commentingDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:n.appContext,offsetLeft:t}),n.commentingDialog.show()})},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getNewInstance("dialog-alert",{content:t,attrs:{title:"Error",level:"warning",confirmLabel:"OK"},parent:n,offsetLeft:r});i.show()})}})},"@VERSION@",{requires:["dialog","flickr-view","moment","comments-css","hermes-template-comments","hermes-template-comment","hermes-template-comments-view","url"],langBundles:["comments"],optional:["photo-comments-models"]});
YUI.add("hermes-lang-comments",function(e,t){e.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>']})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-photo-charms",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+="\n		<button class='photo-charm-button' title='"+f((i=e.title,typeof i===a?i.apply(e):i))+"' data-charm-type='"+f((i=e.type,typeof i===a?i.apply(e):i))+"' data-track='"+f((i=e.type,typeof i===a?i.apply(e):i))+"CharmButtonClick'>\n			<i class='hide-text'>",s={hash:{},data:t},r+=f((i=n.capitalize||e.capitalize,i?i.call(e,e.title,s):l.call(e,"capitalize",e.title,s)))+"</i>\n		</button>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+="<div class='photo-charms-bar'>\n	",o=n.each.call(t,t.buttons,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+="\n	\n	<div class='photo-charm-indicator hide-text'>\u2191</div>\n</div>\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-exif-view"],t.showExif,u):l.call(t,"outlet",t["photo-charm-exif-view"],t.showExif,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-contexts-view"],t.showContexts,u):l.call(t,"outlet",t["photo-charm-contexts-view"],t.showContexts,u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-tags-view"],t.showTags,u):l.call(t,"outlet",t["photo-charm-tags-view"],t.showTags,u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-charms",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
