YUI.add("flickr-photosets-removePhoto-deletor",function(e){"use strict";function t(t,n){var r={};return r.photo_id=t.photoID,r.photoset_id=t.setID,e.batch(n.callAPI("flickr.photosets.removePhoto",r),n.getModel("set-models",t.setID),n.getModel("photo-models",t.photoID),n.getModel("sets-models",n.getViewer().nsid),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],i=e[3],s=e[2],o=e[4],u=e[5];if(n.stat==="ok"){u.exists(t.photoID)&&u.getValue(t.photoID,"contexts").getFromListByID(t.setID)&&(u.setValue(t.photoID,"totalSets",u.getValue(t.photoID,"totalSets")-1),u.getValue(t.photoID,"contexts").removeFromList(t.setID)),o.exists(t.photoID)&&o.getValue(t.photoID,"sets").getFromListByID(t.setID)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"sets").removeFromList(t.setID));if(r){r.hasPhoto(s.getValue("id"))&&r.removePhoto(s),s.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-1):r.setValue("photoCount",r.getValue("photoCount")-1);if(r.getValue("photoCount")<1&&r.getValue("videoCount")<1)return i.getValue("sets").removeFromList(t.setID),r.registry.remove(t.setID),null}return r}},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-removePhoto-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-getPhotos-fetcher",function(e){"use strict";function t(t){t.page=t.page||1,t.perPage=t.perPage||100;var n={photoset_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage,page:t.page,get_user_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a,f,l,c,h,p=[],d=!1,v=!1;return a=e.APIHelper.response.parsePerson(r.user),f=s.exists(a.id)?s.proxy(a.id):s.add(a),l={id:n.id,title:r.photoset.title,owner:f,primary:r.photoset.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:r.photoset.isAutoUploadSet,photoCount:r.photoset.photoCount,videoCount:r.photoset.videoCount,photoList:[]},o.exists(n.id)&&(c=o.getValue(n.id,"photoPageList"),d=c.hasMinBoundary?c.hasMinBoundary():!1,v=c.hasMaxBoundary?c.hasMaxBoundary():!1,p=c.getList()),h=e.APIHelper.response.parsePhotos({photos:r.photoset.photo,ownerID:r.photoset.owner,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u}),l.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:p,perPage:n.perPage,pageNum:n.page,hasMax:v,hasMin:d,totalItems:r.photoset.total,newPages:h}),l.photoList.length&&(l.primary=r.photoset.primary),l.photoCount=r.photoset.total,o.exists(l.id)?o.setValue(n.id,"photoPageList",l.photoPageList):o.add(l),h}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("set-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getPhotos-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","set-models","photo-engagement-models"]});
YUI.add("flickr-photosets-getContext-fetcher",function(e){"use strict";function t(t,n){var r={photoset_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:t.photoId,num_prev:t.numPrev,num_next:t.numNext,get_photoset_info:1};return r}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=[],f=[],l=s.proxy(n.photoId),c,h,p,d,v,m,g=[];return c=r.prevphotos,h=r.nextphotos,f=e.APIHelper.response.parsePhotos({photos:c.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u}),a=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u}),v=i.getValue(n.id,"photoContextList"),p=v.hasMinBoundary?v.hasMinBoundary():!1,d=v.hasMaxBoundary?v.hasMaxBoundary():!1,m=v.getList(),g=e.APIHelper.response.addOrReplaceListByContext({model:l,next:f,prev:a.reverse(),current:m,hasMin:p,hasMax:d,numNext:n.numPrev,numPrev:n.numNext}),i.setValue(n.id,"photoContextList",g),{next:f,previous:a.reverse()}}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photosets.getContext",this._processParams(t,n),!0),n.getModelRegistry("set-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getContext-fetcher] failed getting or processing API response:",e),e.code===2&&e.message==="Photo not in set"&&(e.notInContext=!0),e})}e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("flickr-photosets-create-creator",function(e){"use strict";function t(t,n){var r={};return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,e.batch(n.callAPI("flickr.photosets.create",r),n.getModelRegistry("set-models"),n.getModel("photo-models",t.photoID),n.getModel("person-models",n.getViewer().nsid),n.getModel("sets-models",n.getViewer().nsid),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l;return r.photoset.id?(l=i.add({id:r.photoset.id,title:r.photoset.title.content,photoPageList:[s],photoContextList:[s],owner:o,primary:r.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.photoset),isAutoUploadSet:!1,photoCount:r.photoset.photos,videoCount:r.photoset.videos}),u.getValue("sets").prependToList(l),a.exists(t.photoID)&&!a.getValue(t.photoID,"sets").getFromListByID(l.getValue("id"))&&(a.getValue(t.photoID,"sets").prependToList(l),a.setValue(t.photoID,"total",a.getValue(t.photoID,"total")+1)),f.exists(t.photoID)&&!f.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(f.setValue(t.photoID,"totalSets",f.getValue(t.photoID,"totalSets")+1),f.getValue(t.photoID,"contexts").appendToList(l)),l):!1},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-create"]={run:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});
YUI.add("set-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-photosets-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),n=this.getValue(e,"videoCount"),r="";return t-=n,t===0&&n===0?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):t===1&&n===0?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&n===0?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):t===0&&n===1?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):t===1&&n===1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&n===1?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):t===0&&n>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:n}):t===1&&n>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:n}):t>1&&n>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:n})),r}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var t=this.getValue(e,"primaryPhotoSizes");return t.sq?t.sq.src:undefined}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/sets/"+e:undefined}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return"set-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator"],langBundles:["models"]});
YUI.add("flickr-photos-getAllContexts-fetcher",function(e){"use strict";function t(t){var n={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m"};return t.scrappy&&(n.get_all_galleries=1,n.no_faves_context=1,n.per_type_limit=6,n.get_totals=1,n.sort="date-desc"),n}function n(t,n){var r=t[0],i=t[1],s=t[2],o={},u=[],a,f=t[8],l=t[9],c=t[10];return o.faves=t[3],o.gallery=t[4],o.pool=t[5],o.set=t[6],o.stream=t[7],e.Object.each(o,function(t,n){r[n]&&e.Array.each(r[n],function(n){e.APIHelper.response.addContextToRegistry(n,t,i),u.push(t.proxy(n.id))})}),s.exists(n.id)||(a=s.add({id:n.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),s.setValue(n.id,"contexts",u)),f.exists(n.id)||f.add({id:n.id,total:r.totals&&r.totals.groups,groups:s.getContextsOfType(n.id,"groups-pool-models")}),l.exists(n.id)||l.add({id:n.id,total:r.totals&&r.totals.sets,sets:s.getContextsOfType(n.id,"set-models")}),c.exists(n.id)||c.add({id:n.id,total:r.totals&&r.totals.galleries,galleries:s.getContextsOfType(n.id,"gallery-models")}),a}function r(t,n){var r=this;return n.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),e.batch(n.callAPI("flickr.photos.getAllContexts",this._processParams(t),!0),n.getModelRegistry("person-models"),n.getModelRegistry("photo-contexts-models"),n.getModelRegistry("favorite-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("groups-pool-models"),n.getModelRegistry("set-models"),n.getModelRegistry("photostream-models"),n.getModelRegistry("photo-groups-models"),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-galleries-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getAllContexts-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","groups-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models"]});
YUI.add("photo-contexts-models",function(e){function t(e){t.superclass.constructor.call(this,e),this.getMorePromises={"groups-pool-models":{},"set-models":{},"gallery-models":{}},this.continuationKeys={"groups-pool-models":{},"set-models":{},"gallery-models":{}}}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return this.appContext.flipper.isFlipped("enable-scrappy-photo-page")?e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext):e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},getMoreContextsOfType:function(t,n,r){var i=this,s,o,u,a,f,l,c,h="-1";switch(n){case"groups-pool-models":s="flickr.photos.getGroups",u="groups.group";break;case"set-models":s="flickr.photos.getSets",u="sets.set";break;case"gallery-models":s="flickr.photos.getGalleries",u="galleries.gallery"}return s?this.exists(t)?(a=this.continuationKeys[n][t]||"0",a===h?new e.AutoResolvingPromise({type:n,newContexts:[],loadedAll:!0}):(o={photo_id:t,extras:e.APIHelper.request.getRebootPhotoExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:a,per_page:r},l=t+"_"+a,c=this.getMorePromises[n][l],c?c:(this.getMorePromises[n][l]=(new e.FlickrPromise({apiResponse:this.appContext.callAPI(s,o,!0),contextRegistry:this.appContext.getModelRegistry(n),personRegistry:this.appContext.getModelRegistry("person-models")})).then(function(r){var s=[],o=r.apiResponse,a=r.contextRegistry,c=r.personRegistry,p,d,v;return d=u.split(".").reduce(function(t,n){return e.Lang.isObject(t)?t[n]:undefined},o),d&&(e.Array.each(d,function(t){e.APIHelper.response.addContextToRegistry(t,a,c),s.push(a.proxy(t.id))}),s.length&&(v=i.getContextsOfType(t,n).map(function(e){return e.getValue("id")}),s=s.filter(function(e){return v.indexOf(e.getValue("id"))===-1}),s.length&&i.getValue(t,"contexts").appendToListMulti(s))),f=o.continuation,typeof f=="undefined"?f=h:e.Lang.isNumber(f)&&(f+=""),p=f===h,i.continuationKeys[n][t]=f,delete i.getMorePromises[n][l],{type:n,newContexts:s,loadedAll:p}}),this.getMorePromises[n][l]))):new e.AutoRejectingPromise("[photo-contexts-models] getMoreContextsOfType was called for an ID that isn't in the registry: "+t):new e.AutoRejectingPromise("[photo-contexts-models] getMoreContextsOfType was called without an invalid type: "+n)},getContextsOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)>-1})},getContextsNotOfType:function(t,n){return n=e.Array(n),this.getValue(t,"contexts").getList().filter(function(e){return n.indexOf(e.registry.name)===-1})},attributes:{contexts:{isListProxy:!0},totalGroups:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalSets:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},totalGalleries:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-photos-getAllContexts-fetcher"]});
YUI.add("confirmation-dialog-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.set("title",e.title?e.title:"Confirm"),this.set("icon",e.icon?e.icon:!1),this.set("content",e.content?e.content:"A blurb about what this will do"),this.set("confirmButtonLabel",e.confirmButtonLabel?e.confirmButtonLabel:"OK"),this.set("cancelButtonLabel",e.cancelButtonLabel?e.cancelButtonLabel:"Cancel"),this.set("auxiliaryButtonLabel",e.auxiliaryButtonLabel?e.auxiliaryButtonLabel:"Cancel"),this.set("confirmButtonClass",e.confirmButtonClass?e.confirmButtonClass:""),this.set("cancelButtonClass",e.cancelButtonClass?e.cancelButtonClass:""),this.set("auxiliaryButtonClass",e.auxiliaryButtonClass?e.auxiliaryClass:""),this.set("showConfirmButton",typeof e.showConfirmButton=="undefined"?!0:e.showConfirmButton),this.set("showCancelButton",typeof e.showCancelButton=="undefined"?!0:e.showCancelButton),this.set("showAuxiliaryButton",typeof e.showAuxiliaryButton=="undefined"?!1:e.showAuxiliaryButton),this.set("deletePhotoConfirmation",e.deletePhotoConfirmation?e.deletePhotoConfirmation:!1),this.set("imgSrc",e.imgSrc?e.imgSrc:""),this.set("organizrLink",e.organizrLink?e.organizrLink:!1),this.set("dialog",e.dialog),this},render:function(){return this.setContainerHTML(this.templates("confirmation-dialog")({title:this.get("title"),icon:this.get("icon"),heading:this.get("heading"),content:this.get("content"),confirmButtonLabel:this.get("confirmButtonLabel"),cancelButtonLabel:this.get("cancelButtonLabel"),auxiliaryButtonLabel:this.get("auxiliaryButtonLabel"),confirmButtonClass:this.get("confirmButtonClass"),cancelButtonClass:this.get("cancelButtonClass"),auxiliaryButtonClass:this.get("auxiliaryButtonClass"),deletePhotoConfirmation:this.get("deletePhotoConfirmation"),imgSrc:this.get("imgSrc"),organizrLink:this.get("organizrLink"),showConfirmButton:this.get("showConfirmButton"),showCancelButton:this.get("showCancelButton"),showAuxiliaryButton:this.get("showAuxiliaryButton")})),this},handleCancelClick:function(t){e.Views.dialog.close()},handleAuxiliaryClick:function(e){this.fire("auxiliaryClick")},activate:function(){var e=this;return this.get("showCancelButton")&&this.get("container").one(".cancel-confirmation").on("click",function(t){e.handleCancelClick(t)}),this.get("showAuxiliaryButton")&&this.get("container").one(".auxiliary-confirmation").on("click",function(t){e.handleAuxiliaryClick(t)}),this}})},"@VERSION@",{requires:["flickr-view","confirmation-dialog-css","hermes-template-confirmation-dialog"],optional:["set-models"]});
YUI.add("hermes-template-fave",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return"is-faved"}function h(e,t){return"can-not-fave"}function p(e,t){var r,i;return i={hash:{},data:t},f((r=n.formatNumber||e.formatNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"formatNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}function d(e,t){var r,i;return i=n["if"].call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),{hash:{},inverse:l.noop,fn:l.program(8,v,t),data:t}),i||i===0?i:""}function v(e,t){var r,i;return i={hash:{},data:t},f((r=n.friendlyNumber||e.friendlyNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"friendlyNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}function m(e,t){var r="",i;r+='\n		    <a href="#" title="',i=n["if"].call(e,e.loadingView,{hash:{},inverse:l.program(13,y,t),fn:l.program(11,g,t),data:t});if(i||i===0)r+=i;return r+='" data-action="fave"></a>\n		',r}function g(e,t){var r,i;return i={hash:{intlName:"fave-view.LOADING_FAVES"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function y(e,t){var r,i;return i=n["if"].call(e,(r=e.photo,r==null||r===!1?r:r.isFaved),{hash:{},inverse:l.program(16,w,t),fn:l.program(14,b,t),data:t}),i||i===0?i:""}function b(e,t){var r,i;return i={hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function w(e,t){var r,i;return i={hash:{intlName:"fave-view.FAVE_PHOTO"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function E(e,t){var r="",i,s;return r+='\n		    <a href="#" title="',s={hash:{intlName:"fave-view.WHO_FAVED"},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):a.call(e,"intlMessage",s)))+'" data-action="showfaves"></a>\n		',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<div class="button">\n	<span class="hide-text fave-star ',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.isFaved),{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;s+=" ",u=n.unless.call(t,(o=t.photo,o==null||o===!1?o:o.canFave),{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(u||u===0)s+=u;s+='">&9733;</span>\n	<span class="fave-count" unselectable="on">',u=n["if"].call(t,t.realFullscreen,{hash:{},inverse:l.program(7,d,i),fn:l.program(5,p,i),data:i});if(u||u===0)s+=u;s+='</span>\n\n	<div class="button-overlay">\n	    ',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.canFave),{hash:{},inverse:l.noop,fn:l.program(10,m,i),data:i});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.faveCount),{hash:{},inverse:l.noop,fn:l.program(18,E,i),data:i});if(u||u===0)s+=u;return s+="\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-person",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+="data-"+l((r=(r=e.dataAttr,r==null||r===!1?r:r.key),typeof r===f?r.apply(e):r))+'="'+l((r=(r=e.dataAttr,r==null||r===!1?r:r.value),typeof r===f?r.apply(e):r))+'"',n}function d(e,t){var n;return l((n=(n=e.buddyicon,n==null||n===!1?n:n["default"]),typeof n===f?n.apply(e):n))}function v(e,t){var r;return(r=n.buddyicon)?r=r.call(e,{hash:{},data:t}):(r=e.buddyicon,r=typeof r===f?r.apply(e):r),l(r)}function m(e,t){return'\n	<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<li class="person" ',o=n["if"].call(t,t.dataAttr,{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;s+='>\n	<a class="',(o=n.extraClasses)?o=o.call(t,{hash:{},data:i}):(o=t.extraClasses,o=typeof o===f?o.apply(t):o),s+=l(o)+'" href="/photos/',(o=n.pathAlias)?o=o.call(t,{hash:{},data:i}):(o=t.pathAlias,o=typeof o===f?o.apply(t):o),s+=l(o)+'/" data-track="',(o=n.dataTrackPrefix)?o=o.call(t,{hash:{},data:i}):(o=t.dataTrackPrefix,o=typeof o===f?o.apply(t):o),s+=l(o)+'PersonIconClick">\n		<span class="person-icon">\n			<span class="circle-icon">\n				<img src="',u=n["if"].call(t,(o=t.buddyicon,o==null||o===!1?o:o["default"]),{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;s+='" width="',(u=n.size)?u=u.call(t,{hash:{},data:i}):(u=t.size,u=typeof u===f?u.apply(t):u),s+=l(u)+'" height="',(u=n.size)?u=u.call(t,{hash:{},data:i}):(u=t.size,u=typeof u===f?u.apply(t):u),s+=l(u)+'">\n			</span>\n			<span class="person-name">\n				',a={hash:{},data:i},s+=l((o=n.truncate||t.truncate,o?o.call(t,t.displayname,20,a):h.call(t,"truncate",t.displayname,20,a)))+"\n			</span>\n		</span>\n	</a>\n	",u=n["if"].call(t,t.showRemove,{hash:{},inverse:c.noop,fn:c.program(7,m,i),data:i});if(u||u===0)s+=u;return s+="\n</li>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/person",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-fave-menu",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;r+="\n	<ul>\n		",i=n.each.call(e,e.people,{hash:{},inverse:o.noop,fn:o.program(2,l,t),data:t});if(i||i===0)r+=i;r+="\n		",i=n["if"].call(e,e.moreCount,{hash:{},inverse:o.noop,fn:o.program(4,c,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function l(e,t){var i="",s;i+="\n			",s=o.invokePartial(r.person,"person",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}function c(e,t){var r="",i;return r+="\n			<li class='faves-more'><a href='#'>",(i=n.moreCount)?i=i.call(e,{hash:{},data:t}):(i=e.moreCount,i=typeof i===u?i.apply(e):i),r+=a(i)+" more</a></li>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s,o=this,u="function",a=this.escapeExpression;return s=n["if"].call(t,t.people,{hash:{},inverse:o.noop,fn:o.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each(["person"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-person"]});
YUI.add("animation-helper",function(e){function t(){var e=["webkit","moz"],t,n,r=0;Date.now||(Date.now=function(){return(new Date).getTime()});for(n=0;n<e.length&&!window.requestAnimationFrame;++n)t=e[n],window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"];if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame)window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(r+16,t);return setTimeout(function(){e(r=n)},n-t)},window.cancelAnimationFrame=clearTimeout}function n(){YUI.Env.isServer||t()}n()},"@VERSION@",{requires:[]});
YUI.add("photo-people-who-faved-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-getFavorites"].run(t,this.appContext)}},attributes:{total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},people:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-getFavorites"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getFavorites-fetcher"]});
YUI.add("flickr-photos-getFavorites-fetcher",function(e){"use strict";function t(t){var n={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||50,page:t.page||1,hermes:1};return t.scrappy&&(n.sort="date_asc"),n}function n(t,n){var r=t[0],i=t[1],s=t[2],o={id:r.photo.id,total:r.photo.total,people:[]},u,a;return r.photo.person&&r.photo.person.forEach(function(t){var n=e.APIHelper.response.parsePerson(t);s.exists(n.id)||s.add(n),n=s.proxy(n.id),o.people.push(n)}),i.exists(o.id)?(u=i.proxy(o.id).getValue("people").getList(),a=o.people.concat(u),i.setValue(o.id,"people",a)):i.add(o),o.people}function r(t,n){var r=this;return n.flipper.isFlipped("enable-scrappy-photo-page")&&(t.scrappy=!0),e.batch(n.callAPI("flickr.photos.getFavorites",this._processParams(t),!0),n.getModelRegistry("photo-people-who-faved-models"),n.getModelRegistry("person-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getFavorites-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photos-getFavorites"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-people-who-faved-models","person-models"]});
YUI.add("fave-view",function(e){var t=50,n=30,r=750,i="whoFaved";e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:["fave-view","common"],initializer:function(e){this.photoId=e.photoId,this.offNetworkFave=e.offNetworkFave||!1,this.hideWhoFaved=e.hideWhoFaved||!1;if(this.get("container").get("innerHTML")===""){var t=this.templates("fave")({photo:{canFave:!1},loadingView:!0});this.setContainerHTML(t)}return this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement"),t;return t=this.templates("fave")({photo:e.toJSON(),realFullscreen:this.realFullscreen}),this.setContainerHTML(t),!this.processingFave&&!this.hideWhoFaved&&this.buildWhoFavedTooltip(),this},loadState:function(){var t=this,n=this.appContext.getViewer(),r=[];return r.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),this.hideWhoFaved||r.push(this.appContext.getModel("photo-people-who-faved-models",this.photoId).then(function(e){t.set("photo-people-who-faved-model",e)},function(e){})),n.signedIn&&t.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer-person-model",e)}),e.batch.apply(null,r)},activate:function(){var n=this.get("photo-engagement"),r=this,i;return n&&this.registerEventHandler(n.on("valuesChanged",function(t){var i,s=typeof t.faveCount!="undefined"||typeof t.isFaved!="undefined"||typeof t.canFave!="undefined";if(!s)return;r.processingFave=!0,r.buildContainer(),i=n.remoteUpdate(),i.then(null,function(i){i.code!==3&&(e.Object.each(t,function(e,t){n.setValue(t,e.prevVal)}),this.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getInstance("dialog-alert",{content:this.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),attrs:{title:this.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:this.intlMessage({intlName:"common.OK"})},appContext:r.appContext,offsetLeft:t});n.show()})),r.processingFave=!1}).then(function(e){if(!r.hideWhoFaved){var n=r.get("photo-people-who-faved-model"),i=r.get("viewer-person-model");t.isFaved.newVal?n.getValue("people").prependToList(i):n.getValue("people").removeFromList(i.id),r.buildWhoFavedTooltip()}r.processingFave=!1},function(e){r.processingFave=!1})},this.photoId)),i={":fave":this.faveStarClicked},this.hideWhoFaved||(i[":showfaves"]=this.faveCountClicked),this.attachEvents(i),this.attachKeyEvent("down:70",this.faveStarClicked.bind(this)),this.hideWhoFaved||this.get("photo-people-who-faved-model").getValue("total")>t&&this.setUpFaveTooltipPagination(),this},faveStarClicked:function(t,n){var r=this,i=this.get("photo-engagement"),s,o;t.preventDefault();if(this.processingFave)return;if(!this.appContext.getViewer().signedIn){if(this.offNetworkFave){e.SigninHelper.addPendingFave({id:this.photoId},{withPopup:!0,closeWhenDone:!0});return}s=new e.Views["confirmation-dialog-view"]({title:this.intlMessage({intlName:"common.OOPS"}),icon:"ui-icon-modal-error",content:this.intlMessage({intlName:"fave-view.SIGN_IN_TO_FAVE"}),confirmButtonLabel:this.intlMessage({intlName:"common.SIGN_IN"}),cancelButtonLabel:this.intlMessage({intlName:"common.FORGET_IT"}),appContext:this.appContext}),s.render(),s.activate(),o=e.Views.dialog.getNewInstance("dialog-modal",{content:s.get("container"),appContext:this.appContext}),o.show(),s.registerEventHandler(s.get("container").one(".ui-dialog-button-confirm").on("click",function(){o.close(),o.destroy(),e.SigninHelper.addPendingFave({id:r.photoId})}))}else i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick"))},faveCountClicked:function(t,n){t.preventDefault(),this.favedTooltip&&this.get("photo-engagement").getValue("faveCount")&&(this.favedTooltip.toggle(),e.rapidTracker.beacon(this.name,"faveCountActionBarButtonClick"))},favedTooltipScroll:function(e){var s,o,u,a,f=this;s=this.favedTooltipWrapper.getDOMNode().scrollTop;if(s>this.pageVals.bottomOfCurrentFavePage-r)return o=this.favedTooltipWrapper.one(".faves-more"),o.set("text","Loading"),a=this.get("photo-people-who-faved-model").getValue("people").getPage({page:++this.pageVals.currentFavePage,perPage:t}).then(function(e){var r="",s;o.remove(),e.forEach(function(e){e=e.toJSON(),e.size=n,e.pathAlias+="/favorites",e.dataTrackPrefix=i,r+=f.templates("person")(e)}),u=f.favedTooltipWrapper.one("ul"),u.append(r),f.pageVals.currentFavePage<f.pageVals.numFavePages&&(f.pageVals.bottomOfCurrentFavePage+=f.pageVals.lineHeight*e.length,f.favedTooltipScrollWatcher=window.requestAnimationFrame(f.favedTooltipScroll.bind(f)),s=f.get("photo-people-who-faved-model").getValue("total")-f.pageVals.currentFavePage*t,o.set("text",s+" more"),u.append(o))}),a;this.pageVals.currentFavePage<this.pageVals.numFavePages&&(this.favedTooltipScrollWatcher=window.requestAnimationFrame(this.favedTooltipScroll.bind(this)))},buildWhoFavedTooltip:function(){var r=this.get("container"),s=this.get("photo-people-who-faved-model"),o,u,a,f;return u=s.getValue("people").toJSON(),u.forEach(function(e){e.size=n,e.pathAlias+="/favorites",e.dataTrackPrefix=i,e.extraClasses="server-only-link"}),a=Math.ceil(s.getValue("people").getList().length/t),f=Math.max(0,s.getValue("total")-a*t),o=this.templates("fave-menu")({people:u,moreCount:f}),this.favedTooltip=e.Views.dialog.getNewInstance("dialog-tooltip",{content:o,anchorTo:r,parent:this,positioning:!1,rootEl:r}),this.favedTooltip.render(),this.favedTooltip.get("container").removeAttribute("data-action"),this.favedTooltip},setUpFaveTooltipPagination:function(){var e=this.get("container"),n,r=this.get("photo-people-who-faved-model"),i=this;this.pageVals={numFavePages:0,currentFavePage:0,lineHeight:0,bottomOfCurrentFavePage:0},this.pageVals.numFavePages=Math.ceil(r.getValue("total")/t);if(this.pageVals.numFavePages<=1)return;this.pageVals.currentFavePage=Math.ceil(r.getValue("people").getList().length/t),this.pageVals.currentFavePage=Math.max(1,this.pageVals.currentFavePage),this
.favedTooltipWrapper=e.one(".ui-dialog-wrapper"),e.one(".dialog-tooltip").setStyle("visibility","hidden"),e.one(".dialog-tooltip").removeClass("ui-util-removed"),n=this.favedTooltipWrapper.one("li").get("clientHeight"),this.pageVals.lineHeight=this.favedTooltipWrapper.one("li:nth-child(2)").get("clientHeight"),this.pageVals.bottomOfCurrentFavePage=n+(t-1)*this.pageVals.lineHeight-this.favedTooltipWrapper.get("clientHeight"),this.pageVals.bottomOfCurrentFavePage+=(this.pageVals.currentFavePage-1)*t*this.pageVals.lineHeight,e.one(".dialog-tooltip").setStyle("visibility","visible"),e.one(".dialog-tooltip").addClass("ui-util-removed"),this.registerEventHandler(this.favedTooltip.on("show",function(e){i.favedTooltipScrollWatcher=window.requestAnimationFrame(i.favedTooltipScroll.bind(i)),i.favedTooltip.on(["dismiss","hide","destroy"],function(e){i.favedTooltipScrollWatcher&&(window.cancelAnimationFrame(i.favedTooltipScrollWatcher),delete i.favedTooltipScrollWatcher),i.favedTooltip.detach("dismiss"),i.favedTooltip.detach("hide"),i.favedTooltip.detach("destroy")})}))}})},"@VERSION@",{requires:["flickr-view","confirmation-dialog-view","hermes-template-fave","fave-css","dialog","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-helper"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models"],langBundles:["fave-view","common"]});
YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["So you want to fave? Sign in and try again."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-common",function(e,t){e.Intl.add("hermes/common","en-US",{SIGN_UP:["Sign Up"],YOU:["You"],PHOTOSTREAM:["Photostream"],SETS:["Sets"],ALBUMS:["Albums"],MAP:["Map"],FAVORITES:["Favorites"],GALLERIES:["Galleries"],COLLECTIONS:["Collections"],ARCHIVES:["Archives"],TAGS:["Tags"],PHOTOS_OF:["Photos Of"],PROFILE:["Profile"],POPULAR:["Popular"],EXPLORE:["Explore"],ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],HELP:["Help"],SETTINGS:["Settings"],SIGN_OUT:["Sign Out"],FLICKRMAIL:["FlickrMail"],ERROR:["Error"],OK:["OK"],OOPS:["Oops!"],SIGN_IN:["Sign in"],FORGET_IT:["Forget it"],WARNING:["Warning"],DONE:["Done"],ZOINKS:["Zoinks!"],CANCEL:["Cancel"],ON:["On"],OFF:["Off"],ABOUT:["About"],JOBS:["Jobs"],BLOG:["Blog"],APPS:["Apps"],BRAND:["Brand"],DEVELOPERS:["Developers"],STATUS:["Status"],COMMUNITY_GUIDELINES:["Community guidelines"],REPORT_ABUSE:["Report Abuse"],PRIVACY:["Privacy"],TERMS:["Terms"],YAHOO_SAFELY:["Yahoo Safely"],FEEDBACK:["Feedback"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-dialog-cta-reboot",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n		<h1 class="ui-dialog-title">'+l((r=(r=e.attrs,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+"</h1>\n	",n}function d(e,t){var n="",r;return n+='\n		<div class="ui-dialog-icon">\n			<i class="ui-icon-big-'+l((r=(r=e.attrs,r==null||r===!1?r:r.icon),typeof r===f?r.apply(e):r))+'"></i>\n		</div>\n	',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta ui-dialog-cta-reboot">\n	',u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.title),{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n	",u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.icon),{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;return s+='\n\n	<div class="ui-dialog-body">\n		',a={hash:{},data:i},s+=l((o=n.dialogOutlet||t.dialogOutlet,o?o.call(t,t.content,a):h.call(t,"dialogOutlet",t.content,a)))+"\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-cta-reboot",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-aviary",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="ui-dialog-wrapper ui-dialog ui-dialog-modal c-aviary">\n	<div class="c-aviary-progress"></div>\n	<button class="c-aviary-closebutton" data-action="cancel"></button>\n	<div class="c-aviary-popups"></div>\n	<div class="ui-dialog-body">\n		',u={hash:{},data:i},s+=f((o=n.dialogOutlet||t.dialogOutlet,o?o.call(t,t.content,u):a.call(t,"dialogOutlet",t.content,u)))+"\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/aviary",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-aviary-dialog-authorize",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"By authorizing this link, you'll allow Aviary Photo Editor to:\n    <ul>\n	    <li>Access your Flickr account (including private content)</li>\n		<li>Upload, Edit, and Replace photos and videos in your account</li>\n		<li>Interact with other members' photos and videos (comment, add notes, favorite)</li>\n	</ul>\nAviary Photo Editor will not have permission to delete photos and videos from your account\n\n\n"}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/aviary-dialog-authorize",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("aviary",function(e){typeof document!="undefined"&&(document.domain="flickr.com");var t=e.Views.dialogs["dialog-modal"],n,r,i;i={debug:!1,redirect:{created:"/photos/{{pathAlias}}/{{photoId}}"},aviary:{frameUrl:"//flickr.aviary.com/default.aspx",locale:"en-us"},css:{connecting:"c-aviary-state-connecting",popups:".c-aviary-popups",uploading:"c-aviary-state-uploading"}},r=e.merge(e.flutil,{log:function(){if(!i.debug||!console.log.apply)return;var e=[].slice.call(arguments);e.unshift("SHARE"),r.dump.apply(null,e)}}),n=e.namespace("Views").Aviary=e.Base.create("Aviary",t,[],{initializer:function(n){return t.prototype.initializer.call(this,n),this.set("user",this.appContext.getViewer().signedIn?{}:null),this.set("owner",this.get("photo").getValue("owner")),e.Views.dialog.registerView(this,this.get("photo").getValue("id")),this.initialize(),this},initialize:function(){this.on("rendered",this.renderFrame,this),this._aviaryEvents=[["load",function(e){return e.pageLoaded}],["edited",function(e){return e.type==="replace"&&e.editSuccessful}],["created",function(e){return e.type==="new"&&e.editSuccessful}]],this._aviaryEvents.handleCommand=this.handleCommand.bind(this),window.addEventListener("message",this._aviaryEvents.handleCommand),this.attachEditorEvents()},attachEditorEvents:function(){var e=this;this.on("authorize",function(t){e.confirmAuthorize(function(){t.authForm.submit(),e.show()})}),this.on("load",function(t){e.get("container").removeClass(i.css.connecting)}),this.on("edited",function(t){e.get("container").addClass(i.css.uploading),clearTimeout(e._aviaryEvents.editedTimer),e._aviaryEvents.editedTimer=setTimeout(function(){document.location.reload()},1e3)}),this.on("created",function(t){e.get("container").addClass(i.css.uploading),clearTimeout(e._aviaryEvents.createdTimer),e._aviaryEvents.createdTimer=setTimeout(function(){var n=i.redirect.created;n=n.replace("{{pathAlias}}",e.get("owner").getValue("pathAlias")),n=n.replace("{{photoId}}",t.photo_id),document.location=n},1e3)})},handleCommand:function(e){var t,n,r;try{t=JSON.parse(e.data)}catch(i){t={}}for(n=0,r=this._aviaryEvents.length;n<r;n++)if(this._aviaryEvents[n][1](t))return this.fire(this._aviaryEvents[n][0],t)},renderFrame:function(){var t,n,r,s,o,u,a,f,l,c=this;this.get("container").addClass(i.css.connecting),l={width:this.get("width"),height:this.get("height")},u=this.get("photo").getSizeToFit(l).url,f=this.get("photo").getValue("sizes");for(a in f)if(f[a].url===u)break;t=e.flutil.template("{{baseUrl}}?id={{photoId}}&intl={{locale}}&big=1&viewport_width={{width}}&viewport_height={{height}}&image_size={{imageSize}}&cachebust=6",{baseUrl:i.aviary.frameUrl,locale:i.aviary.locale,width:parseInt(this.get("width"),10),height:parseInt(this.get("height"),10),imageSize:a,photoId:this.get("photo").getValue("id")}),this.iframe=e.Node.create("<iframe/>"),this.iframe.setAttribute("seamless","seamless"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("marginwidth","0"),this.iframe.setStyles({width:this.get("width"),height:this.get("height")}),this.iframe.set("src",t),this.set("content",this.iframe),this.renderContent(),n=this.iframe.getDOMNode(),r=function(e,t,n,i){if(!--i)return;if(n&&n())return;if(t())return e();setTimeout(function(){r(e,t,n,i)},100)},s=function(){r(o,function(){return n.contentDocument.querySelector('form[method="post"]')},function(){return!n.contentDocument.location.host},150)},o=function(){var e=n.contentDocument.querySelector('form[method="post"]'),t={};Array.prototype.slice.call(e.querySelectorAll('input[type="hidden"]')).forEach(function(e){t[e.name]=e.value}),c.fire("authorize",{authForm:e,authData:t,authAction:e.action,authMethod:e.method})},r(s,function(){try{return/authorize_aviary/.test(n.contentDocument.location.href)}catch(e){return!1}},function(){return!1},150)},activate:function(){var e,n=this;return t.prototype.activate.call(this),e={":cancel":function(e,t){e.halt(),n.destroy()}},this.attachEvents(e),this},confirmAuthorize:function(t){var n=this,r,i;r=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:"Aviary Photo Editor wants to link to your Flickr account",icon:"ui-icon-modal-warning",content:"By authorizing this link, you'll allow Aviary Photo Editor to: <ul><li class='aviary-dialog-list'>Access your Flickr account (including private content)</li><li  class='aviary-dialog-list'>Upload, Edit, and Replace photos and videos in your account </li><li class='aviary-dialog-list'>Interact with other members' photos and videos (comment, add notes, favorite).</li> </ul>Aviary Photo Editor will not have permission to delete photos and videos from your account"}),r.render(),r.activate(),i=r.get("container"),i.one(".dialog-icon").setStyle("marginTop","50px"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",function(){t(),n.confirmAuthDialog.close(),n.confirmAuthDialog.destroy()})),this.confirmAuthDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:this.appContext}),this.confirmAuthDialog.show(!1,{hideOthers:!0})},confirmCancel:function(){var t=this,n,r;n=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:"Confirm Cancel",icon:"ui-icon-modal-warning",content:"If you close this window, all the changes you made to this photo will be lost. Are you sure you want to continue?",confirmButtonLabel:"Yes, go ahead"}),n.render(),n.activate(),r=n.get("container"),n.registerEventHandler(r.one(".ui-dialog-button-confirm").on("click",function(){t.confirmCancelDialog.close(),t.confirmCancelDialog.destroy()})),this.fire("viewEvent","getDialogOffset",function(r){t.confirmCancelDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:t.appContext,offsetLeft:r}),t.confirmCancelDialog.show()})},destroy:function(){this.close(),this._aviaryEvents&&(window.removeEventListener("message",this
._aviaryEvents.handleCommand),this._aviaryEvents.handleCommand=null),this.iframe&&this.iframe.set("src","about:blank"),this.iframe=null,t.prototype.destroy.call(this)}},{ATTRS:{template:{value:"aviary"},attrs:{value:{}},photo:{value:null},hideOnCurtainClick:{value:!1}}})},"@VERSION@",{requires:["flutil","dialog","flickr-promise","hermes-template-aviary","hermes-template-aviary-dialog-authorize"],optional:["photo-models","aviary-css"]});
YUI.add("hermes-template-album-selection",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="album-selection">\n	<h2 class="album-selection-heading">',(o=n.titleSelect)?o=o.call(t,{hash:{},data:i}):(o=t.titleSelect,o=typeof o===u?o.apply(t):o),s+=a(o)+'</h2>\n	<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-close hide-text"><span>&nbsp;</span></button>\n	<input type="text" placeholder="',(o=n.placeholderSearch)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderSearch,o=typeof o===u?o.apply(t):o),s+=a(o)+"\" class='album-selection-search' />\n	<ol class='album-selection-list loading'>\n		<li>",(o=n.loadingText)?o=o.call(t,{hash:{},data:i}):(o=t.loadingText,o=typeof o===u?o.apply(t):o),s+=a(o)+'</li>\n	</ol>\n	<div class="album-selection-buttons">\n		<button class="ui-dialog-button ui-dialog-button-neutral ui-dialog-button-done album-selection-done"><span>',(o=n.buttonTextComplete)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextComplete,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span></button>\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/album-selection",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
