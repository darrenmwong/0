YUI.add("autosuggest-context-results-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,TAG_ITEM_TYPE:0,PERSON_ITEM_TYPE:1,GROUP_ITEM_TYPE:2,processItem:function(t,n){return n===this.GROUP_ITEM_TYPE&&(t.title=t.title.replace("+"," ")),t.type=n,n===this.TAG_ITEM_TYPE?t.key=t.title:t.key=t.nsid,t.matches=t.matches.map(function(t){return t[0]=e.Text.AccentFold.fold(t[0]),t}),t},remote:{read:function(t){return e.ModelFetchers["flickr-autosuggest-getContextResults-fetcher"].run(t,this.appContext)}},attributes:{contextId:{writeOnce:"initOnly"},contextType:{writeOnce:"initOnly"},tags:{setter:function(e){var t,n;for(t=0,n=e.length;t<n;t++)this.processItem(e[t],this.TAG_ITEM_TYPE);return e}},people:{setter:function(e){var t,n;for(t=0,n=e.length;t<n;t++)this.processItem(e[t],this.PERSON_ITEM_TYPE);return e}},groups:{setter:function(e){var t,n;for(t=0,n=e.length;t<n;t++)this.processItem(e[t],this.GROUP_ITEM_TYPE);return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-autosuggest-getContextResults-fetcher","text-accentfold"]});
YUI.add("hermes-template-autosuggest-bar",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div id="autosuggest">\n	<div class="search-icon"></div>\n	<form action="/search/" method="get" role="search">\n		<input type="text" name="q" value="',(o=n.searchTerm)?o=o.call(t,{hash:{},data:i}):(o=t.searchTerm,o=typeof o===u?o.apply(t):o),s+=a(o)+'" id="autosuggest-input" class="yui3-aclist-input" autocomplete="off" aria-label="Search" role="textbox">\n	</form>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/autosuggest-bar",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-autosuggest-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;return r+=' style="background-image: url(',(i=n.icon)?i=i.call(e,{hash:{},data:t}):(i=e.icon,i=typeof i===u?i.apply(e):i),r+=a(i)+');"',r}function c(e,t){return"<i></i>"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="autosuggest-item" data-type="',(o=n.type)?o=o.call(t,{hash:{},data:i}):(o=t.type,o=typeof o===u?o.apply(t):o),s+=a(o)+'" data-section="',(o=n.section)?o=o.call(t,{hash:{},data:i}):(o=t.section,o=typeof o===u?o.apply(t):o),s+=a(o)+'" data-destination="',(o=n.url)?o=o.call(t,{hash:{},data:i}):(o=t.url,o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<div class="autosuggest-icon"',o=n["if"].call(t,t.icon,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\n		",o=n.unless.call(t,t.icon,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='\n	</div>\n	<div class="autosuggest-text">\n		<div>',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===u?o.apply(t):o),s+=a(o)+"</div><span>",(o=n.subtitle)?o=o.call(t,{hash:{},data:i}):(o=t.subtitle,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span>\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/autosuggest-item",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("autosuggest-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("autosuggest-view",e.FlickrView,[],{langBundles:["autosuggest"],START_MATCH_MULTIPLIER:2,MATCH_THRESHOLD:0,MAX_RESULTS_TO_DISPLAY:9,MATCH_DISTANCE_THRESHOLD:.2,MID_TOKEN_MATCH_QUERY_LENGTH_THRESHOLD:4,COVERAGE_SCORE_QUERY_LENGTH_THRESHOLD:3,initializer:function(e){var t=this.appContext.getViewer();return e.contextWeights?this.contextWeights=e.contextWeights:(this.contextWeights={global_global:{tags:1,people:1,groups:1}},t.signedIn&&(this.contextWeights[t.nsid+"_user"]={people:1,groups:1})),this.searchId=e.searchId,e.defaultSearchScope?this.defaultSearchScope=e.defaultSearchScope:this.searchId?this.defaultSearchScope=null:this.defaultSearchScope={},this.inputNode=null,this.resultItems=[],this},loadState:function(){var t=this;return this.searchId?this.appContext.getModel("search-photos-models",this.searchId).then(function(e){t.searchModel=e}):new e.AutoResolvingPromise},buildContainer:function(){var t,n;return this.searchModel?(n=this.searchModel.getValue("apiParams"),t=n.text||n.tags||""):t="",this.setContainerHTML(this.templates("autosuggest-bar")({searchTerm:e.flutil.unescape(t)})),this},activate:function(){var t=this;return this.getContextModels().then(function(){t.determineContext(),t.defaultSearchScope||(t.defaultSearchScope=t.getSearchScope(t.searchModel.getValue("apiParams"))),t.buildSearchItems()}),this.autoCompleteList=e.use("autocomplete",function(e){t.inputNode=e.one("#autosuggest-input"),t.inputNode.plug(e.Plugin.AutoComplete,{minQueryLength:0,activateFirstItem:t.hasDefaultSearchItem,source:function(){return t.resultItems.concat(t.searchItems)},resultFilters:function(e,n){var r,i,s=0,o=0,u={},a,f,l,c;r=t.buildTokenRegExps(e),i=n.filter(function(n){var i,s,o=n.raw.type===1||e.length<t.MID_TOKEN_MATCH_QUERY_LENGTH_THRESHOLD,a=e.length<t.COVERAGE_SCORE_QUERY_LENGTH_THRESHOLD;return n.raw.isSearchItem?!0:(i=n.raw.matches.reduce(function(e,n){return e+n[1]*t.maxMatch(r,n[0],o,a)},0),n.matchScore=i/n.raw.matches.length,s=e.length?i>t.MATCH_THRESHOLD:!0,s&&(u[n.raw.type]=u[n.raw.type]||0,u[n.raw.type]++),s)});for(f=0,l=t.searchItems.length;f<l;f++)c=t.searchItems[f].resultType,u[c]?t.searchItems[f].section=t.searchItems[f].startSection:t.searchItems[f].section=t.searchItems[f].endSection;return i=i.sort(function(e,n){var r=e.raw.section-n.raw.section,i;if(r===0)return e.raw.isSearchItem?-1:n.raw.isSearchItem?1:(i=n.matchScore-e.matchScore,Math.abs(i)<t.MATCH_DISTANCE_THRESHOLD?n.raw.score-e.raw.score:i);return r}),a=t.allocateTypeCounts(u,t.MAX_RESULTS_TO_DISPLAY),i=i.filter(function(e){return e.raw.isSearchItem?!0:(e.raw.type===o?s++:(o=e.raw.type,s=1),s<=a[o])}),i},resultFormatter:function(e,n){return n.map(function(e){var n;return e.raw.type===2?e.raw.subtitle===1?n=t.intlMessage({intlName:"autosuggest.MEMBER"}):n=t.intlMessage({intlName:"autosuggest.MEMBERS",count:e.raw.subtitle}):n=e.raw.subtitle||"",t.templates("autosuggest-item")({title:e.raw.title,subtitle:n,type:["tag","people","group","button-people","button-group"][e.raw.type],section:e.raw.section,icon:e.raw.type===0||e.raw.isSearchItem?"":t.buildIconURL(e.raw)})})},resultTextLocator:function(e){return e.isSearchItem?t.get("container").one("#autosuggest-input").get("value"):e.title}}),t.registerEventHandler(t.inputNode.on("focus",function(){e.rapidTracker.beacon(t.name,"autosuggestInputFocus"),t.fire("open"),t.inputNode.ac.fire("query",{inputValue:t.inputNode.get("value"),query:t.inputNode.get("value")})})),t.registerEventHandler(t.inputNode.on("click",function(){t.fire("open"),t.inputNode.ac.fire("query",{inputValue:t.inputNode.get("value"),query:t.inputNode.get("value")})})),t.inputNode.ac.after("query",function(){var e=t.get("container").one(".autosuggest-item");t.get("container").all(".autosuggest-item").each(function(t){var n;e.getAttribute("data-section")!==t.getAttribute("data-section")&&e.get("parentNode").addClass("separator"),e=t,n=t.getAttribute("data-type"),(n==="tag"||n==="button-group"||n==="button-people")&&t.get("parentNode").setAttribute("data-is-short","true")})}),t.inputNode.ac.on("select",function(e){var n=t.itemSelected(e.result);e.originEvent.stopImmediatePropagation(),n||(t.inputNode.focus(),e.halt())}),t.registerEventHandler(t.inputNode.on("keydown",function(n){var r=t.inputNode.get("value");n.keyCode===13&&(n.halt(),r&&(e.rapidTracker.beacon(t.name,"autosuggestEnterKeydown"),t.close(),t.itemSelected(r)))})),t.registerEventHandler(t.get("container").one(".search-icon").on("click",function(n){var r=t.inputNode.get("value");r&&(e.rapidTracker.beacon(t.name,"autosuggestSearchIconClick"),t.itemSelected(r))}))}),this},close:function(){this.inputNode&&this.inputNode.ac&&this.inputNode.ac.hide()},itemSelected:function(t){var n,r,i,s=this.searchModel&&e.merge(this.searchModel.getValue("apiParams"))||{};if(typeof t=="string"||!t.raw.isSearchItem&&t.raw.type===0)r="/search?",delete s.text,delete s.tags,typeof t=="string"?s.text=t:(s.text=t.raw.title,e.rapidTracker.beacon(this.name,"autosuggestSuggestedPhotoSearchSelect")),s=e.merge(this.clearSearchScope(s),this.defaultSearchScope);else{if(!t.raw.isSearchItem)return s={},t.raw.pathalias?n=t.raw.pathalias:n=t.raw.nsid,t.raw.type===1?(r="/photos/"+n,e.rapidTracker.beacon(this.name,"autosuggestPersonSelect")):t.raw.type===2&&(r="/groups/"+n,e.rapidTracker.beacon(this.name,"autosuggestGroupSelect")),this.classicNavigate(r),!0;i=this.get("container").one("#autosuggest-input").get("value");if(!i)return e.rapidTracker.beacon(this.name,"autosuggestSearchButtonItemSelectEmpty"),!1;if(t.raw.searchScope==="people")return e.rapidTracker.beacon(this.name,"autosuggestPeopleSearchItemSelect"),r="/search/people/?",s={q:i},this.classicNavigate(r+e.QueryString.stringify(s)),!0;if(t.raw.searchScope==="groups")return e.rapidTracker.beacon(this.name,"autosuggestGroupsSearchItemSelect"),r="/search/groups/?",s={q:i},this.classicNavigate(r+e.QueryString.stringify(s)),!0;t.raw.isDefault?e
.rapidTracker.beacon(this.name,"autosuggestDefaultPhotoSearchItemSelect"):e.rapidTracker.beacon(this.name,"autosuggestOtherPhotoSearchItemSelect"),r="/search?",s.text=i,s=this.clearSearchScope(s),s=e.merge(s,t.raw.searchScope)}return e.SearchHelper.clearAdvancedSearchParams(s),this.appContext.flapp.navigate(r+e.QueryString.stringify(s)),!0},determineContext:function(){var e={},t=this.appContext.getViewer();this.searchModel?(e.global_global={people:1,groups:1},t.signedIn&&(e[t.nsid+"_user"]={people:1,groups:1}),this.groupInfo?e[this.groupInfo.nsid+"_group"]={tags:1,people:1,groups:1}:this.personInfo?e[this.personInfo.nsid+"_user"]={tags:1,people:1,groups:1}:(t.signedIn&&(e[t.nsid+"_user"]={tags:1,people:1,groups:1}),e.global_global={tags:1,people:1,groups:1})):e=this.contextWeights,this.setWeights(e)},clearSearchScope:function(e){return delete e.user_id,delete e.group_id,delete e.contacts,delete e.faves,e},getSearchScope:function(e){var t=["user_id","group_id","contacts","faves"],n,r,i={};for(n=0,r=t.length;n<r;n++)e[t[n]]&&(i[t[n]]=e[t[n]]);return i},buildSearchItems:function(){var e;this.appContext.flipper.isFlipped("autosuggest-B")?(this.searchItems=[{type:3,title:this.intlMessage({intlName:"autosuggest.SEARCH_PEOPLE"}),searchScope:"people",isSearchItem:!0,resultType:1,startSection:4,endSection:6},{type:4,title:this.intlMessage({intlName:"autosuggest.SEARCH_GROUPS"}),searchScope:"groups",isSearchItem:!0,resultType:2,startSection:5,endSection:7}],this.appContext.getViewer().signedIn&&(e=this.defaultSearchScope.contacts==="all"&&Object.keys(this.defaultSearchScope).length===1,this.hasDefaultSearchItem=this.hasDefaultSearchItem||e,this.searchItems.push({type:0,title:this.intlMessage({intlName:"autosuggest.SEARCH_CONTACTS_PHOTOS"}),searchScope:{contacts:"all"},isSearchItem:!0,resultType:0,startSection:e?0:3,endSection:e?0:3,isDefault:e}),e=this.defaultSearchScope.user_id===this.appContext.getViewer().nsid&&Object.keys(this.defaultSearchScope).length===1,this.hasDefaultSearchItem=this.hasDefaultSearchItem||e,this.searchItems.push({type:0,title:this.intlMessage({intlName:"autosuggest.SEARCH_YOUR_PHOTOS"}),searchScope:{user_id:this.appContext.getViewer().nsid},isSearchItem:!0,resultType:0,startSection:e?0:2,endSection:e?0:2,isDefault:e})),this.defaultSearchScope.user_id&&Object.keys(this.defaultSearchScope).length===1&&this.defaultSearchScope.user_id!==this.appContext.getViewer().nsid?(this.hasDefaultSearchItem=!0,this.searchItems.push({type:0,title:this.intlMessage({intlName:"autosuggest.SEARCH_USER_PHOTOS",name:this.personInfo.name}),searchScope:this.defaultSearchScope,isSearchItem:!0,resultType:0,startSection:0,endSection:0,isDefault:!0})):this.defaultSearchScope.group_id&&Object.keys(this.defaultSearchScope).length===1&&(this.hasDefaultSearchItem=!0,this.searchItems.push({type:0,title:this.intlMessage({intlName:"autosuggest.SEARCH_GROUP_PHOTOS",name:this.groupInfo.name}),searchScope:this.defaultSearchScope,isSearchItem:!0,resultType:0,startSection:0,endSection:0,isDefault:!0})),e=Object.keys(this.defaultSearchScope).length===0,this.hasDefaultSearchItem=this.hasDefaultSearchItem||e,this.searchItems.push({type:0,title:this.intlMessage({intlName:"autosuggest.SEARCH_EVERYONES_PHOTOS"}),searchScope:{},isSearchItem:!0,resultType:0,startSection:e?0:1,endSection:e?0:1,isDefault:e}),this.sectionMap={0:"0",1:"4",2:"5"},this.inputNode&&this.inputNode.ac.set("activateFirstItem",this.hasDefaultSearchItem)):(this.searchItems=[{type:3,title:this.intlMessage({intlName:"autosuggest.SEARCH_PEOPLE"}),searchScope:"people",isSearchItem:!0,resultType:1,startSection:1,endSection:3},{type:4,title:this.intlMessage({intlName:"autosuggest.SEARCH_GROUPS"}),searchScope:"groups",isSearchItem:!0,resultType:2,startSection:2,endSection:4}],this.sectionMap={0:"0",1:"1",2:"2"})},getContextModels:function(){var t=this,n,r,i=null,s=null;return this.searchModel?(n=this.searchModel.getValue("apiParams"),n.group_id?(r={},e.TypeValidator.matches.nsid(n.group_id)?r.id=n.group_id:r.pathAlias=n.group_id,i=t.appContext.getModel("groups-pool-models",r)):i=e.AutoResolvingPromise(),n.user_id?(r={},e.TypeValidator.matches.nsid(n.user_id)?r.id=n.user_id:r.pathAlias=n.user_id,s=t.appContext.getModel("person-models",r)):s=e.AutoResolvingPromise(),e.batch(i,s).then(function(e){e[0]&&(t.groupInfo={name:e[0].getValue("title"),nsid:e[0].id}),e[1]&&(t.personInfo={name:e[1].getValue("displayname"),nsid:e[1].getValue("nsid")})})):e.AutoResolvingPromise()},classicNavigate:function(t){window.location=e.url(t)},buildIconURL:function(t){return t.iconserver===0?"https://s.yimg.com/pw/images/buddyicon09_s.png":e.Lang.sub("https://farm{farm}.staticflickr.com/{server}/buddyicons/{nsid}.jpg",{farm:Math.ceil(t.iconserver/1e3),server:t.iconserver,nsid:t.nsid})},buildTokenRegExps:function(t){var n=[],r,i,s,o,u=t.split(" ").map(e.Text.AccentFold.fold.bind(e.Text.AccentFold));for(r=0,i=u.length;r<i;r++)s=u[r],s&&(o=this.escapeForRegExp(s),n.push({re:new RegExp(o,"i"),numChars:s.length}));return n},escapeForRegExp:function(e){return e=decodeURIComponent(e),e.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/\?/g,"\\?").replace(/\|/g,"\\|").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\[/g,"\\[").replace(/\]/g,"\\]")},maxMatch:function(e,t,n,r,i){var s=this,o=t.length,u;return u=e.map(function(e){var r=t.match(e.re),u=0,a;return r&&(a=r.index===0,i?u=1:u=e.numChars/o,n&&!a&&(u=0),a&&(u*=s.START_MATCH_MULTIPLIER)),u}),u.length?Math.max.apply(Math,u):0},allocateTypeCounts:function(e,t){var n=Object.keys(e),r=n.length,i={},s,o=n.reduce(function(t,n){return t+e[n]},0),u=0,a,f;t=Math.min(t,o),s=Math.floor(t/n.length);for(a=0;a<r;a++)f=n[a],s<=e[f]?i[f]=s:i[f]=e[f],u+=i[f];if(u===t)return i;a=0;while(u<t)a%=r,f=n[a],e[f]>i[f]&&(i[f]++,u++),a++;return i},setWeights:function(e){var t=this,n,r=[];this.contextWeights=e;for(n in this.contextWeights)this.appContext.getModel("autosuggest-context-results-models"
,n).then(function(e){r.push(e),t.computeResultItems(r),t.inputNode&&t.inputNode.ac&&t.inputNode.test(":focus")&&t.inputNode.ac.fire("query",{inputValue:t.inputNode.get("value"),query:t.inputNode.get("value")})})},computeResultItems:function(t){var n=this,r={},i=[],s,o,u,a,f;for(s=0,o=t.length;s<o;s++)u=t[s],a=this.contextWeights[u.id],["tags","people","groups"].forEach(function(t){var i=u.getValue(t),s=a[t],o,f,l;if(!s)return;for(o=0,f=i.length;o<f;o++)l=i[o],r[l.key]||(r[l.key]=e.merge(l),r[l.key].score=0),r[l.key].score+=l.score*s,r[l.key].section=n.sectionMap[l.type]});for(f in r)i.push(r[f]);return this.resultItems=i,i},destructor:function(){this.inputNode&&this.inputNode.ac&&this.inputNode.ac.destroy(!0)}})},"@VERSION@",{requires:["flickr-promise","flickr-view","flutil","url","autosuggest-css","text-accentfold","autosuggest-context-results-models","hermes-template-autosuggest-bar","hermes-template-autosuggest-item"],langBundles:["autosuggest"]});
YUI.add("hermes-lang-autosuggest",function(e,t){e.Intl.add("hermes/autosuggest","en-US",{MEMBER:["1 member"],MEMBERS:[{type:"number",valueName:"count"}," members"],SEARCH_PEOPLE:["Search people"],SEARCH_GROUPS:["Search groups"],SEARCH_PHOTOS:["Search photos"],MORE:["More"],MORE_SEARCH_TYPES:["More search types"],MORE_OPTIONS:["More options"],SEARCH_YOUR_PHOTOS:["Search your photos"],SEARCH_EVERYONES_PHOTOS:["Search everyone's photos"],SEARCH_CONTACTS_PHOTOS:["Search your contacts' photos"],YOUR_PHOTOS:["Your photos"],EVERYONES_PHOTOS:["Everyone's photos"],YOUR_CONTACTS_PHOTOS:["Your contacts' photos"],SEARCH_USER_PHOTOS:["Search ","${name}","'s photos"],SEARCH_GROUP_PHOTOS:["Search photos in ","${name}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("search-helper",function(e){function a(e){return!e[n.userId]&&!e[n.groupId]&&!e[n.tags]&&!e[n.text]&&!e[n.license]&&!e[n.faves]&&!e[n.contacts]&&!e[n.getty]&&!e[n.commons]&&!e[n.minTakenDate]&&!e[n.maxTakenDate]&&!e[n.minUploadDate]&&!e[n.maxUploadDate]&&!e[n.hasGeo]&&!e[n.boundingBox]&&!e[n.woeId]&&!e[n.camera]&&!e[n.minExposure]&&!e[n.maxExposure]&&!e[n.minAperture]&&!e[n.maxAperture]&&!e[n.minFocalLength]&&!e[n.maxFocalLength]&&!e[n.foursquareWoeId]&&!e[n.foursquareVenueId]}function f(e,t){var n;for(n in r){if(!t&&n===e)return r[n];if(t&&r[n]===e)return n}}function l(e){var t={nsid_or_path_alias:"userId",group_id:"groupId",set_id:"setId",page_number:"page",tag_list:"tags",location:"text",slideshow_start_id:"slideshowStartId"},r,i={};for(r in t)e[r]&&(i[n[t[r]]]=e[r]);return i}function c(i,s){var o={},u,a,f=s.getViewer(),l=i.l,c=i.s,h=i.w,p=i.d&&i.d.split("-"),d=i.m,v=i.q,m;i.q&&(o[n.text]=i.q),typeof i["ss"]!="undefined"&&(o[n.safeSearch]=parseInt(i.ss,10)+1),typeof i["ct"]!="undefined"&&(o[n.contentType]=parseInt(i.ct,10)+1),typeof i["mt"]!="undefined"&&(o[n.mediaType]=i.mt),i.b&&(o[n.boundingBox]=i.b),i.a&&(o[n.accuracy]=i.a),i.e&&(o[n.woeId]=i.e),i.g&&(o[n.groupId]=i.g),i.cm&&(o[n.camera]=i.cm),typeof i["xel"]!="undefined"&&(o[n.minExposure]=i.xel),typeof i["xeh"]!="undefined"&&(o[n.maxExposure]=i.xeh),typeof i["xal"]!="undefined"&&(o[n.minAperture]=i.xal),typeof i["xah"]!="undefined"&&(o[n.maxAperture]=i.xah),typeof i["xfl"]!="undefined"&&(o[n.minFocalLength]=i.xfl),typeof i["xfh"]!="undefined"&&(o[n.maxFocalLength]=i.xfh),i.eui&&(o[n.excludeUserId]=i.eui);if(typeof l!="undefined")switch(l){case"cc":case"comm":case"deriv":case"commderiv":o[n.license]=r[l];break;default:a=parseInt(l,10),a>=0&&a<=8&&(o[n.license]=a)}if(c)switch(c){case"rec":o[n.sort]="date-posted-desc";break;case"rel":o[n.sort]="relevance";break;case"int":o[n.sort]="interestingness-desc";break;default:}i.hd&&(o[n.media]="hdvideo");if(h)if(h.indexOf("faves")!==-1)m=h.split("-"),o[n.faves]=1,m.length>1?o[n.userId]=m[1]:f.signedIn&&(o[n.userId]=f.nsid);else if(e.TypeValidator.matches.nsid(h))o[n.userId]=h;else switch(h){case"contacts":o[n.contacts]="all";break;case"ff":o[n.contacts]="ff";break;case"getty":o[n.getty]="true";break;case"commons":o[n.commons]="true";break;case"usg":o[n.license]=8;break;case"all":default:}if(p)switch(p[0]){case"taken":p[1]&&(o[n.minTakenDate]=e.flutil.parseYYYYMMDDDatestamp(p[1])/1e3),p[2]&&(o[n.maxTakenDate]=e.flutil.parseYYYYMMDDDatestamp(p[2])/1e3);break;case"posted":p[1]&&(o[n.minUploadDate]=e.flutil.parseYYYYMMDDDatestamp(p[1])/1e3),p[2]&&(o[n.maxUploadDate]=e.flutil.parseYYYYMMDDDatestamp(p[2])/1e3);break;default:}if(d&&v)switch(d){case"tags":o=e.merge(o,this._processTags(v)),delete o[n.text];break;default:}for(u in i)t.indexOf(u)===-1&&(o[u]=i[u]);return o}function h(e){var t={},r=e[n.userId];return e[n.text]?t.q=e[n.text]:e[n.tags]&&(t.q=e[n.tags]),e[n.faves]?r?t.w="faves-"+r:t.w="faves":r?t.w=r:e[n.contacts]==="all"?t.w="contacts":e[n.contacts]==="ff"?t.w="ff":e[n.getty]==="true"?t.w="getty":e[n.commons]==="true"?t.w="commons":parseInt(e[n.license],10)===8&&(t.w="usg"),e[n.license]&&(t.l=f(e[n.license],!0)),t}function p(e){var t={},r=/(["'])(\\?.)*?\1/g,i=/[,\+\s]/,s=/^([,\+]|AND|OR)$/,o=/[\+\s]OR[\+\s]/,u,a,f,l;return u=e.match(r)||[],a=e.replace(r,""),f=a.split(i),f=f.map(function(e){return e.trim()}).filter(function(e){return e&&!s.test(e)}),l=u.concat(f),t[n.tags]=l.join(","),o.test(e)?(t[n.tagMode]="any",l.length=Math.min(l.length,11)):t[n.tagMode]="all",t}function d(e,t){e[n.sort]||(e[n.sort]="relevance"),e[n.license]&&(e[n.license]===r.all||e[n.license]==="")&&delete e[n.license]}function v(e){var t;for(t in e)s.indexOf(t)===-1&&delete e[t]}function m(e){var t;for(t in e)i.indexOf(t)===-1&&delete e[t]}function g(t){var n=e.clone(t)||{};return delete n.page,delete n.method,delete n.extras,e.QueryString.stringify(n)}function y(t){var r=t[n.groupId],i=t[n.tags],s=t[n.text];YUI.Env.isServer&&(r&&(t[n.groupId]=e.flutil.unescape(r)),i&&(t[n.tags]=e.flutil.unescape(i)),s&&(t[n.text]=e.flutil.unescape(s)))}function b(){var t={};return t[e.SearchHelper.API.text]="_____THIS-IS-AN-EMPTY-SEARCH-PLACEHOLDER_____",t}var t=["q","ss","ct","mt","l","s","w","d","m","hd","b","a","g","e","cm","xel","xeh","xal","xah","xfl","xfh","eui"],n={userId:"user_id",groupId:"group_id",setId:"set_id",page:"page",text:"text",tags:"tags",tagMode:"tag_mode",sort:"sort",safeSearch:"safe_search",contentType:"content_type",mediaType:"media",license:"license",faves:"faves",contacts:"contacts",getty:"is_getty",commons:"is_commons",minTakenDate:"min_taken_date",maxTakenDate:"max_taken_date",minUploadDate:"min_upload_date",maxUploadDate:"max_upload_date",hasGeo:"has_geo",boundingBox:"bbox",accuracy:"accuracy",woeId:"woe_id",camera:"camera",minExposure:"exif_min_exposure",maxExposure:"exif_max_exposure",minAperture:"exif_min_aperture",maxAperture:"exif_max_aperture",minFocalLength:"exif_min_focallen",maxFocalLength:"exif_max_focallen",excludeUserId:"exclude_user_id",foursquareWoeId:"foursquare_woeid",foursquareVenueId:"foursquare_venueid",slideshowStartId:"jump_to"},r={all:"0,1,2,3,4,5,6,7,8",cc:"1,2,3,4,5,6",deriv:"1,2,4,5",comm:"4,5,6",commderiv:"4,5"},i=[n.userId,n.groupId,n.faves,n.contacts],s=[n.userId,n.groupId,n.faves,n.contacts,n.safeSearch,n.sort,n.license,n.tags,n.text],o=20,u=50;e.SearchHelper={API:n,LICENSE_TYPE:r,PREFETCH_PAGE_SIZE:o,FETCH_PAGE_SIZE:u,isParameterlessSearch:a,mapRouteParamsToAPI:l,convertLicenseTypeValue:f,mapClassicSearchToAPI:c,mapAPIParamsToAdvancedSearchQuery:h,addParamDefaults:d,clearAdvancedSearchParams:v,clearSearchScope:m,generateQueryString:g,unescapeParameters:y,generateDefaultSearch:b,_processTags:p}},"@VERSION@",{requires:["type-validator","flutil"]});
YUI.add("search-bar-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("search-bar-view",e.FlickrView,[],{langBundles:["autosuggest"],initializer:function(e){return this.searchId=e.searchId,this.searchTerm=e.searchTerm,this},loadState:function(){var t=this,n=this.appContext.getViewer(),r;return this.searchId?(n.signedIn?r=e.batch(this.appContext.getModel("search-photos-models",this.searchId),this.appContext.getModel("person-preferences-models",n.nsid)):r=e.batch(this.appContext.getModel("search-photos-models",this.searchId)),r.then(function(e){t.searchModel=e[0],e[1]&&(t.personPreferencesModel=e[1])}),r):new e.AutoResolvingPromise},buildContainer:function(){var t=this.templates("autosuggest-bar")({searchTerm:this.searchTerm?e.flutil.unescape(this.searchTerm):""});return this.setContainerHTML(t),this},activate:function(){var t=this;return t.inputNode=e.one("#autosuggest-input"),t.registerEventHandler(t.inputNode.on("keydown",function(n){var r=t.inputNode.get("value");n.keyCode===13&&(n.halt(),r&&(e.rapidTracker.beacon(t.name,"autosuggestEnterKeydown"),t.itemSelected(r)))})),t.registerEventHandler(t.get("container").one(".search-icon").on("click",function(n){var r=t.inputNode.get("value");r&&(e.rapidTracker.beacon(t.name,"autosuggestSearchIconClick"),t.itemSelected(r))})),this},itemSelected:function(t){var n,r,i,s=this.searchModel&&e.merge(this.searchModel.getValue("apiParams"))||{};delete s.page;if(typeof t!="string"&&t.raw.type!==0){if(t.raw.isSearchItem){i=this.get("container").one("#autosuggest-input").get("value"),s={q:i},t.raw.context==="people"?r="/search/people/?":t.raw.context==="groups"&&(r="/search/groups/?"),this.classicNavigate(r+e.QueryString.stringify(s));return}s={},t.raw.pathalias?n=t.raw.pathalias:n=t.raw.nsid,t.raw.type===1?(r="/photos/"+n,e.rapidTracker.beacon(this.name,"autosuggestPersonSelect")):t.raw.type===2&&(r="/groups/"+n,e.rapidTracker.beacon(this.name,"autosuggestGroupSelect")),this.classicNavigate(r);return}r="/search?",delete s.q,delete s.text,delete s.tags,typeof t=="string"?s.text=t:(s.tags=t.raw.title,e.rapidTracker.beacon(this.name,"autosuggestTagSelect")),this.defaultContext&&(delete ["user_id"],delete ["group_id"],this.defaultContextType==="user"?s.user_id=this.defaultContext:this.defaultContextType==="group"&&(s.group_id=this.defaultContext)),e.SearchHelper.clearAdvancedSearchParams(s),e.SearchHelper.addParamDefaults(s,this.personPreferencesModel),this.appContext.flapp.navigate(r+e.QueryString.stringify(s))},classicNavigate:function(t){window.location=e.url(t)},destructor:function(){}})},"@VERSION@",{requires:["flickr-promise","flickr-view","flutil","autosuggest-css","hermes-template-autosuggest-bar","search-helper","url"],langBundles:["autosuggest"]});
YUI.add("global-nav-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:["global-nav","common","filter-bar"],initializer:function(e){return this.get("container").html===""&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=e,this},subviewConfig:{"autosuggest-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("autosuggest2")}},"search-bar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("autosuggest")}},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var t=this,n=this.appContext.getViewer();return n.signedIn?this.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer",e),t.elementStates=t.setElementStates(t.appStateParams)}):(t.elementStates=t.setElementStates(t.appStateParams),new e.AutoResolvingPromise)},buildContainer:function(){var t={},n;return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),n={"account-menu-view":this.subviews["account-menu-view"].get("container"),viewer:t,elements:this.elementStates,showSmartSearchBar:this.appContext.flipper.isFlipped("autosuggest"),showAutosuggest:this.appContext.flipper.isFlipped("autosuggest2"),flippers:this.appContext.flipper.toJSON()},n.showAutosuggest?n["autosuggest-view"]=this.subviews["autosuggest-view"].get("container"):n.showSmartSearchBar&&(n["search-bar-view"]=this.subviews["search-bar-view"].get("container")),this.setContainerHTML(this.templates("global-nav")(n)),this},activate:function(){var e=this;return this.attachKeyEvent("up:83",this.focusSearch.bind(this)),e.subviews["autosuggest-view"]&&(this.registerEventHandler(this.subviews["autosuggest-view"].on("open",function(t){e.subviews["account-menu-view"].closeMenu()})),this.registerEventHandler(this.subviews["account-menu-view"].on("open",function(t){e.subviews["autosuggest-view"].close()}))),this},focusSearch:function(e){this.appContext.flipper.isFlipped("autosuggest")?this.subviews["search-bar-view"].get("container").one("#autosuggest-input").focus():this.get("container").one("#gn-search-field").focus()},setElementStates:function(e){var t={small_logo:!1,you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,upload_link:!1,account_menu:!1,search_bar:!1,tour_link:!1,signup_link:!1,signin_link:!1,pro_upsell:!1,chronic_link:!1,editr_tour_link:!1,use_uh_eyebrow:!1,show_filter_bar:!1},n=this.appContext.getViewer();return e.isJobs?t.small_logo=!0:e.isPlayr?t.use_uh_eyebrow=!1:e.isEditr?(t.small_logo=!0,t.you_link=!0,t.chronic_link=!0,t.editr_tour_link=!0,t.account_menu=!0,t.use_uh_eyebrow=!1):e.isHome&&!n.signedIn?(t.tour_link=!0,t.signup_link=!0,t.explore_menu=!0,t.upload_link=!0,t.search_bar=!0,t.signin_link=!0):n.signedIn?(t.you_menu=!0,t.contacts_menu=!0,t.groups_menu=!0,t.explore_menu=!0,t.upload_link=!0,t.search_bar=!0,t.account_menu=!0):(t.tour_link=!0,t.signup_link=!0,t.explore_menu=!0,t.upload_link=!0,t.search_bar=!0,t.signin_link=!0),this.get("viewer")&&this.get("viewer").getValue("isPro")&&(t.stats=!0),this.appContext.lang.toLowerCase()==="en-us"&&(t.weekly_flickr=!0),e.isSearchResults&&(t.show_filter_bar=!0),t.set_not_album=!this.appContext.flipper.isFlipped("rename-set-to-album"),t}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","global-nav-css","autosuggest-view","search-bar-view","url-helper"],langBundles:["global-nav","filter-bar","common"]});
YUI.add("hermes-lang-global-nav",function(e,t){e.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-filter-bar",function(e,t){e.Intl.add("hermes/filter-bar","en-US",{EVERYONE:["Everyone's Photos"],YOUR_PHOTOS:["Your Photos"],CONTACTS_PHOTOS:["Your Contacts' Photos"],USER_PHOTOS:["${name}","'s Photos"],GROUP_PHOTOS:["Photos in ","${name}"],PEOPLE:["People"],GROUPS:["Groups"],USER_PHOTOS_IN_GROUP:["${name}","'s Photos in ","${group}"],YOUR_PHOTOS_IN_GROUP:["Your Photos in ","${group}"],CONTACTS_PHOTOS_IN_GROUP:["Your Contacts' Photos in ","${group}"],YOUR_FAVORITES:["Your Favorites"],MORE:["More"],LESS:["Less"],PHOTOS_VIDEOS:["Photos & Videos"],ONLY_PHOTOS:["Only Photos"],ONLY_VIDEOS:["Only Videos"],ALL_TIME:["All Time"],DATE_TAKEN:["Date Taken"],DATE_POSTED:["Date Posted"],FROM:["From"],TO:["To"],MONTH_CHARS:["mm"],DAY_CHARS:["dd"],YEAR_CHARS:["yyyy"],DATE_INVALID:["Date invalid"],DONE:["Done"],DATE:["Date"],LICENSE:["License"],ANY_LICENSE:["Any License"],CC_LICENSE:["Creative Commons only"],CC_LICENSE_PARENT:["Creative Commons"],COMM_LICENSE:["Commercial use allowed"],DERIV_LICENSE:["Modifications allowed"],SS_ON:["SafeSearch on"],ON:["On"],SS_MOD:["SafeSearch moderate"],MOD:["Moderate"],SS_OFF:["SafeSearch off"],OFF:["Off"],RELEVANT:["Relevant"],RECENT:["Recent"],INTERESTING:["Interesting"],SORT_BY:["Sort"],SEARCH_IN:["Search"],ADVANCED_SEARCH:["Advanced Search"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(t){return this.showWelcomeDialog=t.showWelcomeDialog,this.closeUrl=t.closeUrl,this.entryType=t.entryType,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.realFullscreen=this.appContext.experiments.fullscreen.isRealFullscreen(),t.fullscreen?this.appContext.experiments.fullscreen.enableFullscreen():this.appContext.experiments.fullscreen.disableFullscreen(),t.realFullscreen=this.realFullscreen,t.isOwner=this.isOwner,this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",t.title.newVal+" | Flickr - Photo Sharing!")})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-sidebar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()}},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){var t,n=this.subviews["photo-well-view"].get("container"),r,i,s=!1;return this.appContext.flipper.isFlipped("enable-scrappy-photo-page")&&n.addClass("scrappy-photo-page-enabled"),this.realFullscreen?this.appContext.experiments.fullscreen.getMode()?(r="",n.addClass("is-real-fullscreen"),s=!0):(r=this.subviews["photo-sidebar-view"].get("container"),YUI.Env.isServer||n.removeClass("is-real-fullscreen")):r=this.subviews["photo-sidebar-view"].get("container"),this.appContext.getViewer().signedIn||s?i="":this.appContext.flipper.isFlipped("global-nav-enabled")&&(i=this.subviews["global-nav-view"].get("container")),t=this.templates("photo-page")({"photo-well-view":n,"sidebar-view":r,"global-nav-view":i}),this.setContainerHTML(t),e.Fletrics.increment("test.photo.page.requests"),this},buildErrorContainer:function(){var t={};!YUI.Env.isServer&&e.config.flickr.requestConfig.auth&&e.config.flickr.requestConfig.auth.isInsecureGod&&(t.message="This is a client side panda! You're seeing this because this view failed to loadState itself, one of its dealbreaker subviews failed to loadState or two non-dealbreaker subviews failed to loadState.",t.environment="Client"),YUI.Env.isServer||e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.clientpanda",title:"ClientPandas"},e.url("/beacon_flanal_reboot_event.gne"))}),this.setContainerHTML(this.templates("error-500")(t))},activate:function(){var t=this.get("container"),n,r,i=this,s=t?t.ancestor("#content"):null,o=[];return this.showWelcomeDialog&&(r=this.templates("reboot-welcome-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),this.appContext.experiments.optOut.enabled()&&o.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":window.location.pathname}))}),n=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Welcome to the beta of the new photo page!",confirmButtonText:"Take me to the new experience!",verticalButtonList:!0,additionalButtons:o},content:r,parent:this,rootEl:t}),n.get("container").addClass("welcome-dialog"),setTimeout(function(){n.show()},100)),this.appContext.flipper.isFlipped("scrollbar")&&this.subviews["photo-sidebar-view"]&&this.enableScrollbarFix(),this.appContext.adManager.isEnabled()&&(this.appContext.adManager.updatePhotoAdsCounter(),this.appContext.adManager.fetchAdIfRequired({spaceid:this.get("spaceid")})),this.appContext.flipper.isFlipped("enable-scrappy-photo-page")||this.attachKeyEvent("up:27",this.closeDialog.bind(this)),this.appContext.flipper.isFlipped("shortcut-legend")&&(this.attachKeyEvent("down:191",this.showKeyboardLegend.bind(this)),e.on("flickr:photo-page:hideKeyboardLegend",function(){i.keyboardLegend.isVisible()&&(i.keyboardLegend.hide(),i.keyboardLegendDialogView.destroy(),i.keyboardLegend.destroy())})),s&&(this.scrollbarWidth===0&&s.setStyle("overflow","auto"),this.registerEventHandler(s.on("scroll",function(e){i.subviews["photo-sidebar-view"]&&i.subviews["photo-sidebar-view"].fire("subviewViewEvent","animateCloseBtn",{scrollTop:s.get("scrollTop"),scrollbarSize:i.scrollbarWidth||0})}))),this},showKeyboardLegend:function(t){var n,r=new e.Views["keyboard-legend-view"]({});r.appContext=this.appContext,r.buildContainer(),n=r.get("container"),this.keyboardLegend=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:this.appContext}),this.keyboardLegend.show(),r._params.keyEventScope=this.keyboardLegend.getKeyEventScope(),r.activate(),this.keyboardLegendDialogView=r},closeDialog:function(t){e.config.win.location.href=this.closeUrl},enableScrollbarFix:function(){var t,n,r,i,s,o,u=this,a,f;this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()?f=0:f=e.OverflowHelper.detectScrollbarSize(this.get("container")),this.scrollbarWidth=f,f>0&&(t=this.get("container").ancestor("#content"),n=this.subviews["photo-sidebar-view"].get("container"),r=this.subviews["photo-well-view"].get("container"),i=parseInt(n.getStyle("maxWidth").replace("px",""),10),a=parseInt(r.getStyle("right").replace("px",""),10),e.OverflowHelper.addFlowListener(t,"over",function(){if(this.offsetWidth>this.clientWidth||this.offsetHeight>this.clientHeight)n.setStyle("maxWidth",i),n.setStyle("overflow","visible")},function(e){u.overflowEventHandler=e,u.registerEventHandler(e)}),e.OverflowHelper.addFlowListener(t,"under",function(){this.offsetWidth===this.clientWidth&&(n.setStyle("maxWidth",i+f+1),n.setStyle("overflow","visible"))},function(e){u.underflowEventHandler=e,u.registerEventHandler
(e)}),n.setStyle("overflow","hidden"),this.scrollTimeout=setTimeout(function(){n&&n._node&&n.setStyle("overflow","visible")},1e3),t.setStyle("overflow","auto"),this.adjustScrollForDropdown=function(e){s=parseInt(n.getStyle("maxWidth").replace("px",""),10);if(s>=i+f&&t._node.offsetWidth===t._node.clientWidth&&t._node.offsetHeight===t._node.clientHeight)t.setStyle("overflow","visible"),e.scrollIntoView(!0),o=0;else if(s>=i+f&&t._node.offsetWidth>t._node.clientWidth||t._node.offsetHeight>t._node.clientHeight)u.undoSidebar(),t.setStyle("overflow","visible"),e.scrollIntoView(!0),o=1;else if(s===i&&t._node.offsetWidth>t._node.clientWidth||t._node.offsetHeight>t._node.clientHeight)u.undoSidebar(),t.setStyle("overflow","visible"),e.scrollIntoView(!0),o=2},this.unAdjustScrollForDropdown=function(){s=parseInt(n.getStyle("maxWidth").replace("px",""),10);if(s!==i||t._node.offsetWidth!==t._node.clientWidth||t._node.offsetHeight!==t._node.clientHeight||o!==0)s!==i||t._node.offsetWidth!==t._node.clientWidth&&t._node.offsetHeight!==t._node.clientHeight||o!==1?s===i&&(t._node.offsetWidth===t._node.clientWidth||t._node.offsetHeight===t._node.clientHeight)&&o===2&&u.doSidebar(!0):u.doSidebar();t.setStyle("overflow","auto")},this.doSidebar=function(e){!e&&t._node.offsetWidth<=t._node.clientWidth&&n.setStyle("maxWidth",i+f),n.one(".closeBtn, .newCloseBtn").setStyle("right",f+10),n.one(".scrollingNewCloseBtn").setStyle("right",f+13),r.setStyle("right",parseInt(r.getStyle("right").replace("px",""),10)+f)},this.undoSidebar=function(){n.setStyle("maxWidth",i),n.setStyle("overflow","visible"),n.one(".closeBtn, .newCloseBtn").setStyle("right",10),n.one(".scrollingNewCloseBtn").setStyle("right",10),r.setStyle("right",a)},this.doSidebar(),e.fire("flickr:photo-media-well-update"))},disableScrollbarFix:function(){var t=e.OverflowHelper.detectScrollbarSize(this.get("container")),n;t>0&&(this.overflowEventHandler&&this.overflowEventHandler.detach(),this.underflowEventHandler&&this.underflowEventHandler.detach(),n=this.subviews["photo-well-view"].get("container"),n.setStyle("right",""))},onSubviewEvent:function(e,t){var n;if(t&&t.length>0){if(t[0]==="make in view"&&t.length>1)return this.adjustScrollForDropdown?this.adjustScrollForDropdown(t[1]):(this.get("container").ancestor("#content").setStyle("overflow","visible"),t[1].scrollIntoView(!0)),!1;if(t[0]==="close in view")return this.unAdjustScrollForDropdown?this.unAdjustScrollForDropdown():this.get("container").ancestor("#content").setStyle("overflow","auto"),!1;if(t[0]==="getDialogOffset")t[1]&&typeof t[1]=="function"&&(n=this.subviews["photo-well-view"].get("container"),n&&t[1](parseInt(n.getStyle("right").replace("px",""),10)/2));else if(t[0]==="setRedirect")this.get("container").all("input[name=redirect_url]").setAttribute("value",window.location.pathname),typeof t[1]=="function"&&t[1]();else if(t[0]==="rightClickPhoto")return this.subviews["photo-sidebar-view"].fire("parentViewEvent","rightClickPhoto"),!1}},buildHeadContainer:function(){var e=this.subviews["photo-head-meta-view"].get("headContainer");return this.set("headContainer",e),this},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0,fullScrn:this.appContext.experiments.fullscreen.getMode()?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600506}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","dialog","overflow-helper","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out","hermes-template-error-500","keyboard-legend-view","url"],optional:["photo-well-view","photo-sidebar-view","photo-head-meta-view","global-nav-view"]});
YUI.add("hermes-template-photo-page-scrappy",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["global-nav-view"],u):a.call(t,"outlet",t["global-nav-view"],u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-view"],u):a.call(t,"outlet",t["photo-well-view"],u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-view"],u):a.call(t,"outlet",t["sub-photo-view"],u)))+"\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["footer-full-view"],u):a.call(t,"outlet",t["footer-full-view"],u))),s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-scrappy",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-scrappy",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" no-click"}function d(e,t){return" is-hidden"}function v(e,t){return" is-video"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){return"is-video"}function b(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}function w(e,t){var r="",i,s,o;return r+="\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-toggle-view"],o):c.call(e,"outlet",e["photo-sidebar-toggle-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-overlay-view"],o):c.call(e,"outlet",e["photo-title-desc-overlay-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-actions-view"],o):c.call(e,"outlet",e["photo-sidebar-actions-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],o):c.call(e,"outlet",e["attribution-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["people-notes-view"],o):c.call(e,"outlet",e["people-notes-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["context-slider-view"],o):c.call(e,"outlet",e["context-slider-view"],o)))+"\n		",o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-engagement-view"],o):c.call(e,"outlet",e["photo-engagement-view"],o)))+"\n	\n		<a class='entry-type' href='",(s=n.entryURL)?s=s.call(e,{hash:{},data:t}):(s=e.entryURL,s=typeof s===f?s.apply(e):s),r+=l(s)+"'>Back to ",(s=n.entryType)?s=s.call(e,{hash:{},data:t}):(s=e.entryType,s=typeof s===f?s.apply(e):s),r+=l(s)+"</a>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+="<div class='height-controller' style='height: ",(o=n.height)?o=o.call(t,{hash:{},data:i}):(o=t.height,o=typeof o===f?o.apply(t):o),s+=l(o)+"px;'>\n\n	<a class=\"navigate-target navigate-prev",o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad" style=\'height: ',(o=n.navHeight)?o=o.call(t,{hash:{},data:i}):(o=t.navHeight,o=typeof o===f?o.apply(t):o),s+=l(o)+'px;\'><span class="hide-text">&larr;</span></a>\n\n	<div class="facade-of-protection-neue ',o=n["if"].call(t,t["is-video"],{hash:{},inverse:h.noop,fn:h.program(11,y,i),data:i});if(o||o===0)s+=o;s+='">&nbsp;</div>\n\n	',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-media-view"],a):c.call(t,"outlet",t["photo-well-media-view"],a)))+"\n	",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-notes-scrappy-view"],a):c.call(t,"outlet",t["photo-notes-scrappy-view"],a)))+'\n\n	<a class="navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(13,b,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad" style=\'height: ',(u=n.navHeight)?u=u.call(t,{hash:{},data:i}):(u=t.navHeight,u=typeof u===f?u.apply(t):u),s+=l(u)+'px;\'><span class="hide-text">&rarr;</span></a>\n\n	',u=n.unless.call(t,t["is-ad"],{hash:{},inverse:h.noop,fn:h.program(15,w,i),data:i});if(u||u===0)s+=u;return s+="\n	\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-scrappy",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-scrappy-view",function(e){var t=500,n=500,r=100,i;i={photo:{render:function(){var t=this,n,i=this.get("photo"),s,o,u=new Date;return t.preloadImage&&(t.preloadImage.onload=null),s=this.getPhotoForDisplay(),o=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n=this.templates("photo-well-media")({width:s.width,height:s.height,src:o.url,highResSrc:s.url,needsInterstitial:i.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:i.getValue("isVideo")}),this.setContainerHTML(n),YUI.Env.isServer?(this.serverWidth=s.width,this.serverHeight=s.height):i.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0,e.rapidTracker.beacon(this.name,"photoPageShowedSize"+(/(?:_([a-z]))?\.jpg/.exec(s.url)[1]||"\u00f8").toUpperCase());var n=t.get("container").one(".low-res-photo"),i=t.get("container").one(".main-photo"),o=new Date-u,a;o<r?(i.removeClass("is-hidden").show(),n.hide()):(i.setStyles({position:"absolute",left:40,top:20,opacity:0}),i.removeClass("is-hidden"),a=function(){i.removeAttribute("style"),n.hide()},e.UA.ie?a():e.use("transition",function(e){i.transition({duration:.25,opacity:1},a)}))},t.preloadImage.src=s.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t,n=this,r=this.get("photo"),i=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(i.width,i.height),this):(t=this.templates("photo-well-media")({width:i.width,height:i.height,src:i.url,needsInterstitial:r.getValue("needsInterstitial"),isVideo:r.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn}),this.setContainerHTML(t),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:r,appContext:this.appContext}),n.player.init().then(function(){n}),this.on("destroy",function(){n.player.destroy(),n.player=null}),this))}},flippedOff:{render:function(){var e,t=this.get("photo"),n=this.getPhotoForDisplay();return e=this.templates("photo-well-media-novideo")({width:n.width,height:n.height,src:n.url,needsInterstitial:t.getValue("needsInterstitial"),isVideo:t.getValue("isVideo")}),this.setContainerHTML(e),this}},ad:{render:function(){var e,t,n;return this.adJSON?t=this.adJSON:(t=this.appContext.adManager.getAdJSON(),this.adJSON=t),n=this.getAdSize(t),e=this.templates("photo-well-ad")({width:n.width,height:n.height,src:t.url,clickUrl:t.clickUrl,brand:t.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this.setContainerHTML(e),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.get("container").html===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.appContext.flipper.isFlipped("yep-video")?i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this):i.flippedOff.render.call(this),this},handleInterstitialDismissButtonClick:function(t){var n=this,r=this.get("personPreferences"),i=this.get("photo"),s=i.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),r.setValue("safeSearch",s),r.registry.remoteUpdate(n.appContext.auth.user.nsid).then(function(e){var t=i.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){i.registry.getValue(e,"safetyLevel")<=r.getValue("safeSearch")&&i.registry.setValue(e,"needsInterstitial",!1)}),n.buildContainer()},function(e){n.appContext.error(e.message),n.appContext.error(e.stack),n.onError("We couldn't update your settings")})},onParentViewEvent:function(e,t){t&&t[0]==="photoWellResized"&&(this.get("photo").getValue("needsInterstitial")||(this.set("canvasSizeIsDirty",!0),this.buildContainer()))},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:"Error",level:"warning",confirmLabel:"OK"},parent:n,offsetLeft:r,dialogClass:"scrappy-dialog"});i.show()})},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(
t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,r=this.getPixelRatio(),i,s=this.get("container"),o,u,a,f,l={width:t,height:n};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(i=this.get("container").ancestor(),o=s.getStyle("paddingTop")?parseInt(s.getStyle("paddingTop").match(/[0-9]+/)[0],10):0,u=s.getStyle("paddingBottom")?parseInt(s.getStyle("paddingBottom").match(/[0-9]+/)[0],10):0,f=s.getStyle("paddingRight")?parseInt(s.getStyle("paddingRight").match(/[0-9]+/)[0],10):0,a=s.getStyle("paddingLeft")?parseInt(s.getStyle("paddingLeft").match(/[0-9]+/)[0],10):0,i&&(e=i.get("region"),e.height=parseInt(i.getStyle("height").match(/[0-9]+/)[0],10)-(o+u),e.width=this.appContext.viewportData.viewport.width-(f+a),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPWS",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPHS",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:r})))):e=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(l={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),e||(e={top:0,left:0,bottom:n,right:t,width:parseInt(this.appContext.getCookie("photoPWS"),10)||l.width,height:parseInt(this.appContext.getCookie("photoPHS"),10)||l.height}),e.height*=r,e.width*=r,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","hermes-template-photo-well-media-novideo","moment","flickr-video-player","hermes-template-photo-well-ad"],optional:["photo-models"]});
YUI.add("hermes-template-context-slider-photo",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){return"currentImage"}function c(e,t){return"restrictedImage"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+='<a class="context-thumb emptyImage ',o=n["if"].call(t,t.currentPhoto,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.needsInterstitial,{hash:{},inverse:u.noop,fn:u.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='" href="',(o=n.url)?o=o.call(t,{hash:{},data:i}):(o=t.url,o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-track="contextSliderNextPhotoClick" style="background-image: url(',(o=n.background)?o=o.call(t,{hash:{},data:i}):(o=t.background,o=typeof o===a?o.apply(t):o),s+=f(o)+"); left: ",(o=n.left)?o=o.call(t,{hash:{},data:i}):(o=t.left,o=typeof o===a?o.apply(t):o),s+=f(o)+'px" data-photo-id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'" title="',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t.title,o=typeof o===a?o.apply(t):o),s+=f(o)+'"></a>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-slider-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-context-slider-scrappy",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return'\n	<div class=\'loadingError\'>\n		<p>Error loading context</p>\n		<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">Retry</button></p>\n	</div>\n'}function f(e,t){var r="",i;r+='\n\n	<div class=\'context-slider small-slider\'>\n\n		<div class="wrapper is-ready clear-float small-photos">\n	\n			<div class="slider">\n	\n				',i=n.each.call(e,e.previousPhotos,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;r+="\n	\n				",i=n.each.call(e,e.currentPhoto,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;r+="\n	\n				",i=n.each.call(e,e.nextPhotos,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;r+='\n	\n			</div> \n	\n		</div>\n		\n	</div>\n	\n	<div class=\'context-slider big-slider\'>\n		\n		<span class="nav nav-l">\n			<span class="hide-text">&larr;</span>\n		</span>\n	\n		<div class="wrapper clear-float">\n	\n			<div class="slider">\n	\n				',i=n.each.call(e,e.previousPhotos,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;r+="\n	\n				",i=n.each.call(e,e.currentPhoto,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;r+="\n	\n				",i=n.each.call(e,e.nextPhotos,{hash:{},inverse:u.noop,fn:u.program(4,l,t),data:t});if(i||i===0)r+=i;return r+='\n	\n			</div> \n	\n		</div>\n\n		<span class="nav nav-r">\n			<span class="hide-text">&rarr;</span>\n		</span>\n	\n	</div>\n	\n',r}function l(e,t){var i="",s;i+="\n					",s=u.invokePartial(r["context-slider-photo"],"context-slider-photo",e,n,r,t);if(s||s===0)i+=s;return i+="\n				",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u=this;o=n["if"].call(t,t.loadingError,{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each(["context-slider-photo","context-slider-photo","context-slider-photo","context-slider-photo","context-slider-photo","context-slider-photo"],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-slider-scrappy",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo","hermes-template-context-slider-photo"]});
YUI.add("hermes-template-context-image",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n\n	<a data-loaded="false" style="left:',(i=n.left)?i=i.call(e,{hash:{},data:t}):(i=e.left,i=typeof i===o?i.apply(e):i),r+=u(i)+';float:left;display:block;position:absolute;background-color:gray;height:40px;width:86px;border:1px solid transparent;" href="#">\n		\n	</a>\n\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t.images,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-image",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-context-text",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='\n\n<span data-loaded="true" style="left:',(o=n.left)?o=o.call(t,{hash:{},data:i}):(o=t.left,o=typeof o===u?o.apply(t):o),s+=a(o)+';float:left;display:block;position:absolute;height:40px;width:86px;border:1px solid #ccc;" href="#">\n	',(o=n.text)?o=o.call(t,{hash:{},data:i}):(o=t.text,o=typeof o===u?o.apply(t):o),s+=a(o)+"\n</span>\n\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context-text",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("context-slider-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.currentPosition=0,this.numberOfPhotosEitherSideInViewPort=3,this.numberOfPositionsToMove=3,this.numberOfPositionsToBuffer=3,this.numberOfPositionsToPreFetch=6,this.photoWidth=50,this.photoMargin=15,this.photoWidthPlusMargin=65,this.photoWidthSmall=20,this.photoMarginSmall=5,this.photoWidthPlusMarginSmall=25,this.atStart=!1,this.atEnd=!1,this.photosInSlider={},this.get("container").html===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=t.contextData,r=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId),context:t.appContext.getModel(n.modelName,n.params)});return r.then(function(e){t.set("photo",e.photo),t.set("contextModel",e.context)},function(e){if((e.getModelFailure||e.code===1)&&n.modelName!=="photostream-models")return t.contextData.modelName="photostream-models",t.appContext.getModel("photo-models",t.photoId).then(function(e){return t.set("photo",e),t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})})}).then(function(){var r=e.merge(n.params,{photoId:t.photoId,numNext:t.numberOfPositionsToPreFetch,numPrev:t.numberOfPositionsToPreFetch,viewAs:t.contextData.viewAs,refetchAt:t.numberOfPositionsToPreFetch*2});return t.get("contextModel").getValue("photoContextList").getContext(r)}).then(function(e){t.photosInSlider[0]=t.get("photo").getValue("id"),t.set("initialContextResponse",e)},function(e){if(e.notInContext)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.loadState();throw e}).then(null,function(e){throw t.appContext.warn("There was a problem loading the context slider data.",e&&e.message?e.message:e,e&&e.stack?e.stack:""),e})},assignContextPositionsAndAddToDOM:function(e){var t=this.get("container"),n=t.one(".small-slider .slider"),r=t.one(".big-slider .slider"),i=e.contextResponse,s,o,u;for(u=0;u<i.previous.length;u++)o=-1-u,typeof this.photosInSlider[o]=="undefined"&&(s=i.previous[u].toJSON(),this.photosInSlider[o]=i.previous[u].getValue("id"),s.left=o*this.photoWidthPlusMarginSmall,s.background=this.getBackgroundImage(i.previous[u]),s.url=this.getContextifiedURLForPhoto(i.previous[u]),n.append(this.templates("context-slider-photo")(s)),s.left=o*this.photoWidthPlusMargin,r.append(this.templates("context-slider-photo")(s)));for(u=0;u<i.next.length;u++)o=1+u,typeof this.photosInSlider[o]=="undefined"&&(s=i.next[u].toJSON(),this.photosInSlider[o]=i.next[u].getValue("id"),s.left=o*this.photoWidthPlusMarginSmall,s.background=this.getBackgroundImage(i.next[u]),s.url=this.getContextifiedURLForPhoto(i.next[u]),n.append(this.templates("context-slider-photo")(s)),s.left=o*this.photoWidthPlusMargin,r.append(this.templates("context-slider-photo")(s)))},checkBoundary:function(e){var t=e.contextResponse,n=e.requestedPreviousAmount,r=e.requestedNextAmount,i=e.positionWhenChecking,s=this.get("contextModel").getValue("photoContextList"),o=this.get("container"),u=o.one(".nav-l"),a=o.one(".nav-r");s.hasMinBoundary()&&t.previous.length-Math.abs(i)<=4&&n>0&&(u.hide(),this.atStart=!0),s.hasMaxBoundary()&&t.next.length-Math.abs(i)<=4&&r>0&&(a.hide(),this.atEnd=!0)},buildContainer:function(){var e=this.numberOfPhotosEitherSideInViewPort,t=this.get("photo").toJSON(),n;t.background=this.getBackgroundImage(this.get("photo")),t.left=0,t.currentPhoto=!0,t.url=this.getContextifiedURLForPhoto(this.get("photo")),n=this.templates("context-slider-scrappy")({previousPhotos:[],nextPhotos:[],currentPhoto:[t]}),this.setContainerHTML(n),this.assignContextPositionsAndAddToDOM({contextResponse:this.get("initialContextResponse"),requestedPreviousAmount:e,requestedNextAmount:e}),this.checkBoundary({contextResponse:this.get("initialContextResponse"),requestedPreviousAmount:e,requestedNextAmount:e,positionWhenChecking:this.currentPosition})},buildErrorContainer:function(){this.setContainerHTML(this.templates("context-slider-scrappy")({loadingError:!0}))},activate:function(){var t=this,n=t.get("container"),r=!1,i,s;return localStorage.getItem("showBigContextSlider")==="true"?(n.addClass("hover"),setTimeout(function(){n.setStyle("transition","opacity 300ms ease-out, background-position 150ms ease-out"),n.all(".context-slider").setStyle("transition","opacity 300ms ease-out")},300)):(n.setStyle("transition","opacity 300ms ease-out, background-position 150ms ease-out"),n.all(".context-slider").setStyle("transition","opacity 300ms ease-out")),e.use("transition",function(e){t.registerEventHandler(t.get("container").one(".nav-l").on("click",function(){n.setStyle("transition","opacity 300ms ease-out"),e.rapidTracker.beacon(t.name,"contextSliderMoveLeftClick"),t.move(-1*t.numberOfPositionsToMove)})),t.registerEventHandler(t.get("container").one(".nav-r").on("click",function(){n.setStyle("transition","opacity 300ms ease-out"),e.rapidTracker.beacon(t.name,"contextSliderMoveRightClick"),t.move(1*t.numberOfPositionsToMove)})),t.attachKeyEvent("down:188",e.betterThrottle(function(n){e.rapidTracker.beacon(t.name,"contextSliderMoveLeftKeyPress"),t.atStart||t.move(-1*t.numberOfPositionsToMove)},20)),t.attachKeyEvent("down:190",e.betterThrottle(function(n){e.rapidTracker.beacon(t.name,"contextSliderMoveRightKeyPress"),t.atEnd||t.move(1*t.numberOfPositionsToMove)},20)),t.registerEventHandler(n.on("hover",function(){r=!0,clearTimeout(i),i=setTimeout(function(){r&&n.addClass("hover")},150)},function(){r=!1,clearTimeout(s),localStorage.setItem("showBigContextSlider","false"),s=setTimeout(function(){r||(n.setStyles({width:"100%",height:"80px"}),n.removeClass("hover"),setTimeout(function(){n.removeAttribute("style")},300))},1500)})),t.registerEventHandler
(n.all(".context-thumb").on("click",function(){localStorage.setItem("showBigContextSlider","true")}))}),this},move:function(t){var n=this,r=this.get("contextModel").getValue("photoContextList"),i=t>0?"right":"left",s=this.get("container"),o=s.one(".big-slider .slider"),u=s.one(".small-slider .slider"),a,f,l,c,h,p=s.one(".nav-l"),d=s.one(".nav-r"),v;s.addClass("hover"),this.currentPosition+=t,v=this.currentPosition,typeof this.photosInSlider[this.currentPosition+this.numberOfPhotosEitherSideInViewPort+1]!="undefined"&&(d.show(),this.atEnd=!1),typeof this.photosInSlider[this.currentPosition-(this.numberOfPhotosEitherSideInViewPort+1)]!="undefined"&&(p.show(),this.atStart=!1),a=this.currentPosition*this.photoWidthPlusMargin*-1,f=this.currentPosition*this.photoWidthPlusMarginSmall*-1,o.transition({left:a+"px",duration:.3,easing:"ease-out"}),u.setStyle("left",f+"px"),i==="right"?c=this.currentPosition+this.numberOfPositionsToMove+this.numberOfPositionsToBuffer:i==="left"&&(c=this.currentPosition-(this.numberOfPositionsToMove+this.numberOfPositionsToBuffer)),l=typeof this.photosInSlider[c]=="undefined",l&&(h=e.merge(n.contextData.params,{photoId:this.get("photo").getValue("id"),viewAs:n.contextData.viewAs}),i==="right"?(h.numNext=Math.abs(c)+this.numberOfPositionsToPreFetch,h.numPrev=0):i==="left"&&(h.numNext=0,h.numPrev=Math.abs(c)+this.numberOfPositionsToPreFetch),r.getContext(h).then(function(e){n.assignContextPositionsAndAddToDOM({contextResponse:e,requestedPreviousAmount:h.numPrev,requestedNextAmount:h.numNext}),n.checkBoundary({contextResponse:e,requestedPreviousAmount:h.numPrev,requestedNextAmount:h.numNext,positionWhenChecking:v})}))},getBackgroundImage:function(e){var t,n=this.appContext.getViewer().getPixelRatio(),r;return t={width:this.photoWidth*n,height:this.photoWidth*n},r={cropToFit:!0,includeSizes:["sq","t","q","s","n"]},e.getSizeToFit(t,r).url},getContextifiedURLForPhoto:function(t){if(t){var n=e.URLHelper.getPhotoPage({photoId:t.getValue("id"),pathAlias:t.getValue("owner").getValue("pathAlias"),contextSuffix:this.contextData.viewAs==="public"?"public":this.get("contextModel").getValue("urlSuffix")});return n}}})},"@VERSION@",{requires:["flickr-view","hermes-template-context-slider-scrappy","hermes-template-context-slider-photo","hermes-template-context-image","hermes-template-context-text","context-slider-scrappy-css"],optional:[]});
YUI.add("hermes-template-photo-engagement",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+="\n	",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["photo-well-scrappy-edit-view"],s):u.call(e,"outlet",e["photo-well-scrappy-edit-view"],s)))+"\n",r}function c(e,t){var r="",i,s;return r+="\n	",s={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["fave-view"],s):u.call(e,"outlet",e["fave-view"],s)))+"\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;o=n["if"].call(t,t.viewerIsOwner,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n\n<div class=\'share\'>\n	<a href="#" title="Share this photo">\n		<i class="ui-icon-share-24"></i>\n	</a>\n</div>\n\n<div class=\'download\'>\n	<a href="#" title="Download this photo">\n		<i class="ui-icon-download"></i>\n	</a>\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-engagement",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-scrappy-download-menu",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n        ",i=n.each.call(e,e.sizes,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function c(e,t){var r="",i;return r+='\n		    <li class="',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+'">\n			    <a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===u?i.apply(e):i),r+=a(i)+'" data-track="downloadSizeSelected',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="download-image-size">\n				    <span class="label">',(i=n.label)?i=i.call(e,{hash:{},data:t}):(i=e.label,i=typeof i===u?i.apply(e):i),r+=a(i)+'</span>\n				    <span class="resolution">(',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===u?i.apply(e):i),r+=a(i)+" &times; ",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===u?i.apply(e):i),r+=a(i)+")</span>\n			    </a>\n		    </li>\n	    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<ul class="sizes">\n    ',o=n["if"].call(t,t.showDownloadSizes,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n	<li><a href="'+a((o=(o=t.photo,o==null||o===!1?o:o.url),typeof o===u?o.apply(t):o))+'/sizes/l" class="all-sizes server-only-link" data-track="viewAllSizesClick">View all sizes</a></li>\n</ul>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-download-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-engagement-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var t=this,n=[];return n.push(t.appContext.getModel("photo-models",t.photoId).then(function(e){t.set("photo",e)})),n.push(t.appContext.getModel("photo-engagement-models",t.photoId).then(function(e){t.set("photo-engagement",e)})),n.push(t.appContext.getModel("person-relationship-models",t.nsid).then(function(e){t.set("relationshipModel",e)})),e.Promise.all(n)},buildContainer:function(){var e;return e=this.templates("photo-engagement")({viewerIsOwner:this.get("relationshipModel").getValue("isMe"),"photo-well-scrappy-edit-view":this.subviews["photo-well-scrappy-edit-view"].get("container"),"fave-view":this.subviews["fave-view"].get("container")}),this.setContainerHTML(e),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e={},t=this.get("container");return this.downloadMenuSetup(),t.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this),e.download=t.one(".download a"),e.download&&(this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),e.download.on("click",this.handleDownloadMenuButtonClick,this)),e.share=t.one(".share a"),e.share&&this.registerEventHandler(e.share.on("click",this.handleShareClicked,this)),this},handleShareClicked:function(t){t.preventDefault();var n=this,r=this.subviews["share-view"];e.rapidTracker.beacon(this.name,"shareActionBarButtonClick");if(r)return r.fire("subviewViewEvent","openShareMenu",{}),r[r.isVisible()?"hide":"show"]();this.appContext.getView("share-view",{photoId:this.get("photo-engagement").id,anchorTo:n.get("container").one(".share"),arrow:!0,dropUp:!0,parent:this}).then(function(e){n.subviews["share-view"]=e,e.switchToLoading(),e.initialize().then(function(){e.show()})}).then(null,function(e){n.appContext.warn(e)})},downloadMenuSetup:function(t){var n=this.get("container"),r=e.clone(this.get("photo").toJSON()),i=this,s,o=[],u,a=this.get("photo").getValue("engagement").getValue("canDownload"),f=this.appContext.flipper.isFlipped("download-dialog-enabled"),l=!1;r.sizes.q&&(r.sizes.q.label="Square",o.push(r.sizes.q)),r.sizes.s&&(r.sizes.s.label="Small",o.push(r.sizes.s)),r.sizes.z&&(r.sizes.z.label="Medium",o.push(r.sizes.z)),r.sizes.l&&(r.sizes.l.label="Large",r.sizes.l.selected=!0,o.push(r.sizes.l)),r.sizes.o&&(r.sizes.o.label="Original",o.push(r.sizes.o));for(u=0;u<o.length;u++)o[u].url=o[u].url.replace(/^(.+)(\..+)$/,"$1_d$2");a&&f&&(l=!0),s=this.templates("scrappy-download-menu")({photo:r,sizes:o,showDownloadSizes:l}),this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?i.fire("subviewViewEvent","make in view",n):i.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(t){t.preventDefault(),e.rapidTracker.beacon(this.name,"downloadDialogClick"),this.downloadMenu.toggle()},handleDownloadItemClick:function(t){t.preventDefault();var n;n=t.currentTarget.getAttribute("href"),document.location=n,e.rapidTracker.beacon(self.name,"photoDownloadClick"),this.downloadMenu.hide()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-download-dialog","hermes-template-scrappy-download-menu","photo-engagement-css"],optional:[]});
