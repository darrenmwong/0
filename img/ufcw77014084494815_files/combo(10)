YUI.add("hermes-template-share-modal-mail",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-mail">\n\n	<h1><i class="ui-icon-small-mail"></i>Share via mail</h1>\n	<form class="ui-form">\n		<fieldset>\n			<legend>'+a((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===u?o.apply(t):o))+'</legend>\n			<input type="text" class="ui-u-1" placeholder="screen name or email" data-field="recipient">\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-modal-mail",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-share-modal-tumblr",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;r+='\n		| <select data-field="account" class="c-share-dropdown-account">\n			',s=n.each.call(e,(i=(i=e.networks,i==null||i===!1?i:i.tumblr),i==null||i===!1?i:i.accounts),{hash:{},inverse:c.noop,fn:c.program(2,d,t),data:t});if(s||s===0)r+=s;return r+="\n		</select>\n		",r}function d(e,t){var r="",i;return r+='\n			<option value="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'">@',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+"</option>\n			",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-tumblr">\n	<h1>\n		<i class="ui-icon-small-tumblr"></i>\n		Share on Tumblr\n		',a={hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i},u=(o=n.ifCond||t.ifCond,o?o.call(t,(o=(o=(o=t.networks,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a):h.call(t,"ifCond",(o=(o=(o=t.networks,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a));if(u||u===0)s+=u;return s+='\n	</h1>\n\n	<form class="ui-form">\n		<fieldset>\n			<legend style="max-width: 280px;">'+l((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</legend>\n			<select data-field="publishing" class="c-share-dropdown-publishing">\n				<option value="publish">Publish now</option>\n				<option value="queue">Add to queue</option>\n				<option value="draft">Save as draft</option>\n			</select>\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n	<div class="c-share-compose-connect">\n		<i>&harr;</i>\n		please authorize Flickr to post on Tumblr\n	</div>\n\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-modal-tumblr",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-share-modal-blogger",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-blogger">\n\n	<h1><i class="ui-icon-small-blogger"></i>Share on Blogger</h1>\n\n	<form class="ui-form">\n		<fieldset>\n			<legend>'+a((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===u?o.apply(t):o))+'</legend>\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n	<div class="c-share-compose-connect">\n		<i>&harr;</i>\n		please authorize Flickr to post on Blogger\n	</div>\n\n</div>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-modal-blogger",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-share-link-tumblr",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<a href="',(o=n.pageUrl)?o=o.call(t,{hash:{},data:i}):(o=t.pageUrl,o=typeof o===f?o.apply(t):o),s+=l(o)+'" title="',a={hash:{},data:i},s+=l((o=n.fallback||t.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",a):c.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",a)))+'">',a={hash:{},data:i},s+=l((o=n.fallback||t.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",a):c.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",a)))+'</a> by <a href="',(u=n.ownerUrl)?u=u.call(t,{hash:{},data:i}):(u=t.ownerUrl,u=typeof u===f?u.apply(t):u),s+=l(u)+'">'+l((o=(o=(o=t.model,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===f?o.apply(t):o))+"</a> on Flickr.",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-link-tumblr",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-share-link-blogger",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div style="font-size: 0.8em; line-height: 1.6em; margin: 0 0 10px 0; padding: 0;">\n	<a href="',(o=n.pageUrl)?o=o.call(t,{hash:{},data:i}):(o=t.pageUrl,o=typeof o===f?o.apply(t):o),s+=l(o)+'" title="',a={hash:{},data:i},s+=l((o=n.fallback||t.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",a):c.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",a)))+'"><img alt="',a={hash:{},data:i},s+=l((o=n.fallback||t.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",a):c.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",a)))+" by "+l((o=(o=(o=t.model,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===f?o.apply(t):o))+'" src="'+l((o=(o=t.imgSize,o==null||o===!1?o:o.url),typeof o===f?o.apply(t):o))+'" style="max-width: 100%"></a>\n	<span style="margin: 0;"><a href="',(u=n.pageUrl)?u=u.call(t,{hash:{},data:i}):(u=t.pageUrl,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{},data:i},s+=l((o=n.fallback||t.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",a):c.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",a)))+'</a>, a photo by <a href="',(u=n.ownerUrl)?u=u.call(t,{hash:{},data:i}):(u=t.ownerUrl,u=typeof u===f?u.apply(t):u),s+=l(u)+'">'+l((o=(o=(o=t.model,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===f?o.apply(t):o))+"</a> on Flickr.</span>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/share-link-blogger",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("share-view",function(e){var t=e.Views.dialogs["dialog-tooltip"],n={},r,i,s,o,u;u={debug:!1,transitionTimeout:2e3,defaultEmbedSize:"sq",defaultTab:"html",noPlayrTab:"link",shareRedirectURL:e.url("/authorize.gne?client=1"),networks:{facebook:{clientId:e.config.flickr.facebook.client_id,scope:"offline_access,read_stream,publish_stream,publish_actions",authorizeUrl:"https://www.facebook.com/dialog/oauth",signedOutShareUrl:"https://www.facebook.com/dialog/feed"},twitter:{signedOutShareUrl:"https://twitter.com/share"},tumblr:{signedOutShareUrl:"https://www.tumblr.com/share/photo",shareSize:"c"},pinterest:{defaultDescription:"Flickr photo",signedOutShareUrl:"https://www.pinterest.com/pin/create/button/",shareSize:"c"}},css:{locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-share-autocomplete-shim",embedTabs:".c-share-linkembed",embedSizeDropdown:".c-share-linkembed-embedsizedd",embedCode:".c-share-linkembed-embedcode"}},o=e.merge(e.flutil,{log:function(){if(!u.debug||!console.log.apply)return;var e=[].slice.call(arguments);e.unshift("SHARE"),o.dump.apply(null,e)}}),e.namespace("Views")[this.name]=e.Base.create("share-view",t,[],{initializer:function(n){var r,i=["photo","photostream","set"];this.api=this.appContext.flickrAPI,this.appContext=this.appContext,this.appContext.flipper.isFlipped("https_everything")||this.desecureLinks(),t.prototype.initializer.call(this,n);while(r=i.shift())if(n[r+"Id"]){this.set("modelName",r),this.set("modelId",n[r+"Id"]);break}if(!r)throw new Error("A photo or photolist id is required");return this.set("user",this.appContext.getViewer().signedIn?{}:null),e.Views.dialog.registerView(this,this.modelId),this},initialize:function(){return this.loadState()},userPrevShareOptions:function(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}},getPlayrUrl:function(t){var n,r;return n=document.location.pathname,n=n.replace(/\/+$/,""),n+="/player/",r=this.appContext.flipper.isFlipped("https_everything")?"https":"http",e.url(n,{protocol:r})},canShowPlayr:function(){var e=this.get("engagement"),t=this.get("privacy"),n=!1,r,i,s;return this.appContext.getViewer().signedIn&&e&&t&&(r=e.toJSON().ownerNsid,i=this.appContext.getViewer().nsid,s=r===i?!0:!1,n=e.getValue("canShare")&&t.getValue("isPublic")||s),n},loadState:function(){var t=this,n,r,i,s;return n=this.appContext.getModel(this.get("modelName")+"-models",this.get("modelId")),r=this.appContext.getModel(this.get("modelName")+"-privacy-models",this.get("modelId")),i=this.appContext.getModel(this.get("modelName")+"-engagement-models",this.get("modelId")),s=new e.FlickrPromise({model:n,privacy:r,engagement:i}),s.then(function(e){t.set("model",e.model),t.set("modelName",e.model.registry.name.split("-")[0]),t.set("privacy",e.privacy),t.set("engagement",e.engagement)}).then(function(){return t.mapLinkedAccounts()}).then(function(e){o.log("NETWORKS",t.get("networks")),t.openShareMenu()}).then(null,this.handleError("loadState"))},hide:function(e){var n=this;this._socialNet&&this._socialNet.close(),t.prototype.hide.call(this,function(){n.get("container").get("parentNode")&&n.openShareMenu(),e&&e()})},show:function(e){t.prototype.show.call(this,e),this.embedTabs&&this.embedTabs.refreshLayout()},desecureLinks:function(){var e;u.shareRedirectURL=u.shareRedirectURL.replace("https://","http://"),Object.keys(u.networks).forEach(function(t){e=u.networks[t],e.authorizeUrl&&(u.networks[t].authorizeUrl=e.authorizeUrl.replace("https://","http://")),e.signedOutShareUrl&&(u.networks[t].signedOutShareUrl=e.signedOutShareUrl.replace("https://","http://"))})},openShareMenu:function(){var t=this,n=this.canShowPlayr(),r=this.get("engagement"),i=this.get("privacy"),s=this.get("model"),o=this.get("networks"),a=!1,f=s?s.getValue("secret"):null,l=s?s.getValue("id"):null,c=!1,h=s?s.getValue("license"):0,p,d,v=this.get("container"),m;i&&!(i.getValue("isPublic")||i.getValue("isPublic")||i.getValue("isPublic"))&&r&&r.getValue("isOwner")&&(c=!0),s&&s.getValue("isVideo")&&(a=!0),s&&s.getValue("owner")&&(p=s.getValue("owner").getValue("username")),r&&r.getValue("ownerNsid")&&(d=r.getValue("ownerNsid")),o&&!o.facebook&&!o.twitter&&!o.tumblr&&!o.pinterest&&(n=!1),this.embedHtmlSizeDd&&this.embedHtmlSizeDd.destroy(),this.embedBbcodeSizeDd&&this.embedBbcodeSizeDd.destroy(),this.embedTabs&&this.embedTabs.destroy(),this.set("playrUrl",this.getPlayrUrl()),this.set("playr",this.appContext.flipper.isFlipped("playr")),this.set("htmlEmbeds",this.appContext.flipper.isFlipped("enable-html-embeds")),this.set("canShowPlayr",n),this.set("isOwner",r&&r.getValue("isOwner")),this.set("isPrivateAndisOwner",c),this.set("isHD",s&&s.getValue("isHD")),this.set("lang",this.appContext.lang),this.set("photoSecret",f),this.set("photoId",l),this.set("ownerUsername",p),this.set("ownerNsid",d),this.set("license",h),this.set("licenseIsCreativeCommons",h!==0&&h!==7&&h!==8),this.set("licenseisGovt",h===8),this.set("licenseisNoLic",h===7),this.set("licenseisCopy",h===0),this.set("https",this.appContext.flipper.isFlipped("https_everything")),this.set("content",this.templates("share")),this.renderContent();if(!this.get("model"))return;this.embedTabs=new e.Views.CharmTabs({appContext:this.appContext,container:this.get("container").one(u.css.embedTabs),selected:n?localStorage.getItem("previousSelectedShareTab")?localStorage.getItem("previousSelectedShareTab"):u.defaultTab:u.noPlayrTab}),this.embedTabs.on("selected",function(n){setTimeout(function(){var r=n.contentEl.one("input");if(r)try{r.focus()}catch(i){}t.userPrevShareOptions("previousSelectedShareTab",n.contentEl.getAttribute("data-tab")),!t.get("privacy").getValue("isPublic")&&!t.get("model").getValue("guestpass")&&t.setupGuestpassLink(),t.get("model").getValue("guestpass")&&(e.one("#share-photo-link").set("value",t.get("model").getValue("guestpass")),e.one("#share-photo-link").focus(),e.one("#share-photo-link").select()),localStorage.getItem("previousSelectedEmbedValue")&&n.contentEl.one(".c-share-linkembed-embedsizedd"
)&&n.contentEl.one(".c-share-linkembed-embedsizedd li.ui-dropdown-item-selected").getAttribute("data-value")!==localStorage.getItem("previousSelectedEmbedValue")&&(t.embedHtmlSizeDd.select(localStorage.getItem("previousSelectedEmbedValue")),t.embedBbcodeSizeDd.select(localStorage.getItem("previousSelectedEmbedValue")))},10)}),n&&(this.embedTabs.getTab("html")&&(a||(this.embedHtmlSizeDd=new e.Views.Dropdown({appContext:this.appContext,container:this.embedTabs.getTab("html").contentEl.one(u.css.embedSizeDropdown),selected:localStorage.getItem("previousSelectedEmbedValue")?localStorage.getItem("previousSelectedEmbedValue"):u.defaultEmbedSize}),this.embedHtmlSizeDd.on("selected",function(e){e.clicked?t.setEmbedCode(e.clicked.value,e.clicked.itemEl):t.get("container").one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected")?t.setEmbedCode(u.defaultEmbedSize,t.get("container").one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected")):t.embedHtmlSizeDd.select(u.defaultEmbedSize)}),this.embedHtmlSizeDd.select(localStorage.getItem("previousSelectedEmbedValue")?localStorage.getItem("previousSelectedEmbedValue"):u.defaultEmbedSize),localStorage.getItem("selectedEmbedCodeType")&&(localStorage.getItem("selectedEmbedCodeType")==="playr"&&v.one("#code-type-playr")?v.one("#code-type-playr").setAttribute("checked",!0):v.one("#code-type-html").setAttribute("checked",!0),m=v.one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected"),t.setEmbedCode(m.getData("value"),m)))),a||(this.embedBbcodeSizeDd=new e.Views.Dropdown({appContext:this.appContext,container:this.embedTabs.getTab("bbcode").contentEl.one(u.css.embedSizeDropdown),selected:localStorage.getItem("previousSelectedEmbedValue")?localStorage.getItem("previousSelectedEmbedValue"):u.defaultEmbedSize}),this.embedBbcodeSizeDd.on("selected",function(e){e.clicked?t.setEmbedCode(e.clicked.value,e.clicked.itemEl):t.get("container").one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected")?t.setEmbedCode(u.defaultEmbedSize,t.get("container").one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected")):t.embedBbcodeSizeDd.select(u.defaultEmbedSize)}),this.embedBbcodeSizeDd.select(localStorage.getItem("previousSelectedEmbedValue")?localStorage.getItem("previousSelectedEmbedValue"):u.defaultEmbedSize)))},setupGuestpassLink:function(){var e=this,t=this.get("container"),n=t.one(".create-guestpass button"),r=t.one(".create-guestpass").siblings("h3"),i=t.one("#share-photo-link");r.hide(),i.hide(),t.one(".create-guestpass").setStyle("display","block"),n&&n.on("click",function(n){e.get("model").getGuestpass(e.get("model").getValue("id")).then(function(n){i.set("value",e.get("model").getValue("guestpass")),r.show(),i.show(),t.one(".create-guestpass").hide(),t.one("#share-photo-link").focus(),t.one("#share-photo-link").select()})})},codeTypeSelected:function(e){e.stopPropagation();var t=this.get("container"),n=t.one(".c-share-linkembed-embedsizedd ul li.ui-dropdown-item-selected");e.target.get("id")==="code-type-playr"||e.target.get("htmlFor")==="code-type-playr"?this.userPrevShareOptions("selectedEmbedCodeType","playr"):this.userPrevShareOptions("selectedEmbedCodeType","html"),this.setEmbedCode(n.getData("value"),n)},embedDimensionsFocusOut:function(e){var t=/[0-9]+/g,n=this.get("container"),r=16/9,i=n.one(".c-share-linkembed-videoembedcode"),s=n.one(".video-embed-width"),o=n.one(".video-embed-height");e.target.get("className")==="video-embed-width"?t.test(s.get("value"))?(o.set("value",Math.round(1/r*s.get("value"))),i.set("value",i.get("value").replace(/width\="[0-9]+"\sheight\="[0-9]+"/g,'width="'+s.get("value")+'" height="'+o.get("value")+'"'))):(s.set("value","400"),o.set("value","225")):t.test(n.one(".video-embed-height").getDOMNode().value)?(s.set("value",Math.round(r*o.get("value"))),i.set("value",i.get("value").replace(/width\="[0-9]+"\sheight\="[0-9]+"/g,'width="'+s.get("value")+'" height="'+o.get("value")+'"'))):(s.set("value","400"),o.set("value","225"))},addUserAttribToVideoEmbed:function(e){e.stopPropagation();var t=this.get("container"),n=t.one(".c-share-linkembed-videoembedcode"),r,i;e.target.get("checked")?(r=n.get("value").indexOf("&photo_id"),n.set("value",n.get("value").slice(0,r)+"&flickr_show_info_box=true"+n.get("value").slice(r)),i=n.get("value").lastIndexOf("&photo_id"),n.set("value",n.get("value").slice(0,i)+"&flickr_show_info_box=true"+n.get("value").slice(i))):n.get("value").indexOf("&flickr_show_info_box=true")!==-1&&n.set("value",n.get("value").replace(/&flickr_show_info_box=true/g,""))},embedCodeBoxClick:function(e){e.stopPropagation(),e.target.select()},setEmbedCode:function(e,t){var n=t.ancestor("[data-tab]").one(u.css.embedCode),r,i=this.get("container"),s;i.one("[name=code-type]:checked")&&t.one("#html-code")?(s=i.one("[name=code-type]:checked").get("value"),s==="html"?r=t.one("#html-code").get("innerHTML").trim():r=t.one("#playr-code").get("innerHTML").trim()):r=t.one("script").get("innerHTML").trim(),n.setAttribute("value",r),n.getDOMNode().select(),this.userPrevShareOptions("previousSelectedEmbedValue",e)},openComposeDialog:function(t){var n,r=this;this._socialNet=n=new t({appContext:this.appContext,model:this.get("model"),privacy:this.get("privacy"),networks:this.get("networks"),parent:this,signedOut:!this.get("user")}),e.rapidTracker.beacon(r.name,"share"+n.get("serviceName")+"NetworkClick"),n.on("posted",function(){r.switchToUIState("complete"),e.rapidTracker.beacon(r.name,"photoSharedTo"+n.get("serviceName")),setTimeout(function(){r.hide(function(){r.switchToUIState("complete",!1),r._socialNet.close(),r._socialNet=null})},2e3)}),n.on("dismissed",function(e){r.hide(function(){r._socialNet.close(),r._socialNet=null})}),n.render(),n.activate(),r.set("content",n),r.renderContent()},openSignedOutComposeDialog:function(t){var n;this._socialNet=n=new t({appContext:this.appContext,model:this.get("model"),privacy:this.get("privacy"),networks:this.get("networks"),parent:this,signedOut
:!this.get("user")}),e.rapidTracker.beacon(this.name,"share"+n.get("serviceName")+"SignedOutNetworkClick"),this._socialNet.composeSignedOut()},openAuthorizeDialog:function(e){this.openComposeDialog(e),this._socialNet.linkAccount()},activate:function(){var e,r=this;return t.prototype.activate.call(this),e={":compose":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);r.openComposeDialog(n[i])},":composesignedout":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);r.openSignedOutComposeDialog(n[i])},":connect":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);this.get("user")?r.openAuthorizeDialog(n[i]):r.openComposeDialog(n[i])},":expand":function(e,t){e.halt(),r.get("container").one('[data-target="expand"]').toggleClass(u.css.removed)},":codeTypeSelected":this.codeTypeSelected,":addUserAttrib":this.addUserAttribToVideoEmbed,".video-embed-width blur:":this.embedDimensionsFocusOut,".video-embed-height blur:":this.embedDimensionsFocusOut,":embedCodeBoxClick":this.embedCodeBoxClick},this.attachEvents(e),this.on("subviewViewEvent",function(e){return r.openShareMenu(),!1}),this},handleError:function(t,n){var r=this,i=["loadState","flickr.sharing.getServiceTypes","flickr.sharing.getServices","flickr.sharing.canShare"];return i.indexOf(t)>=0?function(e){o.log(t,!e.toString||e.toString().match(/^\[object/)?e:e.toString())}:function(n){o.log(t,!n.toString||n.toString().match(/^\[object/)?n:n.toString()),r.fire("subviewViewEvent","getDialogOffset",function(t){var n=e.Views.dialog.getInstance("dialog-alert",{content:"Something went wrong.<br>Please refresh your browser and try again.",attrs:{title:"Error",level:"warning",confirmLabel:"OK"},appContext:r.appContext,offsetLeft:t});n.show()})}.bind(this)},mapLinkedAccounts:function(){var e=this;return this.getLinkedAccounts().then(function(t){e.get("networks")||e.set("networks",{});var n=e.get("networks");Object.keys(t).forEach(function(e){n[t[e].label]=t[e]})})},getLinkedAccounts:function(){return e.batch(this.get("user")?this.api.callMethod("flickr.sharing.getServices",{}):new e.AutoResolvingPromise,this.getNetworks()).then(function(e){var t=e[0],n=e[1]||[],r;try{r=t.services.service||[]}catch(i){r=[]}return r=r.reduce(function(e,t){var n=t.typeId+"";return e[n]||(e[n]=[]),e[n].push(t),e},{}),Object.keys(n).forEach(function(e){n[e].accounts=r[n[e].id]||null}),n},this.handleError("flickr.sharing.getServices"))},getNetworks:function(){var t=this,n,r;return n=["facebook","twitter","tumblr","mail","pinterest"],r=["mail"],this.getNetworkMap().then(function(){var i={},s,o;return i[t.get("modelName")+"_id"]=t.get("model").id,t.get("user")?t.api.callMethod("flickr.sharing.canShare",i):(t.appContext.getViewer().signedIn?o=t.get("engagement").getValue("canShare")?n:r:o=r,s=o.map(function(e){var n,r,i;for(n in t._networkMap){r=t._networkMap[n],i={service_type_id:n};if(r.label===e){i.can_share=1;break}}return i.can_share||(i.can_share=0),i}),new e.AutoResolvingPromise({services:{service:s}}))}).then(function(e){var r;try{r=e.services.service||[]}catch(i){r=[]}return r.push({service_type_id:999,can_share:r.filter(function(e){return e.service_type_id.toString()==="9"&&e.can_share}).length}),r=r.filter(function(e){return e.can_share}).reduce(function(e,r){var i=r.service_type_id+"",s=t._networkMap[i]||{name:"unknown",label:i};return n.indexOf(s.label)<0?e:(e[i]={name:s.name,label:s.label,id:i},e)},{}),r},this.handleError("flickr.sharing.canShare"))},getNetworkMap:function(){var t=this;return this._networkMap={9:{label:"twitter",name:"Twitter"},12:{label:"tumblr",name:"Tumblr"},128:{label:"facebook",name:"Facebook"},129:{label:"yahoo-pulse",name:"Yahoo Pulse"},130:{label:"mail",name:"Mail"},999:{label:"pinterest",name:"Pinterest"}},this._networkMap?new e.AutoResolvingPromise:this.api.callMethod("flickr.sharing.getServiceTypes",{}).then(function(e){var n;try{n=e.service_types.service_type||[]}catch(r){n=[]}t._networkMap=n.reduce(function(e,t){return e[t.id.toString()]={label:t.content.toLowerCase().replace(/\s+/,"-"),name:t.content},e},{})},this.handleError("flickr.sharing.getServiceTypes"))},destructor:function(){this._socialNet&&this._socialNet.close(),t.prototype.destroy.call(this),this.detachAll()},isDebug:function(){return u.debug}}),r=n.Connect=function(t){this.options=e.merge(t),e.FlickrView.apply(this,arguments)},e.extend(r,e.FlickrView,{initializer:function(){this.api=this.options.appContext.flickrAPI,this.appContext=this.options.appContext,this.parent=this.options.parent,this.set("model",this.options.model),this.set("privacy",this.options.privacy),this.set("networks",this.options.networks),this.set("signedOut",this.options.signedOut),this.set("modelName",this.options.model.registry.name.split("-")[0]),this.set(this.get("modelName"),this.get("model"))},isPrivate:function(){var e=this.get("privacy");return!e.getValue("isPublic")&&!e.getValue("isVisibleByFriends")&&!e.getValue("isVisibleByFamily")},toJSON:function(){var t=this.getAttrs();return Object.keys(t).reduce(function(n,r){var i=t[r];return i instanceof e.Node?n:i instanceof e.FlickrView?n:(i&&i.toJSON&&(i=i.toJSON()),n[r]=i,n)},{})},render:function(){var e=this.templates(this.get("template"))(this.toJSON());return this.get("container").setHTML(e),this},activate:function(){var e={":post":this.post};return this.attachEvents(e),this},handleError:function(e,t){var n=this;return function(r){o.log(e,!r.toString||r.toString().match(/^\[object/)?r:r.toString());if([10,12,98,99].indexOf(Number(r.code))>=0)return n.linkAccount().then(t);n.parent.handleError(n._class+":"+e)(r)}},handleRetry:function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){t[0].apply(e,t.slice(1))}},linkAccount:function(){var t=this;return new e.FlickrPromise(function(e,n){t.authorize(function(n){var r={};r.token=n.token,r.service_type_id=t.get("serviceType"),n.hasOwnProperty("expiresIn")&&(r.expires=n.expiresIn/1e3|0||0),n.hasOwnProperty("verifier")&&(r.verifier=n.verifier),t.api
.callMethod("flickr.sharing.setToken",r).then(function(n){t.parent.mapLinkedAccounts().then(function(){o.log("NETWORKS-REFRESH",t.get("networks")),e()})})})})},authorize:function(t){var n=this.get("serviceName"),r,i=this;r=e.Views.dialog.getInstance("dialog-cta",{content:"You need to authorize Flickr to share photos on your "+n,attrs:{title:"Connect to "+n,confirmButtonText:"Ok, take me to my settings"},appContext:i.appContext}),r.on("confirm",function(){document.location="/account/sharing/"}),r.show()},destructor:function(){this._oauthWin&&this._oauthWin.close();var t=this.get("container");t.detach(),t.remove(),this.set("container",null),this.options=null,this.api=null,this.appContext=null,this.set("model",null),this.set("privacy",null),e.FlickrView.prototype.destroy.call(this)},close:function(){this.destructor()}}),r.ATTRS=e.merge(e.FlickrView.ATTRS,{template:{value:"share-modal"},serviceType:{value:"000"},serviceName:{value:"Default"},container:{valueFn:function(){return e.Node.create("<div/>")}}}),n.ConnectFacebook=function(){this._class="ConnectFacebook",r.apply(this,arguments)},e.extend(n.ConnectFacebook,r,{post:function(t){var n={},r=this;return t.halt(),n[this.get("modelName")+"_id"]=this.get("model").id,n.service_type_id=this.get("serviceType"),n.facebook_privacy="friends",this.isPrivate()&&(n.guestpass_private="1"),n.message=o.escapeInput(this.get("container").one('[data-field="message"]').get("value"),"text"),o.log("POST TO FB",n),this.get("container").addClass(u.css.working),e.UA.ie&&r._oauthWin&&r._oauthWin.close(),this.api.callMethod("flickr.sharing.post",n).then(function(e){r.get("container").removeClass(u.css.working),r.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,t)))},composeSignedOut:function(){var t,n,r=this;t={app_id:e.config.flickr.facebook.client_id,display:"popup",link:document.location.href,name:this.get("model").getValue("title"),description:this.get("model").getValue("description"),redirect_uri:u.shareRedirectURL},u.debug&&(t.link=t.link.replace("local.flickr.com",e.config.flickr.url.host)),o.log("ANON POST TO FB",t),this.get("container").addClass(u.css.working),n=o.buildHttpQuery(u.networks.facebook.signedOutShareUrl,t),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(n,{onClose:function(){},onUrlChange:function(){var t,n,i;try{t=r._shareWin.document.location,n=[t.protocol,"//",t.host,t.pathname].join(""),i=u.shareRedirectURL.split("?")[0],u.debug&&n.replace("local.flickr.com",e.config.flickr.url.host),n===i&&r._shareWin&&r._shareWin.close()}catch(s){e.UA.ie&&r._oauthWin&&r._oauthWin.close()}},ui:{}})},authorize:function(e){var t,n,r=this,i;t={client_id:u.networks.facebook.clientId,redirect_uri:u.shareRedirectURL,response_type:"token",scope:u.networks.facebook.scope,display:"popup"},n=o.buildHttpQuery(u.networks.facebook.authorizeUrl,t),i=function(){var t,n;try{t=r._oauthWin.location.hash||""}catch(i){t=""}n=t.slice(1).split(/&/).reduce(function(e,t){var n=t.split(/=/);return e[n[0]]=n[1],e},{}),n.access_token&&(r._oauthWin&&r._oauthWin.close(),e({token:n.access_token,expiresIn:(parseInt(n.expires_in,10)||0)*1e3}))},this._oauthWin&&this._oauthWin.close(),this._oauthWin=o.openPopupWindow(n,{onUrlChange:i,ui:{}})}}),n.ConnectFacebook.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-facebook"},serviceType:{value:"128"},serviceName:{value:"Facebook"}}),n.ConnectTwitter=function(){this._class="ConnectTwitter",r.apply(this,arguments)},e.extend(n.ConnectTwitter,r,{activate:function(){function a(r){var i=o.escapeInput(t.get("value"),"text");n.setHTML(""+(s-i.length)),n[i.length>s?"addClass":"removeClass"]("c-share-twitter-charcounter-overflow"),e[i.length>s?"addClass":"removeClass"](u.css.locked)}r.prototype.activate.call(this);var e=this.get("container"),t=e.one('[data-field="message"]'),n=e.one('[data-field="message-counter"]'),i,s=120;a(),i=t.on("keydown",a),this.registerEventHandler(i)},render:function(){r.prototype.render.call(this),this.accountDd=new s(this.get("container").one('[data-field="account"]'))},authorize:function(t){var n={},r=this,i=this.get("container"),s,a,f=!1;n.service_type_id=this.get("serviceType"),i.addClass(u.css.connecting),s=function(){var n=r._oauthWin.location.search||"",s=r._oauthWin.location.hostname||"",o;o=n.slice(1).split(/&/).reduce(function(e,t){var n=t.split(/=/);return e[n[0]]=n[1],e},{});if(o.oauth_token)return f=!0,r._oauthWin.close(),i.removeClass(u.css.connecting),t({token:o.oauth_token,verifier:o.oauth_verifier});s===e.config.flickr.url.host&&a()},a=function(){r._oauthWin.close();if(f)return;i.removeClass(u.css.connecting),r.fire("dismissed")},this.api.callMethod("flickr.sharing.getAuthorizeUrl",n).then(function(e){r._oauthWin&&r._oauthWin.close(),r._oauthWin=o.openPopupWindow(e.authorize_url,{onUrlChange:s,onClose:a,ui:{}})},this.handleError("flickr.sharing.getAuthorizeUrl"))},post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this,s;e.halt(),r[this.get("modelName")+"_id"]=this.get("model").id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1");try{s=o.escapeInput(this.accountDd.selected,"numericstring"),s||(s=this.get("networks").twitter.accounts[0].id)}catch(a){return this.handleError("flickr.sharing.post")("Twitter account not found on posting")}return r.service_id=s,r.message=n.get("value"),o.log("POST TO TWITTER",r),t.addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),i.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},composeSignedOut:function(){var t,n;t={url:document.location.href},u.debug&&(t.url=t.url.replace("local.flickr.com",e.config.flickr.url.host)),o.log("ANON POST TO TWITTER",t),this.get("container").addClass(u.css.working),n=o.buildHttpQuery(u.networks.twitter.signedOutShareUrl,t),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(n)},destructor:function(){
this.accountDd=null,n.Connect.prototype.destroy.call(this)}}),n.ConnectTwitter.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-twitter"},serviceType:{value:"9"},serviceName:{value:"Twitter"}}),n.ConnectTumblr=function(){this._class="ConnectTumblr",r.apply(this,arguments)},e.extend(n.ConnectTumblr,r,{render:function(){r.prototype.render.call(this),this.publishingDd=new s(this.get("container").one('[data-field="publishing"]')),this.accountDd=new s(this.get("container").one('[data-field="account"]'))},authorize:n.ConnectTwitter.prototype.authorize,post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this,s;e.halt(),r[this.get("modelName")+"_id"]=this.get("model").id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1");try{s=o.escapeInput(this.accountDd.selected,"numericstring"),s||(s=this.get("networks").tumblr.accounts[0].id)}catch(a){return this.handleError("flickr.sharing.post")("Tumblr account not found on posting")}return r.service_id=s,r.status=o.constrainToValues(this.publishingDd.selected,["publish","queue","draft"]),r.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO TUMBLR",r),t.addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),i.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},composeSignedOut:function(){var t=this.get("model"),n=t.getValue("sizes"),r,i,s=t.getValue("owner").getValue("url"),a=document.location.href,f,l,c;r=n[u.networks.blogger.shareSize],r||(r=t.getLargestSize(t.getValue("id"))),u.debug&&(a=a.replace("local.flickr.com",e.config.flickr.url.host)),i=this.appContext.flipper.isFlipped("https_everything")?"https":"http",s=e.url(s,{protocol:i}),r=n[u.networks.tumblr.shareSize],r||(r=t.getLargestSize(t.getValue("id"))),f=this.templates("share-link-tumblr")(e.merge(this.toJSON(),{imgSize:r,pageUrl:a,ownerUrl:s})),l={source:(this.appContext.flipper.isFlipped("https_everything")?"https:":"http:")+r.url,caption:f,click_thru:a},o.log("ANON POST TO TUMBLR",l),c=o.buildHttpQuery(u.networks.tumblr.signedOutShareUrl,l),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(c)},destructor:function(){this.publishingDd=null,this.accountDd=null,n.Connect.prototype.destroy.call(this)}}),n.ConnectTumblr.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-tumblr"},serviceType:{value:"12"},serviceName:{value:"Tumblr"}}),n.ConnectPinterest=function(){this._class="ConnectPinterest",r.apply(this,arguments)},e.extend(n.ConnectPinterest,r,{render:function(e){},show:function(){},hide:function(){},activate:function(){this.post()},post:function(){var e,t,n=this.get("model"),r=n.getValue("sizes"),i=n.getValue("title")||u.networks.pinterest.defaultDescription,s;s=r[u.networks.pinterest.shareSize],s||(s=n.getLargestSize(n.getValue("id"))),e={url:document.location.href,description:i,media:(this.appContext.flipper.isFlipped("https_everything")?"https:":"http:")+s.url},t=o.buildHttpQuery(u.networks.pinterest.signedOutShareUrl,e),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(t,{onClose:function(){},ui:{}}),this.fire("dismissed")},composeSignedOut:function(){this.post()}}),n.ConnectPinterest.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-pinterest"},serviceType:{value:"999"},serviceName:{value:"Pinterest"}}),n.ConnectMail=function(){this._class="ConnectMail",r.apply(this,arguments)},e.extend(n.ConnectMail,r,{activate:function(){var e=this;r.prototype.activate.call(this),this.get("container").addClass(u.css.locked),this.contacts=new i({el:this.get("container").one('[data-field="recipient"]'),appContext:this.appContext,shim:u.css.shim,signedOut:this.get("signedOut"),onError:this.handleError("ContactSearchBox"),onShow:function(t){e.get("container").addClass(u.css.locked),e.get("container").on("click",function(t){t.target.get("tagName")!=="INPUT"&&e.get("container").one(".contact-list").getStyle("display")==="block"&&e.get("container").one(".contact-list").setStyle("display","none")}),e.get("container").one("input").on("focus",function(){e.get("container").one(".contact-list").getStyle("display")==="none"&&e.get("container").one(".contact-list li")&&e.get("container").one(".contact-list").setStyle("display","block")})},onSelect:function(t){t?e.get("container").removeClass(u.css.locked):e.get("container").addClass(u.css.locked)}})},post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this.get("model"),s=this;e.halt();if(!this.contacts.selected)return;return r[this.get("modelName")+"_id"]=i.id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1"),this.contacts.selected.nsid?r.to_flickr=this.contacts.selected.nsid:this.contacts.selected.email&&(r.to_email=this.contacts.selected.email),r.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO MAIL",r),this.get("container").addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),s.fire("posted")},this.handleError("flickr.sharing.post"))},composeSignedOut:function(){function i(){n&&n.destroy(),e.SigninHelper.addPendingShare({shareType:"email"})}var t,n,r;r=this.appContext,this.parent.hide(),t=new e.Views["confirmation-dialog-view"]({title:"Oops...",icon:"ui-icon-modal-error",content:"So you want to email a photo huh? Sign in and try again.",confirmButtonLabel:"Sign in",cancelButtonLabel:"Forget it",appContext:r}),t.render(),t.activate(),n=e.Views.dialog.getNewInstance("dialog-modal",{content:t.get("container"),appContext:r}),n.show(),t.registerEventHandler(t.get("container").one(".ui-dialog-button-confirm").on("click",function(){n.close(),n.destroy(),i()}))},handleError:function(e,t){var n=this;return function(t){n.parent.handleError(n._class+":"+e)(t)}}}),n.ConnectMail.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-mail"},serviceType:{value:"130"},serviceName:{value:"Email"}}),i=e.ContactSearchBox,s=function(
e,t){this.options=t,this._items=[],this.el=e,this.containerEl=null,this.listEl=null,this.labelEl=null,this.selected=null,this._open=!0,this._handlers=[],this._init()},s.prototype={_init:function(){if(!this.el)return;this._render(),this._handlers=[this.containerEl.delegate("click",this._onClick,"span, li",this)]},_render:function(){var t=this.el.getDOMNode(),n,r,i,s;s="ui-dropdown "+this.el.getDOMNode().className,this.containerEl=e.Node.create('<div class="'+s+'"/>'),this.listEl=n=e.Node.create("<ul/>"),this.labelEl=e.Node.create("<span/>"),this._items=r={},Array.prototype.slice.call(t.options).forEach(function(t){var i,s;i=r[t.value]={value:t.value,label:t.text},s=e.Node.create("<li/>"),s.set("text",i.label),s.setAttribute("data-value",i.value),n.appendChild(s)}),this.containerEl.appendChild(this.labelEl),this.containerEl.appendChild(this.listEl),this.el.setStyle("display","none"),this.el.insert(this.containerEl,"before"),i=t.options[t.selectedIndex]||{},this.select(i.value)},_onClick:function(e){var t=e.target,n=t.get("tagName").toLowerCase();if(n==="li")return this.select(t.getData("value"));if(n==="span")return this.toggle()},select:function(e){this.selected=e||null,this.labelEl.set("text",this.selected?this._items[this.selected].label:"..."),this.close()},open:function(){this._open=!0,this.listEl.setStyle("display","block")},close:function(){this._open=!1,this.listEl.setStyle("display","none")},toggle:function(){this[this._open?"close":"open"]()},destructor:function(){this._handlers.forEach(function(e){e.detach()}),this._handlers=null,this._items=null,this.el=null,this.containerEl=null,this.listEl=null,this.labelEl=null,this.selected=null}}},"@VERSION@",{requires:["flutil","dialog","dropdown","charmtabs","flickr-promise","contact-search-box","url","hermes-template-share","hermes-template-share-modal-facebook","hermes-template-share-modal-twitter","hermes-template-share-modal-mail","hermes-template-share-modal-tumblr","hermes-template-share-modal-blogger","hermes-template-share-link-tumblr","hermes-template-share-link-blogger"],optional:["photo-models","photostream-models","share-css"]});
YUI.add("hermes-template-confirmation-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return'\n<div class="delete-image-dialog-content">\n	<div class="delete-image-image">\n	        <img class="photo-to-delete" />\n	</div>\n</div>\n\n'}function d(e,t){var r="",i,s,o;r+='\n<div class="dialog-content">\n	',i=n["if"].call(e,e.icon,{hash:{},inverse:c.noop,fn:c.program(4,v,t),data:t});if(i||i===0)r+=i;return r+='\n	<div class="dialog-description">\n		<div>',o={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e.content,!1,o):h.call(e,"outlet",e.content,!1,o)))+" ",(s=n.deletePhotoConfirmation)?s=s.call(e,{hash:{},data:t}):(s=e.deletePhotoConfirmation,s=typeof s===f?s.apply(e):s),r+=l(s)+"</div>\n	</div>\n</div>\n",r}function v(e,t){var r="",i;return r+='\n		<i class="dialog-icon ',(i=n.icon)?i=i.call(e,{hash:{},data:t}):(i=e.icon,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></i>\n	',r}function m(e,t){var r="",i;return r+='\n<a class="ui-button ui-button-cta ui-dialog-button-confirm" href="',(i=n.organizrLink)?i=i.call(e,{hash:{},data:t}):(i=e.organizrLink,i=typeof i===f?i.apply(e):i),r+=l(i)+'" target="_blank"><span>Go to Organizr</span></a>\n',r}function g(e,t){var r="",i;r+="\n    ",i=n["if"].call(e,e.showConfirmButton,{hash:{},inverse:c.noop,fn:c.program(9,y,t),data:t});if(i||i===0)r+=i;r+="\n	",i=n["if"].call(e,e.showAuxiliaryButton,{hash:{},inverse:c.noop,fn:c.program(11,b,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function y(e,t){var r="",i;return r+='\n    <button class="ui-button ui-button-cta ui-dialog-button-confirm ',(i=n.confirmButtonClass)?i=i.call(e,{hash:{},data:t}):(i=e.confirmButtonClass,i=typeof i===f?i.apply(e):i),r+=l(i)+'"><span>',(i=n.confirmButtonLabel)?i=i.call(e,{hash:{},data:t}):(i=e.confirmButtonLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span></button>\n    ",r}function b(e,t){var r="",i;return r+='\n        <button class="ui-button ui-button-cta ui-dialog-button-confirm auxiliary-confirmation ',(i=n.auxiliaryButtonClass)?i=i.call(e,{hash:{},data:t}):(i=e.auxiliaryButtonClass,i=typeof i===f?i.apply(e):i),r+=l(i)+'"><span>',(i=n.auxiliaryButtonLabel)?i=i.call(e,{hash:{},data:t}):(i=e.auxiliaryButtonLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span></button>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="dialog-title">\n		<h3>',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.title,a):h.call(t,"renderTrustedMarkup",t.title,a)))+'</h3>\n		<i class="cancel-confirmation ui-dialog-button-close"></i>\n</div>\n\n',u=n["if"].call(t,t.deletePhotoConfirmation,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n\n",u=n["if"].call(t,t.organizrLink,{hash:{},inverse:c.program(8,g,i),fn:c.program(6,m,i),data:i});if(u||u===0)s+=u;return s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/confirmation-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("flickr-galleries-getPhotos-fetcher",function(e){"use strict";function t(t){var n={gallery_id:t.compoundId,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:t.perPage||1,page:t.page||20,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a;if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content,r.gallery.description=r.gallery.description&&r.gallery.description.content,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,o,s),a=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:s,photoModelRegistry:i,photoEngagementModelRegistry:u}),o.setValue(n.id,"photoPageList",a),a}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.galleries.getPhotos",this._processParams(t),!0),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getPhotos-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:r,_processResponse:n,_processParams:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models"]});
YUI.add("flickr-galleries-getContext-fetcher",function(e){"use strict";function t(t){var n={gallery_id:t.compoundId,photo_id:t.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:t.numPrev,num_next:t.numNext};return n}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=[],f=[],l=s.proxy(n.photoId),c,h,p,d,v,m,g=[];return c=r.nextphotos,h=r.prevphotos,f=e.APIHelper.response.parsePhotos({photos:c.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u}),a=e.APIHelper.response.parsePhotos({photos:h.photo,personModelRegistry:o,photoModelRegistry:s,photoEngagementModelRegistry:u}),m=i.getValue(n.id,"photoContextList"),d=m.hasMinBoundary?m.hasMinBoundary():!1,v=m.hasMaxBoundary?m.hasMaxBoundary():!1,p=m.getList(),g=e.APIHelper.response.addOrReplaceListByContext({model:l,next:f,prev:a.reverse(),current:p,hasMin:d,hasMax:v,numNext:n.numNext,numPrev:n.numPrev}),i.setValue(n.id,"photoContextList",g),{next:f,previous:a.reverse()}}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.galleries.getContext",this._processParams(t),!0),n.getModelRegistry("gallery-models"),n.getModelRegistry("photo-models"),n.getModelRegistry("person-models"),n.getModelRegistry("photo-engagement-models")).then(function(e){return r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getContext-fetcher] failed getting or processing API response:",e),e.code===3&&e.message==="Photo not in gallery"&&(e.notInContext=!0),e})}e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models"]});
YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-galleries-addPhoto-creator",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.addPhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],s=n[1],o=n[2],u=n[3],a=n[4],f,l;if(r.stat==="ok")return s&&!s.hasPhoto(o.getValue("id"))&&(s.addPhoto(o),o.getValue("isVideo")?s.setValue("videoCount",s.getValue("videoCount")+1):s.setValue("photoCount",s.getValue("photoCount")+1),1===s.getValue("photoCount")+s.getValue("videoCount")&&(f=o.getValue("sizes"),l={},e.Object.each(f,function(e,t){["m","s","sq","t"].indexOf(t)>-1&&(l[t]={width:e.width,height:e.height,src:e.url})}),s.setValue("primary",i),s.setValue("primaryPhotoSizes",l))),u.exists(t.photoID)&&!u.getValue(t.photoID,"galleries").getFromListByID(s.getValue("id"))&&(u.getValue(t.photoID,"galleries").prependToList(s),u.setValue(t.photoID,"total",u.getValue(t.photoID,"total")+1)),a.exists(t.photoID)&&!a.getValue(t.photoID,"contexts").getFromListByID(s.getValue("id"))&&(a.setValue(t.photoID,"totalGalleries",a.getValue(t.photoID,"totalGalleries")+1),a.getValue(t.photoID,"contexts").appendToList(s)),s},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-addPhoto-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-removePhoto-deletor",function(e){"use strict";function t(t,n){var r={},i=t.galleryCompoundID.split("-")[1];return r.photo_id=t.photoID,r.gallery_id=t.galleryCompoundID,e.batch(n.callAPI("flickr.galleries.removePhoto",r),n.getModel("gallery-models",i),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],s=e[2],o=e[3],u=e[4];if(n.stat==="ok")return u.exists(t.photoID)&&u.getValue(t.photoID,"contexts").getFromListByID(i)&&(u.setValue(t.photoID,"totalGalleries",u.getValue(t.photoID,"totalGalleries")-1),u.getValue(t.photoID,"contexts").removeFromList(i)),o.exists(t.photoID)&&o.getValue(t.photoID,"galleries").getFromListByID(i)&&(o.setValue(t.photoID,"total",o.getValue(t.photoID,"total")-1),o.getValue(t.photoID,"galleries").removeFromList(i)),r&&(r.hasPhoto(s.getValue("id"))&&r.removePhoto(s),s.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")-1):r.setValue("photoCount",r.getValue("photoCount")-1),0===r.getValue("photoCount")+r.getValue("videoCount")&&(r.setValue("primary",null),r.setValue("primaryPhotoSizes",{}))),r},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-removePhoto-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("flickr-galleries-getList-fetcher",function(e){"use strict";function t(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.galleries,a=n.id,f,l={},c=[];u&&(f=o.exists(a)?o.proxy(a):o.add(a),u.gallery&&e.Array.each(u.gallery,function(t,n){var r,i,o;i=t.id.split("-")[1],o={id:i,compoundId:t.id,title:t.title.content,description:t.description.content,owner:f,primary:t.primaryPhotoId,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),photoCount:t.countPhotos,videoCount:t.countVideos},r=s.exists(i)?s.proxy(i):s.add(o),c.push(r)}),l={id:a,galleries:c},i.exists(a)?i.setValues(a,l):i.add(l))}function n(t,n){var r=this,i={user_id:t.id,primary_photo_extras:"url_sq, url_t, url_s, url_m"};return e.batch(n.callAPI("flickr.galleries.getList",i),n.getModelRegistry("person-galleries-models"),n.getModelRegistry("gallery-models"),n.getModelRegistry("person-models")).then(function(e){r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-galleries-getList"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-galleries-models","gallery-models","person-models"]});
YUI.add("person-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getList"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getList-fetcher"]});
YUI.add("flickr-galleries-create-creator",function(e){"use strict";function t(t,n){var r={};return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,e.batch(n.callAPI("flickr.galleries.create",r),n.getModelRegistry("gallery-models"),n.getModel("photo-models",t.photoID),n.getModel("person-models",n.getViewer().nsid),n.getModel("person-galleries-models",n.getViewer().nsid),n.getModelRegistry("photo-galleries-models"),n.getModelRegistry("photo-contexts-models")).then(function(n){var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l,c=r.gallery.id,h=c.split("-")[1];return h?(l=i.add({id:h,compoundId:c,title:r.gallery.title.content,description:r.gallery.description.content,photoPageList:[s],photoContextList:[s],owner:o,primary:t.photoID,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(r.gallery),photoCount:s.getValue("isVideo")?0:1,videoCount:s.getValue("isVideo")?1:0}),u.getValue("galleries").prependToList(l),a.exists(t.photoID)&&!a.getValue(t.photoID,"galleries").getFromListByID(l.getValue("id"))&&(a.getValue(t.photoID,"galleries").prependToList(l),a.setValue(t.photoID,"total",a.getValue(t.photoID,"total")+1)),f.exists(t.photoID)&&!f.getValue(t.photoID,"contexts").getFromListByID(l.getValue("id"))&&(f.setValue(t.photoID,"totalGalleries",f.getValue(t.photoID,"totalGalleries")+1),f.getValue(t.photoID,"contexts").appendToList(l)),l):!1},function(e){throw n[e.fatal?"error":"debug"]("[flickr-galleries-create-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-galleries-create"]={run:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","person-galleries-models","photo-galleries-models","photo-contexts-models"]});
YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,n){return e.ModelCreators["flickr-galleries-create"].run(t,n)},addPhoto:function(t,n){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,n)},removePhoto:function(t,n){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,n)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},attributes:{compoundId:{validator:function(t,n){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){var n=e.AttributeHelpers.coerceString(t);return n=n.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\"),n},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t,n){return e.AttributeHelpers.validateInteger(t)},setter:function(t,n){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){var t=this.getValue(e,"primaryPhotoSizes");return t&&t.sq?t.sq.src:undefined}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":undefined}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner"),n=t.getValue("pathAlias");return"gallery-"+n+"-"+e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"]});
YUI.add("photo-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},groups:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("photo-sets-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});
YUI.add("flickr-photosets-addPhoto-creator",function(e){"use strict";function t(t,n){var r={};return r.photo_id=t.photoID,r.photoset_id=t.setID,e.batch(n.callAPI("flickr.photosets.addPhoto",r),n.getModel("set-models",t.setID),n.getModel("photo-models",t.photoID),n.getModelRegistry("photo-sets-models"),n.getModelRegistry("photo-contexts-models")).then(function(e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4];if(n.stat==="ok")return r&&!r.hasPhoto(i.getValue("id"))&&(r.addPhoto(i),i.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")+1):r.setValue("photoCount",r.getValue("photoCount")+1)),s.exists(t.photoID)&&!s.getValue(t.photoID,"sets").getFromListByID(r.getValue("id"))&&(s.getValue(t.photoID,"sets").prependToList(r),s.setValue(t.photoID,"total",s.getValue(t.photoID,"total")+1)),o.exists(t.photoID)&&!o.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(o.setValue(t.photoID,"totalSets",o.getValue(t.photoID,"totalSets")+1),o.getValue(t.photoID,"contexts").appendToList(r)),r},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-addPhoto-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photosets-addPhoto"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","photo-sets-models","photo-contexts-models"]});
YUI.add("flickr-photosets-getList-fetcher",function(e){"use strict";function t(e){var t={user_id:e.id,primary_photo_extras:"url_sq, url_t, url_s, url_m",page:e.page||1,per_page:e.perPage||500};return t}function n(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r.photosets,a=n.id,f,l={},c=[];if(u)return f=o.exists(a)?o.proxy(a):o.add({id:a}),u.photoset&&e.Array.each(u.photoset,function(t,n){var r,i={id:t.id,title:t.title.content,owner:f,primary:t.primary,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(t),isAutoUploadSet:t.autoUpload,photoCount:t.photos,videoCount:t.videos};r=s.exists(t.id)?s.proxy(t.id):s.add(i),c.push(r)}),l={id:a},l.sets=e.APIHelper.response.addOrReplaceListByPage({current:i.exists(a)?i.proxy(a).getValue("sets").getList():[],perPage:n.perPage,pageNum:n.page,hasMin:!1,hasMax:!1,totalItems:r.photosets.total,newPages:c}),i.exists(a)?i.setValue(a,"sets",l.sets):i.add(l),l.sets}function r(t,n){var r=this,i=this._processParams(t);return e.batch(n.callAPI("flickr.photosets.getList",i,!0),n.getModelRegistry("sets-models"),n.getModelRegistry("set-models"),n.getModelRegistry("person-models")).then(function(e){return t.perPage=i.per_page,t.page=i.page,r._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photosets-getList-fetcher] failed getting or processing API response:",e),e})}e.namespace("ListFetchers")["flickr-photosets-getList"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["sets-models","set-models","person-models"]});
YUI.add("sets-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getList"].run(t,this.appContext)}},attributes:{id:{},sets:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getList"]}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-getList-fetcher"]});
